
Š€€€) === -1);\n}\n\n// IE11 does not support Array.from()\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from#Browser_compatibility\n// https://developer.mozilla.org/en-US/docs/Web/API/FileList\n// https://developer.mozilla.org/en-US/docs/Web/API/DataTransferItemList\nfunction fromList<T>(items: DataTransferItemList | FileList): T[] {\n    const files = [];\n\n    // tslint:disable: prefer-for-of\n    for (let i = 0; i < items.length; i++) {\n        const file = items[i];\n        files.push(file);\n    }\n\n    return files as any;\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/DataTransferItem\nfunction toFilePromises(item: DataTransferItem) {\n    if (typeof item.webkitGetAsEntry !== 'function') {\n        return fromDataTransferItem(item);\n    }\n\n    const entry = item.webkitGetAsEntry();\n\n    // Safari supports dropping an image node from a different window and can be retrieved using\n    // the DataTransferItem.getAsFile() API\n    // NOTE: FileSystemEntry.file() throws if trying to get the file\n    if (entry && entry.isDirectory) {\n        return fromDirEntry(entry) as any;\n    }\n\n    return fromDataTransferItem(item);\n}\n\nfunction flatten<T>(items: any[]): T[] {\n    return items.reduce((acc, files) => [\n        ...acc,\n        ...(Array.isArray(files) ? flatten(files) : [files])\n    ], []);\n}\n\nfunction fromDataTransferItem(item: DataTransferItem) {\n    const file = item.getAsFile();\n    if (!file) {\n        return Promise.reject(`${item} is not a File`);\n    }\n    const fwp = toFileWithPath(file);\n    return Promise.resolve(fwp);\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemEntry\nasync function fromEntry(entry: any) {\n    return entry.isDirectory ? fromDirEntry(entry) : fromFileEntry(entry);\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryEntry\nfunction fromDirEntry(entry: any) {\n    const reader = entry.createReader();\n\n    return new Promise<FileArray[]>((resolve, reject) => {\n        const entries: Promise<FileValue[]>[] = [];\n\n        function readEntries() {\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryEntry/createReader\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryReader/readEntries\n            reader.readEntries(async (batch: any[]) => {\n                if (!batch.length) {\n                    // Done reading directory\n                    try {\n                        const files = await Promise.all(entries);\n                        resolve(files);\n                    } catch (err) {\n                        reject(err);\n                    }\n                } else {\n                    const items = Promise.all(batch.map(fromEntry));\n                    entries.push(items);\n\n                    // Continue reading\n                    readEntries();\n                }\n            }, (err: any) => {\n                reject(err);\n            });\n        }\n\n        readEntries();\n    });\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemFileEntry\nasync function fromFileEntry(entry: any) {\n    return new Promise<FileWithPath>((resolve, reject) => {\n        entry.file((file: FileWithPath) => {\n            const fwp = toFileWithPath(file, entry.fullPath);\n            resolve(fwp);\n        }, (err: any) => {\n            reject(err);\n        });\n    });\n}\n\n// Infinite type recursion\n// https://github.com/Microsoft/TypeScript/issues/3496#issuecomment-128553540\ninterface FileArray extends Array<FileValue> {}\ntype FileValue = FileWithPath\n    | FileArray[];\n","export {fromEvent} from './file-selector';\nexport {FileWithPath} from './file';\n","\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function (file, acceptedFiles) {\n  if (file && acceptedFiles) {\n    var acceptedFilesArray = Array.isArray(acceptedFiles) ? acceptedFiles : acceptedFiles.split(',');\n    var fileName = file.name || '';\n    var mimeType = (file.type || '').toLowerCase();\n    var baseMimeType = mimeType.replace(/\\/.*$/, '');\n    return acceptedFilesArray.some(function (type) {\n      var validType = type.trim().toLowerCase();\n\n      if (validType.charAt(0) === '.') {\n        return fileName.toLowerCase().endsWith(validType);\n      } else if (validType.endsWith('/*')) {\n        // This is something like a image/* mime type\n        return baseMimeType === validType.replace(/\\/.*$/, '');\n      }\n\n      return mimeType === validType;\n    });\n  }\n\n  return true;\n};","function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nimport accepts from 'attr-accept'; // Firefox versions prior to 53 return a bogus MIME type for every file drag, so dragovers with\n// that MIME type will always be accepted\n\nexport function fileAccepted(file, accept) {\n  return file.type === 'application/x-moz-file' || accepts(file, accept);\n}\nexport function fileMatchSize(file, minSize, maxSize) {\n  if (isDefined(file.size)) {\n    if (isDefined(minSize) && isDefined(maxSize)) return file.size >= minSize && file.size <= maxSize;else if (isDefined(minSize)) return file.size >= minSize;else if (isDefined(maxSize)) return file.size <= maxSize;\n  }\n\n  return true;\n}\n\nfunction isDefined(value) {\n  return value !== undefined && value !== null;\n}\n\nexport function allFilesAccepted(_ref) {\n  var files = _ref.files,\n      accept = _ref.accept,\n      minSize = _ref.minSize,\n      maxSize = _ref.maxSize,\n      multiple = _ref.multiple;\n\n  if (!multiple && files.length > 1) {\n    return false;\n  }\n\n  return files.every(function (file) {\n    return fileAccepted(file, accept) && fileMatchSize(file, minSize, maxSize);\n  });\n} // React's synthetic events has event.isPropagationStopped,\n// but to remain compatibility with other libs (Preact) fall back\n// to check event.cancelBubble\n\nexport function isPropagationStopped(event) {\n  if (typeof event.isPropagationStopped === 'function') {\n    return event.isPropagationStopped();\n  } else if (typeof event.cancelBubble !== 'undefined') {\n    return event.cancelBubble;\n  }\n\n  return false;\n}\nexport function isEvtWithFiles(event) {\n  if (!event.dataTransfer) {\n    return !!event.target && !!event.target.files;\n  } // https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/types\n  // https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API/Recommended_drag_types#file\n\n\n  return Array.prototype.some.call(event.dataTransfer.types, function (type) {\n    return type === 'Files' || type === 'application/x-moz-file';\n  });\n}\nexport function isKindFile(item) {\n  return _typeof(item) === 'object' && item !== null && item.kind === 'file';\n} // allow the entire document to be a drag target\n\nexport function onDocumentDragOver(event) {\n  event.preventDefault();\n}\n\nfunction isIe(userAgent) {\n  return userAgent.indexOf('MSIE') !== -1 || userAgent.indexOf('Trident/') !== -1;\n}\n\nfunction isEdge(userAgent) {\n  return userAgent.indexOf('Edge/') !== -1;\n}\n\nexport function isIeOrEdge() {\n  var userAgent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.navigator.userAgent;\n  return isIe(userAgent) || isEdge(userAgent);\n}\n/**\n * This is intended to be used to compose event handlers\n * They are executed in order until one of them calls `event.isPropagationStopped()`.\n * Note that the check is done on the first invoke too,\n * meaning that if propagation was stopped before invoking the fns,\n * no handlers will be executed.\n *\n * @param {Function} fns the event hanlder functions\n * @return {Function} the event handler to add to an element\n */\n\nexport function composeEventHandlers() {\n  for (var _len = arguments.length, fns = new Array(_len), _key = 0; _key < _len; _key++) {\n    fns[_key] = arguments[_key];\n  }\n\n  return function (event) {\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    return fns.some(function (fn) {\n      if (!isPropagationStopped(event) && fn) {\n        fn.apply(void 0, [event].concat(args));\n      }\n\n      return isPropagationStopped(event);\n    });\n  };\n}","function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* eslint prefer-template: 0 */\nimport React, { forwardRef, Fragment, useCallback, useEffect, useImperativeHandle, useMemo, useReducer, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { fromEvent } from 'file-selector';\nimport { allFilesAccepted, composeEventHandlers, fileAccepted, fileMatchSize, isEvtWithFiles, isIeOrEdge, isPropagationStopped, onDocumentDragOver } from './utils/index';\n/**\n * Convenience wrapper component for the `useDropzone` hook\n *\n * ```jsx\n * <Dropzone>\n *   {({getRootProps, getInputProps}) => (\n *     <div {...getRootProps()}>\n *       <input {...getInputProps()} />\n *       <p>Drag 'n' drop some files here, or click to select files</p>\n *     </div>\n *   )}\n * </Dropzone>\n * ```\n */\n\nvar Dropzone = forwardRef(function (_ref, ref) {\n  var children = _ref.children,\n      params = _objectWithoutProperties(_ref, [\"children\"]);\n\n  var _useDropzone = useDropzone(params),\n      open = _useDropzone.open,\n      props = _objectWithoutProperties(_useDropzone, [\"open\"]);\n\n  useImperativeHandle(ref, function () {\n    return {\n      open: open\n    };\n  }, [open]); // TODO: Figure out why react-styleguidist cannot create docs if we don't return a jsx element\n\n  return React.createElement(Fragment, null, children(_objectSpread({}, props, {\n    open: open\n  })));\n});\nDropzone.displayName = 'Dropzone';\nDropzone.propTypes = {\n  /**\n   * Render function that exposes the dropzone state and prop getter fns\n   *\n   * @param {object} params\n   * @param {Function} params.getRootProps Returns the props you should apply to the root drop container you render\n   * @param {Function} params.getInputProps Returns the props you should apply to hidden file input you render\n   * @param {Function} params.open Open the native file selection dialog\n   * @param {boolean} params.isFocused Dropzone area is in focus\n   * @param {boolean} params.isFileDialogActive File dialog is opened\n   * @param {boolean} params.isDragActive Active drag is in progress\n   * @param {boolean} params.isDragAccept Dragged files are accepted\n   * @param {boolean} params.isDragReject Some dragged files are rejected\n   * @param {File[]} params.draggedFiles Files in active drag\n   * @param {File[]} params.acceptedFiles Accepted files\n   * @param {File[]} params.rejectedFiles Rejected files\n   */\n  children: PropTypes.func,\n\n  /**\n   * Set accepted file types.\n   * See https://github.com/okonet/attr-accept for more information.\n   * Keep in mind that mime type determination is not reliable across platforms. CSV files,\n   * for example, are reported as text/plain under macOS but as application/vnd.ms-excel under\n   * Windows. In some cases there might not be a mime type set at all.\n   * See: https://github.com/react-dropzone/react-dropzone/issues/276\n   */\n  accept: PropTypes.oneOfType([PropTypes.string, PropTypes.arrayOf(PropTypes.string)]),\n\n  /**\n   * Allow drag 'n' drop (or selection from the file dialog) of multiple files\n   */\n  multiple: PropTypes.bool,\n\n  /**\n   * If false, allow dropped items to take over the current browser window\n   */\n  preventDropOnDocument: PropTypes.bool,\n\n  /**\n   * If true, disables click to open the native file selection dialog\n   */\n  noClick: PropTypes.bool,\n\n  /**\n   * If true, disables SPACE/ENTER to open the native file selection dialog.\n   * Note that it also stops tracking the focus state.\n   */\n  noKeyboard: PropTypes.bool,\n\n  /**\n   * If true, disables drag 'n' drop\n   */\n  noDrag: PropTypes.bool,\n\n  /**\n   * If true, stops drag event propagation to parents\n   */\n  noDragEventsBubbling: PropTypes.bool,\n\n  /**\n   * Minimum file size (in bytes)\n   */\n  minSize: PropTypes.number,\n\n  /**\n   * Maximum file size (in bytes)\n   */\n  maxSize: PropTypes.number,\n\n  /**\n   * Enable/disable the dropzone\n   */\n  disabled: PropTypes.bool,\n\n  /**\n   * Use this to provide a custom file aggregator\n   *\n   * @param {(DragEvent|Event)} event A drag event or input change event (if files were selected via the file dialog)\n   */\n  getFilesFromEvent: PropTypes.func,\n\n  /**\n   * Cb for when closing the file dialog with no selection\n   */\n  onFileDialogCancel: PropTypes.func,\n\n  /**\n   * Cb for when the `dragenter` event occurs.\n   *\n   * @param {DragEvent} event\n   */\n  onDragEnter: PropTypes.func,\n\n  /**\n   * Cb for when the `dragleave` event occurs\n   *\n   * @param {DragEvent} event\n   */\n  onDragLeave: PropTypes.func,\n\n  /**\n   * Cb for when the `dragover` event occurs\n   *\n   * @param {DragEvent} event\n   */\n  onDragOver: PropTypes.func,\n\n  /**\n   * Cb for when the `drop` event occurs.\n   * Note that this callback is invoked after the `getFilesFromEvent` callback is done.\n   *\n   * Files are accepted or rejected based on the `accept`, `multiple`, `minSize` and `maxSize` props.\n   * `accept` must be a valid [MIME type](http://www.iana.org/assignments/media-types/media-types.xhtml) according to [input element specification](https://www.w3.org/wiki/HTML/Elements/input/file) or a valid file extension.\n   * If `multiple` is set to false and additional files are droppped,\n   * all files besides the first will be rejected.\n   * Any file which does not have a size in the [`minSize`, `maxSize`] range, will be rejected as well.\n   *\n   * Note that the `onDrop` callback will always be invoked regardless if the dropped files were accepted or rejected.\n   * If you'd like to react to a specific scenario, use the `onDropAccepted`/`onDropRejected` props.\n   *\n   * `onDrop` will provide you with an array of [File](https://developer.mozilla.org/en-US/docs/Web/API/File) objects which you can then process and send to a server.\n   * For example, with [SuperAgent](https://github.com/visionmedia/superagent) as a http/ajax library:\n   *\n   * ```js\n   * function onDrop(acceptedFiles) {\n   *   const req = request.post('/upload')\n   *   acceptedFiles.forEach(file => {\n   *     req.attach(file.name, file)\n   *   })\n   *   req.end(callback)\n   * }\n   * ```\n   *\n   * @param {File[]} acceptedFiles\n   * @param {File[]} rejectedFiles\n   * @param {(DragEvent|Event)} event A drag event or input change event (if files were selected via the file dialog)\n   */\n  onDrop: PropTypes.func,\n\n  /**\n   * Cb for when the `drop` event occurs.\n   * Note that if no files are accepted, this callback is not invoked.\n   *\n   * @param {File[]} files\n   * @param {(DragEvent|Event)} event\n   */\n  onDropAccepted: PropTypes.func,\n\n  /**\n   * Cb for when the `drop` event occurs.\n   * Note that if no files are rejected, this callback is not invoked.\n   *\n   * @param {object[]} files\n   * @param {(DragEvent|Event)} event\n   */\n  onDropRejected: PropTypes.func\n};\nexport default Dropzone;\n/**\n * A function that is invoked for the `dragenter`,\n * `dragover` and `dragleave` events.\n * It is not invoked if the items are not files (such as link, text, etc.).\n *\n * @callback dragCb\n * @param {DragEvent} event\n */\n\n/**\n * A function that is invoked for the `drop` or input change event.\n * It is not invoked if the items are not files (such as link, text, etc.).\n *\n * @callback dropCb\n * @param {File[]} acceptedFiles List of accepted files\n * @param {File[]} rejectedFiles List of rejected files\n * @param {(DragEvent|Event)} event A drag event or input change event (if files were selected via the file dialog)\n */\n\n/**\n * A function that is invoked for the `drop` or input change event.\n * It is not invoked if the items are files (such as link, text, etc.).\n *\n * @callback dropAcceptedCb\n * @param {File[]} files List of accepted files that meet the given criteria\n * (`accept`, `multiple`, `minSize`, `maxSize`)\n * @param {(DragEvent|Event)} event A drag event or input change event (if files were selected via the file dialog)\n */\n\n/**\n * A function that is invoked for the `drop` or input change event.\n *\n * @callback dropRejectedCb\n * @param {File[]} files List of rejected files that do not meet the given criteria\n * (`accept`, `multiple`, `minSize`, `maxSize`)\n * @param {(DragEvent|Event)} event A drag event or input change event (if files were selected via the file dialog)\n */\n\n/**\n * A function that is used aggregate files,\n * in a asynchronous fashion, from drag or input change events.\n *\n * @callback getFilesFromEvent\n * @param {(DragEvent|Event)} event A drag event or input change event (if files were selected via the file dialog)\n * @returns {(File[]|Promise<File[]>)}\n */\n\n/**\n * An object with the current dropzone state and some helper functions.\n *\n * @typedef {object} DropzoneState\n * @property {Function} getRootProps Returns the props you should apply to the root drop container you render\n * @property {Function} getInputProps Returns the props you should apply to hidden file input you render\n * @property {Function} open Open the native file selection dialog\n * @property {boolean} isFocused Dropzone area is in focus\n * @property {boolean} isFileDialogActive File dialog is opened\n * @property {boolean} isDragActive Active drag is in progress\n * @property {boolean} isDragAccept Dragged files are accepted\n * @property {boolean} isDragReject Some dragged files are rejected\n * @property {File[]} draggedFiles Files in active drag\n * @property {File[]} acceptedFiles Accepted files\n * @property {File[]} rejectedFiles Rejected files\n */\n\nvar initialState = {\n  isFocused: false,\n  isFileDialogActive: false,\n  isDragActive: false,\n  isDragAccept: false,\n  isDragReject: false,\n  draggedFiles: [],\n  acceptedFiles: [],\n  rejectedFiles: []\n};\n/**\n * A React hook that creates a drag 'n' drop area.\n *\n * ```jsx\n * function MyDropzone(props) {\n *   const {getRootProps, getInputProps} = useDropzone({\n *     onDrop: acceptedFiles => {\n *       // do something with the File objects, e.g. upload to some server\n *     }\n *   });\n *   return (\n *     <div {...getRootProps()}>\n *       <input {...getInputProps()} />\n *       <p>Drag and drop some files here, or click to select files</p>\n *     </div>\n *   )\n * }\n * ```\n *\n * @function useDropzone\n *\n * @param {object} props\n * @param {string|string[]} [props.accept] Set accepted file types.\n * See https://github.com/okonet/attr-accept for more information.\n * Keep in mind that mime type determination is not reliable across platforms. CSV files,\n * for example, are reported as text/plain under macOS but as application/vnd.ms-excel under\n * Windows. In some cases there might not be a mime type set at all.\n * See: https://github.com/react-dropzone/react-dropzone/issues/276\n * @param {boolean} [props.multiple=true] Allow drag 'n' drop (or selection from the file dialog) of multiple files\n * @param {boolean} [props.preventDropOnDocument=true] If false, allow dropped items to take over the current browser window\n * @param {boolean} [props.noClick=false] If true, disables click to open the native file selection dialog\n * @param {boolean} [props.noKeyboard=false] If true, disables SPACE/ENTER to open the native file selection dialog.\n * Note that it also stops tracking the focus state.\n * @param {boolean} [props.noDrag=false] If true, disables drag 'n' drop\n * @param {boolean} [props.noDragEventsBubbling=false] If true, stops drag event propagation to parents\n * @param {number} [props.minSize=0] Minimum file size (in bytes)\n * @param {number} [props.maxSize=Infinity] Maximum file size (in bytes)\n * @param {boolean} [props.disabled=false] Enable/disable the dropzone\n * @param {getFilesFromEvent} [props.getFilesFromEvent] Use this to provide a custom file aggregator\n * @param {Function} [props.onFileDialogCancel] Cb for when closing the file dialog with no selection\n * @param {dragCb} [props.onDragEnter] Cb for when the `dragenter` event occurs.\n * @param {dragCb} [props.onDragLeave] Cb for when the `dragleave` event occurs\n * @param {dragCb} [props.onDragOver] Cb for when the `dragover` event occurs\n * @param {dropCb} [props.onDrop] Cb for when the `drop` event occurs.\n * Note that this callback is invoked after the `getFilesFromEvent` callback is done.\n *\n * Files are accepted or rejected based on the `accept`, `multiple`, `minSize` and `maxSize` props.\n * `accept` must be a valid [MIME type](http://www.iana.org/assignments/media-types/media-types.xhtml) according to [input element specification](https://www.w3.org/wiki/HTML/Elements/input/file) or a valid file extension.\n * If `multiple` is set to false and additional files are droppped,\n * all files besides the first will be rejected.\n * Any file which does not have a size in the [`minSize`, `maxSize`] range, will be rejected as well.\n *\n * Note that the `onDrop` callback will always be invoked regardless if the dropped files were accepted or rejected.\n * If you'd like to react to a specific scenario, use the `onDropAccepted`/`onDropRejected` props.\n *\n * `onDrop` will provide you with an array of [File](https://developer.mozilla.org/en-US/docs/Web/API/File) objects which you can then process and send to a server.\n * For example, with [SuperAgent](https://github.com/visionmedia/superagent) as a http/ajax library:\n *\n * ```js\n * function onDrop(acceptedFiles) {\n *   const req = request.post('/upload')\n *   acceptedFiles.forEach(file => {\n *     req.attach(file.name, file)\n *   })\n *   req.end(callback)\n * }\n * ```\n * @param {dropAcceptedCb} [props.onDropAccepted]\n * @param {dropRejectedCb} [props.onDropRejected]\n *\n * @returns {DropzoneState}\n */\n\nexport function useDropzone() {\n  var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      accept = _ref2.accept,\n      _ref2$disabled = _ref2.disabled,\n      disabled = _ref2$disabled === void 0 ? false : _ref2$disabled,\n      _ref2$getFilesFromEve = _ref2.getFilesFromEvent,\n      getFilesFromEvent = _ref2$getFilesFromEve === void 0 ? fromEvent : _ref2$getFilesFromEve,\n      _ref2$maxSize = _ref2.maxSize,\n      maxSize = _ref2$maxSize === void 0 ? Infinity : _ref2$maxSize,\n      _ref2$minSize = _ref2.minSize,\n      minSize = _ref2$minSize === void 0 ? 0 : _ref2$minSize,\n      _ref2$multiple = _ref2.multiple,\n      multiple = _ref2$multiple === void 0 ? true : _ref2$multiple,\n      onDragEnter = _ref2.onDragEnter,\n      onDragLeave = _ref2.onDragLeave,\n      onDragOver = _ref2.onDragOver,\n      onDrop = _ref2.onDrop,\n      onDropAccepted = _ref2.onDropAccepted,\n      onDropRejected = _ref2.onDropRejected,\n      onFileDialogCancel = _ref2.onFileDialogCancel,\n      _ref2$preventDropOnDo = _ref2.preventDropOnDocument,\n      preventDropOnDocument = _ref2$preventDropOnDo === void 0 ? true : _ref2$preventDropOnDo,\n      _ref2$noClick = _ref2.noClick,\n      noClick = _ref2$noClick === void 0 ? false : _ref2$noClick,\n      _ref2$noKeyboard = _ref2.noKeyboard,\n      noKeyboard = _ref2$noKeyboard === void 0 ? false : _ref2$noKeyboard,\n      _ref2$noDrag = _ref2.noDrag,\n      noDrag = _ref2$noDrag === void 0 ? false : _ref2$noDrag,\n      _ref2$noDragEventsBub = _ref2.noDragEventsBubbling,\n      noDragEventsBubbling = _ref2$noDragEventsBub === void 0 ? false : _ref2$noDragEventsBub;\n\n  var rootRef = useRef(null);\n  var inputRef = useRef(null);\n\n  var _useReducer = useReducer(reducer, initialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var isFocused = state.isFocused,\n      isFileDialogActive = state.isFileDialogActive,\n      draggedFiles = state.draggedFiles; // Fn for opening the file dialog programmatically\n\n  var openFileDialog = useCallback(function () {\n    if (inputRef.current) {\n      dispatch({\n        type: 'openDialog'\n      });\n      inputRef.current.value = null;\n      inputRef.current.click();\n    }\n  }, [dispatch]); // Update file dialog active state when the window is focused on\n\n  var onWindowFocus = function onWindowFocus() {\n    // Execute the timeout only if the file dialog is opened in the browser\n    if (isFileDialogActive) {\n      setTimeout(function () {\n        if (inputRef.current) {\n          var files = inputRef.current.files;\n\n          if (!files.length) {\n            dispatch({\n              type: 'closeDialog'\n            });\n\n            if (typeof onFileDialogCancel === 'function') {\n              onFileDialogCancel();\n            }\n          }\n        }\n      }, 300);\n    }\n  };\n\n  useEffect(function () {\n    window.addEventListener('focus', onWindowFocus, false);\n    return function () {\n      window.removeEventListener('focus', onWindowFocus, false);\n    };\n  }, [inputRef, isFileDialogActive, onFileDialogCancel]); // Cb to open the file dialog when SPACE/ENTER occurs on the dropzone\n\n  var onKeyDownCb = useCallback(function (event) {\n    // Ignore keyboard events bubbling up the DOM tree\n    if (!rootRef.current || !rootRef.current.isEqualNode(event.target)) {\n      return;\n    }\n\n    if (event.keyCode === 32 || event.keyCode === 13) {\n      event.preventDefault();\n      openFileDialog();\n    }\n  }, [rootRef, inputRef]); // Update focus state for the dropzone\n\n  var onFocusCb = useCallback(function () {\n    dispatch({\n      type: 'focus'\n    });\n  }, []);\n  var onBlurCb = useCallback(function () {\n    dispatch({\n      type: 'blur'\n    });\n  }, []); // Cb to open the file dialog when click occurs on the dropzone\n\n  var onClickCb = useCallback(function () {\n    if (noClick) {\n      return;\n    } // In IE11/Edge the file-browser dialog is blocking, therefore, use setTimeout()\n    // to ensure React can handle state changes\n    // See: https://github.com/react-dropzone/react-dropzone/issues/450\n\n\n    if (isIeOrEdge()) {\n      setTimeout(openFileDialog, 0);\n    } else {\n      openFileDialog();\n    }\n  }, [inputRef, noClick]);\n  var dragTargetsRef = useRef([]);\n\n  var onDocumentDrop = function onDocumentDrop(event) {\n    if (rootRef.current && rootRef.current.contains(event.target)) {\n      // If we intercepted an event for our instance, let it propagate down to the instance's onDrop handler\n      return;\n    }\n\n    event.preventDefault();\n    dragTargetsRef.current = [];\n  };\n\n  useEffect(function () {\n    if (preventDropOnDocument) {\n      document.addEventListener('dragover', onDocumentDragOver, false);\n      document.addEventListener('drop', onDocumentDrop, false);\n    }\n\n    return function () {\n      if (preventDropOnDocument) {\n        document.removeEventListener('dragover', onDocumentDragOver);\n        document.removeEventListener('drop', onDocumentDrop);\n      }\n    };\n  }, [rootRef, preventDropOnDocument]);\n  var onDragEnterCb = useCallback(function (event) {\n    event.preventDefault(); // Persist here because we need the event later after getFilesFromEvent() is done\n\n    event.persist();\n    stopPropagation(event); // Count the dropzone and any children that are entered.\n\n    if (dragTargetsRef.current.indexOf(event.target) === -1) {\n      dragTargetsRef.current = [].concat(_toConsumableArray(dragTargetsRef.current), [event.target]);\n    }\n\n    if (isEvtWithFiles(event)) {\n      Promise.resolve(getFilesFromEvent(event)).then(function (draggedFiles) {\n        if (isPropagationStopped(event) && !noDragEventsBubbling) {\n          return;\n        }\n\n        dispatch({\n          draggedFiles: draggedFiles,\n          isDragActive: true,\n          type: 'setDraggedFiles'\n        });\n\n        if (onDragEnter) {\n          onDragEnter(event);\n        }\n      });\n    }\n  }, [getFilesFromEvent, onDragEnter, noDragEventsBubbling]);\n  var onDragOverCb = useCallback(function (event) {\n    event.preventDefault();\n    event.persist();\n    stopPropagation(event);\n\n    if (event.dataTransfer) {\n      try {\n        event.dataTransfer.dropEffect = 'copy';\n      } catch (_unused) {}\n      /* eslint-disable-line no-empty */\n\n    }\n\n    if (isEvtWithFiles(event) && onDragOver) {\n      onDragOver(event);\n    }\n\n    return false;\n  }, [onDragOver, noDragEventsBubbling]);\n  var onDragLeaveCb = useCallback(function (event) {\n    event.preventDefault();\n    event.persist();\n    stopPropagation(event); // Only deactivate once the dropzone and all children have been left\n\n    var targets = dragTargetsRef.current.filter(function (target) {\n      return target !== event.target && rootRef.current && rootRef.current.contains(target);\n    });\n    dragTargetsRef.current = targets;\n\n    if (targets.length > 0) {\n      return;\n    }\n\n    dispatch({\n      isDragActive: false,\n      type: 'setDraggedFiles',\n      draggedFiles: []\n    });\n\n    if (isEvtWithFiles(event) && onDragLeave) {\n      onDragLeave(event);\n    }\n  }, [rootRef, onDragLeave, noDragEventsBubbling]);\n  var onDropCb = useCallback(function (event) {\n    event.preventDefault(); // Persist here because we need the event later after getFilesFromEvent() is done\n\n    event.persist();\n    stopPropagation(event);\n    dragTargetsRef.current = [];\n\n    if (isEvtWithFiles(event)) {\n      Promise.resolve(getFilesFromEvent(event)).then(function (files) {\n        if (isPropagationStopped(event) && !noDragEventsBubbling) {\n          return;\n        }\n\n        var acceptedFiles = [];\n        var rejectedFiles = [];\n        files.forEach(function (file) {\n          if (fileAccepted(file, accept) && fileMatchSize(file, minSize, maxSize)) {\n            acceptedFiles.push(file);\n          } else {\n            rejectedFiles.push(file);\n          }\n        });\n\n        if (!multiple && acceptedFiles.length > 1) {\n          rejectedFiles.push.apply(rejectedFiles, _toConsumableArray(acceptedFiles.splice(0))); // Reject everything and empty accepted files\n        }\n\n        dispatch({\n          acceptedFiles: acceptedFiles,\n          rejectedFiles: rejectedFiles,\n          type: 'setFiles'\n        });\n\n        if (onDrop) {\n          onDrop(acceptedFiles, rejectedFiles, event);\n        }\n\n        if (rejectedFiles.length > 0 && onDropRejected) {\n          onDropRejected(rejectedFiles, event);\n        }\n\n        if (acceptedFiles.length > 0 && onDropAccepted) {\n          onDropAccepted(acceptedFiles, event);\n        }\n      });\n    }\n\n    dispatch({\n      type: 'reset'\n    });\n  }, [multiple, accept, minSize, maxSize, getFilesFromEvent, onDrop, onDropAccepted, onDropRejected, noDragEventsBubbling]);\n\n  var composeHandler = function composeHandler(fn) {\n    return disabled ? null : fn;\n  };\n\n  var composeKeyboardHandler = function composeKeyboardHandler(fn) {\n    return noKeyboard ? null : composeHandler(fn);\n  };\n\n  var composeDragHandler = function composeDragHandler(fn) {\n    return noDrag ? null : composeHandler(fn);\n  };\n\n  var stopPropagation = function stopPropagation(event) {\n    if (noDragEventsBubbling) {\n      event.stopPropagation();\n    }\n  };\n\n  var getRootProps = useMemo(function () {\n    return function () {\n      var _ref3 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          _ref3$refKey = _ref3.refKey,\n          refKey = _ref3$refKey === void 0 ? 'ref' : _ref3$refKey,\n          onKeyDown = _ref3.onKeyDown,\n          onFocus = _ref3.onFocus,\n          onBlur = _ref3.onBlur,\n          onClick = _ref3.onClick,\n          onDragEnter = _ref3.onDragEnter,\n          onDragOver = _ref3.onDragOver,\n          onDragLeave = _ref3.onDragLeave,\n          onDrop = _ref3.onDrop,\n          rest = _objectWithoutProperties(_ref3, [\"refKey\", \"onKeyDown\", \"onFocus\", \"onBlur\", \"onClick\", \"onDragEnter\", \"onDragOver\", \"onDragLeave\", \"onDrop\"]);\n\n      return _objectSpread(_defineProperty({\n        onKeyDown: composeKeyboardHandler(composeEventHandlers(onKeyDown, onKeyDownCb)),\n        onFocus: composeKeyboardHandler(composeEventHandlers(onFocus, onFocusCb)),\n        onBlur: composeKeyboardHandler(composeEventHandlers(onBlur, onBlurCb)),\n        onClick: composeHandler(composeEventHandlers(onClick, onClickCb)),\n        onDragEnter: composeDragHandler(composeEventHandlers(onDragEnter, onDragEnterCb)),\n        onDragOver: composeDragHandler(composeEventHandlers(onDragOver, onDragOverCb)),\n        onDragLeave: composeDragHandler(composeEventHandlers(onDragLeave, onDragLeaveCb)),\n        onDrop: composeDragHandler(composeEventHandlers(onDrop, onDropCb))\n      }, refKey, rootRef), !disabled && !noKeyboard ? {\n        tabIndex: 0\n      } : {}, {}, rest);\n    };\n  }, [rootRef, onKeyDownCb, onFocusCb, onBlurCb, onClickCb, onDragEnterCb, onDragOverCb, onDragLeaveCb, onDropCb, noKeyboard, noDrag, disabled]);\n  var onInputElementClick = useCallback(function (event) {\n    event.stopPropagation();\n  }, []);\n  var getInputProps = useMemo(function () {\n    return function () {\n      var _ref4 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          _ref4$refKey = _ref4.refKey,\n          refKey = _ref4$refKey === void 0 ? 'ref' : _ref4$refKey,\n          onChange = _ref4.onChange,\n          onClick = _ref4.onClick,\n          rest = _objectWithoutProperties(_ref4, [\"refKey\", \"onChange\", \"onClick\"]);\n\n      var inputProps = _defineProperty({\n        accept: accept,\n        multiple: multiple,\n        type: 'file',\n        style: {\n          display: 'none'\n        },\n        onChange: composeHandler(composeEventHandlers(onChange, onDropCb)),\n        onClick: composeHandler(composeEventHandlers(onClick, onInputElementClick)),\n        autoComplete: 'off',\n        tabIndex: -1\n      }, refKey, inputRef);\n\n      return _objectSpread({}, inputProps, {}, rest);\n    };\n  }, [inputRef, accept, multiple, onDropCb, disabled]);\n  var fileCount = draggedFiles.length;\n  var isDragAccept = fileCount > 0 && allFilesAccepted({\n    files: draggedFiles,\n    accept: accept,\n    minSize: minSize,\n    maxSize: maxSize,\n    multiple: multiple\n  });\n  var isDragReject = fileCount > 0 && !isDragAccept;\n  return _objectSpread({}, state, {\n    isDragAccept: isDragAccept,\n    isDragReject: isDragReject,\n    isFocused: isFocused && !disabled,\n    getRootProps: getRootProps,\n    getInputProps: getInputProps,\n    rootRef: rootRef,\n    inputRef: inputRef,\n    open: composeHandler(openFileDialog)\n  });\n}\n\nfunction reducer(state, action) {\n  /* istanbul ignore next */\n  switch (action.type) {\n    case 'focus':\n      return _objectSpread({}, state, {\n        isFocused: true\n      });\n\n    case 'blur':\n      return _objectSpread({}, state, {\n        isFocused: false\n      });\n\n    case 'openDialog':\n      return _objectSpread({}, state, {\n        isFileDialogActive: true\n      });\n\n    case 'closeDialog':\n      return _objectSpread({}, state, {\n        isFileDialogActive: false\n      });\n\n    case 'setDraggedFiles':\n      /* eslint no-case-declarations: 0 */\n      var isDragActive = action.isDragActive,\n          draggedFiles = action.draggedFiles;\n      return _objectSpread({}, state, {\n        draggedFiles: draggedFiles,\n        isDragActive: isDragActive\n      });\n\n    case 'setFiles':\n      return _objectSpread({}, state, {\n        acceptedFiles: action.acceptedFiles,\n        rejectedFiles: action.rejectedFiles\n      });\n\n    case 'reset':\n      return _objectSpread({}, state, {\n        isFileDialogActive: false,\n        isDragActive: false,\n        draggedFiles: [],\n        acceptedFiles: [],\n        rejectedFiles: []\n      });\n\n    default:\n      return state;\n  }\n}","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { useDropzone } from 'react-dropzone'\nimport { Button, useToast } from '@aragon/ui'\nimport { isString } from '../../../util/utils'\nimport { isAddress } from '../../../util/web3'\n\n// What is the answer to the ultimate question of Life, the Universe, and Everything?\nconst MAX_LENGTH = 42\n\nconst verifyLocalIdentityObject = obj => {\n  return (\n    Array.isArray(obj) &&\n    obj.every(\n      ({ address, name, createdAt }) =>\n        isAddress(address.trim()) &&\n        !!createdAt &&\n        !!name.trim() &&\n        isString(name) &&\n        name.length <= MAX_LENGTH\n    )\n  )\n}\n\nconst fileImport = (cb, toast) => files => {\n  if (!files || !files.length) {\n    return\n  }\n\n  const reader = new FileReader()\n  reader.onload = event => {\n    try {\n      const list = JSON.parse(event.target.result)\n      if (verifyLocalIdentityObject(list)) {\n        toast('Custom labels imported successfully')\n        cb(list)\n      } else {\n        throw new Error('There was an error reading from the file')\n      }\n    } catch (e) {\n      console.warn(e)\n    }\n  }\n  reader.readAsText(files[0])\n}\n\nconst Import = ({ onImport, button }) => {\n  const toast = useToast()\n  const { getRootProps, getInputProps } = useDropzone({\n    onDrop: fileImport(onImport, toast),\n    multiple: false,\n  })\n\n  return (\n    <label\n      {...getRootProps()}\n      css={`\n        position: relative;\n        display: inline-block;\n        &:focus,\n        &:active {\n          outline: none;\n        }\n      `}\n    >\n      <input\n        {...getInputProps()}\n        css={`\n          position: absolute;\n          z-index: 1;\n          display: inline-block;\n          opacity: 0;\n          height: 100%;\n          width: 100%;\n        `}\n      />\n      {button || (\n        <Button label=\"Import labels\" mode=\"strong\">\n          Import labels\n        </Button>\n      )}\n    </label>\n  )\n}\n\nImport.propTypes = {\n  button: PropTypes.node,\n  onImport: PropTypes.func.isRequired,\n}\n\nexport { fileImport }\nexport default Import\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { Box, GU, IdentityBadge, Info, useTheme } from '@aragon/ui'\nimport { getEmptyAddress } from '../../../util/web3'\nimport Import from './Import'\n\nfunction EmptyIdentities({ onImport }) {\n  const theme = useTheme()\n\n  return (\n    <Box>\n      <div>\n        You can add labels by clicking on an{' '}\n        <span\n          css={`\n            display: inline-flex;\n            margin-right: 2px;\n            vertical-align: text-bottom;\n            position: relative;\n            top: 3px;\n          `}\n        >\n          <IdentityBadge\n            css={`\n              color: ${theme.content};\n            `}\n            entity={getEmptyAddress()}\n            label=\"Address badge\"\n            compact\n            badgeOnly\n          />\n        </span>\n        anywhere in the app, or importing a{' '}\n        <span\n          css={`\n            color: ${theme.help};\n          `}\n        >\n          JSON file\n        </span>{' '}\n        with labels by clicking the button below.\n      </div>\n      <div\n        css={`\n          margin: ${2 * GU}px 0;\n        `}\n      >\n        <Import onImport={onImport} />\n      </div>\n      <Info>\n        Any labels you add or import will only be shown on this device, and not\n        stored anywhere else. If you want to share the labels with other devices\n        or users, you will need to export them and share the .json file.\n      </Info>\n    </Box>\n  )\n}\n\nEmptyIdentities.propTypes = {\n  onImport: PropTypes.func.isRequired,\n}\n\nexport default React.memo(EmptyIdentities)\n","import React, { useCallback, useEffect, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Button,\n  GU,\n  IconCross,\n  IconSearch,\n  SearchInput,\n  useTheme,\n  useLayout,\n  textStyle,\n} from '@aragon/ui'\n\nconst SEARCH_CLOSED = Symbol('closed')\nconst SEARCH_OPEN = Symbol('open')\nconst EMPTY = ''\n\nfunction getDefaultSearchState(compact) {\n  return compact ? SEARCH_CLOSED : SEARCH_OPEN\n}\n\nconst Search = React.memo(function Search({ onChange, value }) {\n  const { layoutName } = useLayout()\n  const compact = layoutName === 'small'\n  const theme = useTheme()\n\n  const [mode, setMode] = useState(getDefaultSearchState(compact))\n  const open = useCallback(() => setMode(SEARCH_OPEN), [setMode])\n\n  const searchInputRef = useRef()\n\n  const clear = useCallback(() => {\n    setMode(getDefaultSearchState(compact))\n    onChange(EMPTY)\n  }, [onChange, compact])\n\n  useEffect(() => {\n    setMode(getDefaultSearchState(compact))\n  }, [compact])\n\n  useEffect(() => {\n    if (mode === SEARCH_OPEN && searchInputRef.current) {\n      searchInputRef.current.focus()\n    }\n  }, [mode])\n\n  if (mode === SEARCH_CLOSED) {\n    return (\n      <Button\n        display=\"icon\"\n        icon={<IconSearch />}\n        label=\"Search\"\n        onClick={open}\n      />\n    )\n  }\n\n  const searchInputExtraProps = compact\n    ? {\n        adornment: (\n          <Button\n            display=\"icon\"\n            icon={<IconCross />}\n            label=\"Clear search input\"\n            onClick={clear}\n          />\n        ),\n        wide: true,\n      }\n    : {}\n\n  return (\n    <div\n      css={`\n        position: relative;\n\n        ${compact\n          ? `\n            position: absolute;\n            top: 0;\n            left: 0;\n            padding: ${2 * GU}px;\n            right: 0;\n            background: ${theme.surface};\n            z-index: 1;\n          `\n          : ''}\n      `}\n    >\n      <SearchInput\n        ref={searchInputRef}\n        onChange={onChange}\n        placeholder=\"Search\"\n        value={value}\n        {...searchInputExtraProps}\n        css={`\n          ${compact ? '' : `width: ${30 * GU}px`};\n          ${textStyle('body2')};\n          color: ${value ? theme.surfaceContent : theme.hint};\n        `}\n      />\n    </div>\n  )\n})\n\nSearch.propTypes = {\n  onChange: PropTypes.func.isRequired,\n  value: PropTypes.string.isRequired,\n}\n\nexport default Search\n","import { useMemo, useState } from 'react'\n\nconst ASC = Symbol('asc')\nconst DESC = Symbol('desc')\nconst sortDesc = (a, b) => b.name.localeCompare(a.name)\nconst sortAsc = (a, b) => a.name.localeCompare(b.name)\n\nfunction useSort(filteredIdentities) {\n  const [sort, setSort] = useState(ASC)\n  const sortedIdentities = useMemo(\n    () => filteredIdentities.sort(sort === ASC ? sortAsc : sortDesc),\n    [filteredIdentities, sort]\n  )\n  return {\n    sortedIdentities,\n    sort,\n    handleToggleSort: () => setSort(sort === ASC ? DESC : ASC),\n  }\n}\n\nexport { ASC, DESC }\nexport default useSort\n","import React, { useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport {\n  Button,\n  ButtonBase,\n  DataView,\n  DropDown,\n  GU,\n  IconArrowDown,\n  IconArrowUp,\n  IconDownload,\n  IconExternal,\n  IconGrid,\n  IconShare,\n  IconTrash,\n  Info,\n  useTheme,\n  useLayout,\n  useToast,\n  textStyle,\n} from '@aragon/ui'\nimport Search from './Search'\nimport Import from './Import'\nimport LocalIdentityBadge from '../../IdentityBadge/LocalIdentityBadge'\nimport { ASC, DESC } from './useSort'\nimport { iOS } from '../../../util/utils'\n\nconst LocalIdentities = React.memo(function LocalIdentities({\n  allSelected,\n  identities,\n  identitiesSelected,\n  onClear,\n  onExport,\n  onImport,\n  onRemove,\n  onSearchChange,\n  onShare,\n  onShowLocalIdentityModal,\n  onToggleAll,\n  onToggleIdentity,\n  onToggleSort,\n  searchTerm,\n  someSelected,\n  sort,\n}) {\n  const { layoutName } = useLayout()\n  const compact = layoutName === 'small'\n  const theme = useTheme()\n\n  return (\n    <React.Fragment>\n      <Info\n        css={`\n          margin: 0 ${compact ? `${2 * GU}px` : 0} ${2 * GU}px;\n          margin-bottom: ${2 * GU}px;\n        `}\n      >\n        Any labels you add or import will only be shown on this device, and not\n        stored anywhere else. If you want to share the labels with other devices\n        or users, you will need to export them and share the .json file.\n      </Info>\n      <DataView\n        mode=\"table\"\n        status={identities.length > 0 ? 'default' : 'empty-search'}\n        onStatusEmptyClear={onClear}\n        heading={\n          <Filters\n            searchTerm={searchTerm}\n            onSearchChange={onSearchChange}\n            onImport={onImport}\n            onShare={onShare}\n            onExport={onExport}\n            onRemove={onRemove}\n            someSelected={someSelected}\n          />\n        }\n        selection={identities.reduce(\n          (p, { address }, index) => [\n            ...p,\n            ...(identitiesSelected.get(address) ? [index] : []),\n          ],\n          []\n        )}\n        onSelectEntries={(_, indexes) => {\n          // toggle all\n          if (\n            ((allSelected || !someSelected) &&\n              identities.length === indexes.length) ||\n            indexes.length === 0\n          ) {\n            onToggleAll()\n            return\n          }\n\n          // toggle some (in reality only one but same process)\n          identities\n            .filter(\n              ({ address }, index) =>\n                indexes.includes(index) !== identitiesSelected.get(address)\n            )\n            .map(({ address }) => address)\n            .forEach(onToggleIdentity)\n        }}\n        fields={[\n          <div\n            css={`\n              display: inline-flex;\n              align-items: center;\n              height: 16px;\n            `}\n          >\n            <ButtonBase\n              label=\"Toggle sort\"\n              onClick={onToggleSort}\n              css={`\n                padding: ${0.5 * GU}px ${3 * GU}px;\n                position: relative;\n                left: ${-3 * GU}px;\n                border-radius: 0;\n                display: flex;\n                align-items: center;\n                &:active {\n                  background: ${theme.surfaceSelected};\n                }\n              `}\n            >\n              <span\n                css={`\n                  margin-right: ${1 * GU}px;\n                  ${textStyle('label2')}\n                `}\n              >\n                Custom label{' '}\n              </span>\n              {sort === ASC ? (\n                <IconArrowDown size=\"small\" />\n              ) : (\n                <IconArrowUp size=\"small\" />\n              )}\n            </ButtonBase>\n          </div>,\n          'Address',\n        ]}\n        entries={identities}\n        renderEntry={({ address, name }) => [\n          <span\n            css={`\n              width: ${compact ? `${21 * GU}px` : '100%'};\n              white-space: nowrap;\n              overflow: hidden;\n              text-overflow: ellipsis;\n            `}\n          >\n            {name}\n          </span>,\n          <LocalIdentityBadge entity={address} forceAddress />,\n        ]}\n        renderSelectionCount={count =>\n          `${count} label${count > 1 ? 's' : ''} selected`\n        }\n      />\n    </React.Fragment>\n  )\n})\n\nLocalIdentities.propTypes = {\n  allSelected: PropTypes.bool.isRequired,\n  identities: PropTypes.array.isRequired,\n  identitiesSelected: PropTypes.instanceOf(Map).isRequired,\n  onClear: PropTypes.func.isRequired,\n  onExport: PropTypes.func.isRequired,\n  onImport: PropTypes.func.isRequired,\n  onRemove: PropTypes.func.isRequired,\n  onSearchChange: PropTypes.func.isRequired,\n  onShare: PropTypes.func.isRequired,\n  onShowLocalIdentityModal: PropTypes.func.isRequired,\n  onToggleAll: PropTypes.func.isRequired,\n  onToggleIdentity: PropTypes.func.isRequired,\n  onToggleSort: PropTypes.func.isRequired,\n  searchTerm: PropTypes.string.isRequired,\n  someSelected: PropTypes.bool.isRequired,\n  sort: PropTypes.oneOf([ASC, DESC]).isRequired,\n}\n\nconst Filters = React.memo(function Filters({\n  onExport,\n  onImport,\n  onRemove,\n  onSearchChange,\n  onShare,\n  searchTerm,\n  someSelected,\n}) {\n  const { layoutName } = useLayout()\n  const compact = layoutName === 'small'\n\n  return (\n    <div\n      css={`\n        display: grid;\n        grid-template-columns: auto auto auto;\n        grid-gap: ${1 * GU}px;\n        align-items: center;\n        justify-content: flex-end;\n        margin-bottom: ${2 * GU}px;\n      `}\n    >\n      <Search onChange={onSearchChange} value={searchTerm} />\n      {!iOS && (\n        <Import\n          onImport={onImport}\n          button={\n            <Button\n              icon={<IconDownload />}\n              label=\"Import\"\n              display={compact ? 'icon' : 'auto'}\n            />\n          }\n        />\n      )}\n      <Actions\n        disabled={!someSelected}\n        onShare={onShare}\n        onExport={onExport}\n        onRemove={onRemove}\n      />\n    </div>\n  )\n})\n\nFilters.propTypes = {\n  onExport: PropTypes.func.isRequired,\n  onImport: PropTypes.func.isRequired,\n  onRemove: PropTypes.func.isRequired,\n  onSearchChange: PropTypes.func.isRequired,\n  onShare: PropTypes.func.isRequired,\n  searchTerm: PropTypes.string.isRequired,\n  someSelected: PropTypes.bool.isRequired,\n}\n\nconst Actions = React.memo(function Actions({\n  onExport,\n  onRemove,\n  onShare,\n  disabled,\n}) {\n  const theme = useTheme()\n  const { layoutName } = useLayout()\n  const compact = layoutName === 'small'\n  const toast = useToast()\n  const handleChange = useCallback(\n    index => {\n      if (index === 0) {\n        onShare()\n        return\n      }\n      if (!iOS && index === 1) {\n        toast('Custom labels exported successfully')\n        onExport()\n        return\n      }\n      onRemove()\n    },\n    [onShare, onExport, onRemove, toast]\n  )\n\n  return (\n    <React.Fragment>\n      <DropDown\n        css={`\n          box-shadow: ${disabled ? 'none' : '0px 1px 3px rgba(0, 0, 0, 0.1)'};\n          ${compact ? 'min-width: unset' : ''}\n        `}\n        disabled={disabled}\n        compact={compact}\n        selected={-1}\n        items={[\n          <ActionSpan\n            css={`\n              color: ${theme.surfaceContent};\n            `}\n          >\n            <IconShare\n              css={`\n                color: ${theme.surfaceIcon};\n              `}\n            />\n            <span>Share</span>\n          </ActionSpan>,\n          ...(!iOS\n            ? [\n                <ActionSpan>\n                  <IconExternal\n                    css={`\n                      color: ${theme.surfaceIcon};\n                    `}\n                  />\n                  <span>Export</span>\n                </ActionSpan>,\n              ]\n            : []),\n          <ActionSpan>\n            <IconTrash\n              css={`\n                color: ${theme.red};\n              `}\n            />\n            <span>Remove</span>\n          </ActionSpan>,\n        ]}\n        placeholder={\n          <div\n            css={`\n              height: ${3 * GU}px;\n              $textStyle('body2');\n              color: ${\n                disabled ? theme.contentSecondary : theme.surfaceContent\n              };\n\n              ${\n                !compact\n                  ? `\n                  display: grid;\n                  grid-template-columns: auto 1fr auto;\n                  grid-gap: ${1.5 * GU}px;\n                  width: 100%;\n                  align-items: center;\n                `\n                  : ''\n              }\n            `}\n          >\n            <IconGrid\n              css={`\n                color: ${theme.surfaceIcon};\n              `}\n            />\n            {!compact && <span css=\"text-align: left;\">Actions</span>}\n          </div>\n        }\n        onChange={handleChange}\n      />\n    </React.Fragment>\n  )\n})\n\nActions.propTypes = {\n  onExport: PropTypes.func.isRequired,\n  onRemove: PropTypes.func.isRequired,\n  onShare: PropTypes.func.isRequired,\n  disabled: PropTypes.bool.isRequired,\n}\n\nconst ActionSpan = styled.span`\n  display: grid;\n  align-items: center;\n  grid-template-columns: auto 1fr;\n  grid-gap: ${1 * GU}px;\n  ${textStyle('body2')};\n\n  & span {\n    text-align: left;\n  }\n`\nexport default LocalIdentities\n","import { useState, useEffect, useCallback, useRef } from 'react'\nimport { useIdentity } from '../../IdentityManager/IdentityManager'\n\nfunction useLocalIdentities(wrapper) {\n  const cancelled = useRef()\n  const { identityEvents$ } = useIdentity()\n  const [identities, setIdentities] = useState([])\n\n  const handleGetAll = useCallback(async () => {\n    if (!wrapper) {\n      return\n    }\n    const localIdentities = await wrapper.getLocalIdentities()\n    const identities = Object.entries(localIdentities).map(\n      ([address, identity]) => ({\n        ...identity,\n        address,\n      })\n    )\n    if (!cancelled.current) {\n      setIdentities(identities)\n    }\n  }, [wrapper, cancelled])\n\n  useEffect(() => {\n    cancelled.current = false\n    // first fetch\n    handleGetAll()\n    // events: all events trigger get all\n    const subscription = identityEvents$.subscribe(handleGetAll)\n    return () => {\n      cancelled.current = true\n      subscription.unsubscribe()\n    }\n  }, [handleGetAll, identityEvents$])\n\n  return { identities }\n}\n\nexport default useLocalIdentities\n","import { useState, useEffect } from 'react'\n\nfunction useFilterIdentities(identities) {\n  const [searchTerm, setSearchTerm] = useState('')\n  const [filteredIdentities, setFilteredIdentities] = useState(identities)\n\n  useEffect(() => {\n    setFilteredIdentities(\n      identities.filter(\n        ({ address, name }) =>\n          searchTerm === '' ||\n          name.toLowerCase().indexOf(searchTerm.toLowerCase()) > -1 ||\n          address.toLowerCase().indexOf(searchTerm.toLowerCase()) > -1\n      )\n    )\n  }, [searchTerm, identities])\n\n  return {\n    filteredIdentities,\n    handleSearchTermChange: setSearchTerm,\n    searchTerm,\n  }\n}\n\nexport default useFilterIdentities\n","import { useState, useMemo, useCallback, useEffect } from 'react'\nimport { useSelected } from '../../../hooks'\n\nfunction useSelectIdentities(identities, filteredIdentities) {\n  const [resetSelection, setResetSelection] = useState(true)\n  const initialSelected = useMemo(\n    () => new Map(identities.map(({ address }) => [address, true])),\n    [identities]\n  )\n  const { selected, setSelected } = useSelected(initialSelected)\n  const [allSelected, someSelected] = useMemo(\n    () => [\n      filteredIdentities.every(({ address }) => selected.get(address)),\n      filteredIdentities.some(({ address }) => selected.get(address)),\n    ],\n    [filteredIdentities, selected]\n  )\n\n  const handleToggleAll = useCallback(() => {\n    const newSelected = new Map(\n      identities.map(({ address }) => [\n        address,\n        filteredIdentities.find(item => item.address === address)\n          ? !(allSelected || someSelected)\n          : selected.get(address),\n      ])\n    )\n    setSelected(newSelected)\n  }, [\n    identities,\n    setSelected,\n    someSelected,\n    allSelected,\n    filteredIdentities,\n    selected,\n  ])\n  const handleToggleIdentity = useCallback(\n    address =>\n      setSelected(new Map([...selected, [address, !selected.get(address)]])),\n    [selected, setSelected]\n  )\n\n  useEffect(() => {\n    if (initialSelected.size && resetSelection) {\n      setResetSelection(false)\n      setSelected(initialSelected)\n    }\n  }, [initialSelected, setSelected, resetSelection])\n\n  useEffect(() => {\n    setResetSelection(true)\n  }, [identities])\n\n  return {\n    allSelected,\n    handleToggleIdentity,\n    handleToggleAll,\n    identitiesSelected: selected,\n    someSelected,\n  }\n}\n\nexport default useSelectIdentities\n","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","!function(r,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):(r=\"undefined\"!=typeof globalThis?globalThis:r||self).dayjs_plugin_relativeTime=e()}(this,(function(){\"use strict\";return function(r,e,t){r=r||{};var n=e.prototype,o={future:\"in %s\",past:\"%s ago\",s:\"a few seconds\",m:\"a minute\",mm:\"%d minutes\",h:\"an hour\",hh:\"%d hours\",d:\"a day\",dd:\"%d days\",M:\"a month\",MM:\"%d months\",y:\"a year\",yy:\"%d years\"};function i(r,e,t,o){return n.fromToBase(r,e,t,o)}t.en.relativeTime=o,n.fromToBase=function(e,n,i,d,u){for(var f,a,s,l=i.$locale().relativeTime||o,h=r.thresholds||[{l:\"s\",r:44,d:\"second\"},{l:\"m\",r:89},{l:\"mm\",r:44,d:\"minute\"},{l:\"h\",r:89},{l:\"hh\",r:21,d:\"hour\"},{l:\"d\",r:35},{l:\"dd\",r:25,d:\"day\"},{l:\"M\",r:45},{l:\"MM\",r:10,d:\"month\"},{l:\"y\",r:17},{l:\"yy\",d:\"year\"}],m=h.length,c=0;c<m;c+=1){var y=h[c];y.d&&(f=d?t(e).diff(i,y.d,!0):i.diff(e,y.d,!0));var p=(r.rounding||Math.round)(Math.abs(f));if(s=f>0,p<=y.r||!y.r){p<=1&&c>0&&(y=h[c-1]);var v=l[y.l];u&&(p=u(\"\"+p)),a=\"string\"==typeof v?v.replace(\"%d\",p):v(p,n,y.l,s);break}}if(n)return a;var M=s?l.future:l.past;return\"function\"==typeof M?M(a):M.replace(\"%s\",a)},n.to=function(r,e){return i(r,e,this,!0)},n.from=function(r,e){return i(r,e,this)};var d=function(r){return r.$u?t.utc():t()};n.toNow=function(r){return this.to(d(this),r)},n.fromNow=function(r){return this.from(d(this),r)}}}));","!function(t,s){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=s():\"function\"==typeof define&&define.amd?define(s):(t=\"undefined\"!=typeof globalThis?globalThis:t||self).dayjs_plugin_duration=s()}(this,(function(){\"use strict\";var t,s,n=1e3,i=6e4,e=36e5,r=864e5,o=/\\[([^\\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,u=31536e6,h=2592e6,a=/^(-|\\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,d={years:u,months:h,days:r,hours:e,minutes:i,seconds:n,milliseconds:1,weeks:6048e5},c=function(t){return t instanceof p},f=function(t,s,n){return new p(t,n,s.$l)},m=function(t){return s.p(t)+\"s\"},l=function(t){return t<0},$=function(t){return l(t)?Math.ceil(t):Math.floor(t)},y=function(t){return Math.abs(t)},g=function(t,s){return t?l(t)?{negative:!0,format:\"\"+y(t)+s}:{negative:!1,format:\"\"+t+s}:{negative:!1,format:\"\"}},p=function(){function l(t,s,n){var i=this;if(this.$d={},this.$l=n,void 0===t&&(this.$ms=0,this.parseFromMilliseconds()),s)return f(t*d[m(s)],this);if(\"number\"==typeof t)return this.$ms=t,this.parseFromMilliseconds(),this;if(\"object\"==typeof t)return Object.keys(t).forEach((function(s){i.$d[m(s)]=t[s]})),this.calMilliseconds(),this;if(\"string\"==typeof t){var e=t.match(a);if(e){var r=e.slice(2).map((function(t){return null!=t?Number(t):0}));return this.$d.years=r[0],this.$d.months=r[1],this.$d.weeks=r[2],this.$d.days=r[3],this.$d.hours=r[4],this.$d.minutes=r[5],this.$d.seconds=r[6],this.calMilliseconds(),this}}return this}var y=l.prototype;return y.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce((function(s,n){return s+(t.$d[n]||0)*d[n]}),0)},y.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=$(t/u),t%=u,this.$d.months=$(t/h),t%=h,this.$d.days=$(t/r),t%=r,this.$d.hours=$(t/e),t%=e,this.$d.minutes=$(t/i),t%=i,this.$d.seconds=$(t/n),t%=n,this.$d.milliseconds=t},y.toISOString=function(){var t=g(this.$d.years,\"Y\"),s=g(this.$d.months,\"M\"),n=+this.$d.days||0;this.$d.weeks&&(n+=7*this.$d.weeks);var i=g(n,\"D\"),e=g(this.$d.hours,\"H\"),r=g(this.$d.minutes,\"M\"),o=this.$d.seconds||0;this.$d.milliseconds&&(o+=this.$d.milliseconds/1e3);var u=g(o,\"S\"),h=t.negative||s.negative||i.negative||e.negative||r.negative||u.negative,a=e.format||r.format||u.format?\"T\":\"\",d=(h?\"-\":\"\")+\"P\"+t.format+s.format+i.format+a+e.format+r.format+u.format;return\"P\"===d||\"-P\"===d?\"P0D\":d},y.toJSON=function(){return this.toISOString()},y.format=function(t){var n=t||\"YYYY-MM-DDTHH:mm:ss\",i={Y:this.$d.years,YY:s.s(this.$d.years,2,\"0\"),YYYY:s.s(this.$d.years,4,\"0\"),M:this.$d.months,MM:s.s(this.$d.months,2,\"0\"),D:this.$d.days,DD:s.s(this.$d.days,2,\"0\"),H:this.$d.hours,HH:s.s(this.$d.hours,2,\"0\"),m:this.$d.minutes,mm:s.s(this.$d.minutes,2,\"0\"),s:this.$d.seconds,ss:s.s(this.$d.seconds,2,\"0\"),SSS:s.s(this.$d.milliseconds,3,\"0\")};return n.replace(o,(function(t,s){return s||String(i[t])}))},y.as=function(t){return this.$ms/d[m(t)]},y.get=function(t){var s=this.$ms,n=m(t);return\"milliseconds\"===n?s%=1e3:s=\"weeks\"===n?$(s/d[n]):this.$d[n],0===s?0:s},y.add=function(t,s,n){var i;return i=s?t*d[m(s)]:c(t)?t.$ms:f(t,this).$ms,f(this.$ms+i*(n?-1:1),this)},y.subtract=function(t,s){return this.add(t,s,!0)},y.locale=function(t){var s=this.clone();return s.$l=t,s},y.clone=function(){return f(this.$ms,this)},y.humanize=function(s){return t().add(this.$ms,\"ms\").locale(this.$l).fromNow(!s)},y.milliseconds=function(){return this.get(\"milliseconds\")},y.asMilliseconds=function(){return this.as(\"milliseconds\")},y.seconds=function(){return this.get(\"seconds\")},y.asSeconds=function(){return this.as(\"seconds\")},y.minutes=function(){return this.get(\"minutes\")},y.asMinutes=function(){return this.as(\"minutes\")},y.hours=function(){return this.get(\"hours\")},y.asHours=function(){return this.as(\"hours\")},y.days=function(){return this.get(\"days\")},y.asDays=function(){return this.as(\"days\")},y.weeks=function(){return this.get(\"weeks\")},y.asWeeks=function(){return this.as(\"weeks\")},y.months=function(){return this.get(\"months\")},y.asMonths=function(){return this.as(\"months\")},y.years=function(){return this.get(\"years\")},y.asYears=function(){return this.as(\"years\")},l}();return function(n,i,e){t=e,s=e().$utils(),e.duration=function(t,s){var n=e.locale();return f(t,{$l:n},s)},e.isDuration=c;var r=i.prototype.add,o=i.prototype.subtract;i.prototype.add=function(t,s){return c(t)&&(t=t.asMilliseconds()),r.bind(this)(t,s)},i.prototype.subtract=function(t,s){return c(t)&&(t=t.asMilliseconds()),o.bind(this)(t,s)}}}));","import dayjs from 'dayjs'\nimport relativeTime from 'dayjs/plugin/relativeTime'\nimport duration from 'dayjs/plugin/duration'\n\n// dayjs plugins\ndayjs.extend(relativeTime)\ndayjs.extend(duration)\n\nconst KNOWN_FORMATS = {\n  onlyDate: 'YYYY-MM-DD',\n  standard: 'ddd MMM YYYY, HH:mm:ss',\n}\n\nexport function dateFormat(date, formatName) {\n  // dayjs.format() applies ISO format by default if no format is given\n  return dayjs(date).format(KNOWN_FORMATS[formatName])\n}\n\n// Displays the difference between two dates\nexport function getRelativeTime(from, to) {\n  return dayjs(to)\n    .from(from)\n    .replace(/minutes?/, 'min')\n    .replace(/seconds?/, 'sec')\n    .trim()\n}\n\nexport function durationToHours(duration) {\n  return dayjs.duration(duration).asHours()\n}\n","// From https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa#Unicode_strings\n// ucs-2 string to base64 encoded ascii\nexport function utoa(str) {\n  return btoa(unescape(encodeURIComponent(str)))\n}\n// base64 encoded ascii to ucs-2 string\nexport function atou(str) {\n  return decodeURIComponent(escape(atob(str)))\n}\n","import { useCallback, useMemo, useState } from 'react'\nimport { saveAs } from 'file-saver'\nimport {\n  identityEventTypes,\n  useIdentity,\n} from '../../IdentityManager/IdentityManager'\nimport { dateFormat } from '../../../util/date'\nimport { log } from '../../../util/utils'\nimport { useRouting } from '../../../routing'\nimport { utoa } from '../../../util/string'\n\nfunction useIdentitiesActions({\n  filteredIdentities,\n  identitiesSelected,\n  someSelected,\n  wrapper,\n}) {\n  const { identityEvents$ } = useIdentity()\n\n  // share\n  const [shareModalOpened, setShareModalOpened] = useState(false)\n\n  const routing = useRouting()\n  const { orgAddress } = routing.mode\n\n  const shareLink = useMemo(() => {\n    const identitiesToShare = filteredIdentities.filter(({ address }) =>\n      identitiesSelected.get(address)\n    )\n    try {\n      const labels = utoa(JSON.stringify(identitiesToShare))\n      // Embed the organization address as saving labels (on the receipient's side) requires an\n      // wrapper context (that is only created on an organization path)\n      return `${window.location.origin}/#${orgAddress}${routing.path({\n        preferences: { section: 'custom-labels', data: { labels } },\n      })}`\n    } catch (err) {\n      log('Error while creating the identities sharing link:', err)\n      return ''\n    }\n  }, [filteredIdentities, identitiesSelected, orgAddress, routing])\n\n  // import\n  const handleImport = useCallback(\n    async list => {\n      if (!wrapper) {\n        return\n      }\n      await Promise.all(\n        list.map(({ name, address }) =>\n          wrapper.modifyAddressIdentity(address, { name })\n        )\n      )\n      identityEvents$.next({ type: identityEventTypes.IMPORT })\n    },\n    [wrapper, identityEvents$]\n  )\n\n  // export\n  const handleExport = useCallback(() => {\n    if (!someSelected) {\n      return\n    }\n    // standard: https://en.wikipedia.org/wiki/ISO_8601\n    const today = dateFormat(Date.now(), 'onlyDate')\n    const blob = new Blob(\n      [\n        JSON.stringify(\n          filteredIdentities.filter(({ address }) =>\n            identitiesSelected.get(address)\n          )\n        ),\n      ],\n      { type: 'text/json' }\n    )\n    saveAs(blob, `aragon-labels_${orgAddress}_${today}.json`)\n  }, [someSelected, filteredIdentities, identitiesSelected, orgAddress])\n\n  // remove\n  const [removeModalOpened, setRemoveModalOpened] = useState(false)\n  const handleRemove = useCallback(async () => {\n    if (!wrapper) {\n      return\n    }\n    const toRemove = filteredIdentities\n      .filter(({ address }) => identitiesSelected.get(address))\n      .map(({ address }) => address)\n    await wrapper.removeLocalIdentities(toRemove)\n    setRemoveModalOpened(false)\n    identityEvents$.next({\n      type: identityEventTypes.REMOVE,\n      addresses: toRemove,\n    })\n  }, [filteredIdentities, identitiesSelected, identityEvents$, wrapper])\n\n  return {\n    // share\n    handleShareModalOpen: useCallback(() => {\n      if (someSelected) {\n        setShareModalOpened(true)\n      }\n    }, [someSelected]),\n    handleShareModalClose: useCallback(() => setShareModalOpened(false), []),\n    shareModalOpened,\n    shareLink,\n    // import\n    handleImport,\n    // export\n    handleExport,\n    // remove\n    handleRemove,\n    handleRemoveModalClose: () => setRemoveModalOpened(false),\n    handleRemoveModalOpen: useCallback(() => {\n      if (someSelected) {\n        setRemoveModalOpened(true)\n      }\n    }, [someSelected]),\n    removeModalOpened,\n  }\n}\n\nexport default useIdentitiesActions\n","import { useCallback, useContext } from 'react'\nimport {\n  useIdentity,\n  identityEventTypes,\n} from '../../IdentityManager/IdentityManager'\nimport { LocalIdentityModalContext } from '../../LocalIdentityModal/LocalIdentityModalManager'\n\nfunction useLocalIdentityModal() {\n  const { identityEvents$ } = useIdentity()\n  const { showLocalIdentityModal } = useContext(LocalIdentityModalContext)\n  const handleShowLocalIdentityModal = useCallback(\n    address => async () => {\n      try {\n        await showLocalIdentityModal(address)\n        // emit event\n        identityEvents$.next({ type: identityEventTypes.MODIFY, address })\n      } catch (e) {\n        /* nothing was updated */\n      }\n    },\n    [showLocalIdentityModal, identityEvents$]\n  )\n\n  return { handleShowLocalIdentityModal }\n}\n\nexport default useLocalIdentityModal\n","import React, { useCallback } from 'react'\nimport { AragonType } from '../../../prop-types'\nimport ShareModal from './ShareModal'\nimport RemoveModal from './RemoveModal'\nimport EmptyIdentities from './EmptyIdentities'\nimport LocalIdentities from './LocalIdentities'\nimport useLocalIdentities from './useLocalIdentities'\nimport useFilterIdentities from './useFilterIdentities'\nimport useSelectIdentities from './useSelectIdentities'\nimport useIdentitiesActions from './useIdentitiesActions'\nimport useLocalIdentityModal from './useLocalIdentityModal'\nimport useSort from './useSort'\n\nfunction CustomLabels({ wrapper }) {\n  const { identities } = useLocalIdentities(wrapper)\n\n  const {\n    filteredIdentities,\n    handleSearchTermChange,\n    searchTerm,\n  } = useFilterIdentities(identities)\n\n  const {\n    allSelected,\n    handleToggleAll,\n    handleToggleIdentity,\n    identitiesSelected,\n    someSelected,\n  } = useSelectIdentities(identities, filteredIdentities)\n\n  const {\n    handleExport,\n    handleImport,\n    handleRemove,\n    handleRemoveModalClose,\n    handleRemoveModalOpen,\n    handleShareModalClose,\n    handleShareModalOpen,\n    removeModalOpened,\n    shareLink,\n    shareModalOpened,\n  } = useIdentitiesActions({\n    filteredIdentities,\n    identitiesSelected,\n    someSelected,\n    wrapper,\n  })\n\n  const { handleShowLocalIdentityModal } = useLocalIdentityModal()\n\n  const handleClearSearchTerm = useCallback(() => handleSearchTermChange(''), [\n    handleSearchTermChange,\n  ])\n\n  const { sortedIdentities, sort, handleToggleSort } = useSort(\n    filteredIdentities\n  )\n\n  return (\n    <React.Fragment>\n      <ShareModal\n        link={shareLink}\n        onClose={handleShareModalClose}\n        visible={shareModalOpened}\n      />\n      <RemoveModal\n        visible={removeModalOpened}\n        onClose={handleRemoveModalClose}\n        onConfirm={handleRemove}\n      />\n      {!identities.length && searchTerm === '' ? (\n        <EmptyIdentities onImport={handleImport} />\n      ) : (\n        <LocalIdentities\n          allSelected={allSelected}\n          identities={sortedIdentities}\n          identitiesSelected={identitiesSelected}\n          onClear={handleClearSearchTerm}\n          onExport={handleExport}\n          onImport={handleImport}\n          onRemove={handleRemoveModalOpen}\n          onSearchChange={handleSearchTermChange}\n          onShare={handleShareModalOpen}\n          onToggleAll={handleToggleAll}\n          onToggleIdentity={handleToggleIdentity}\n          onToggleSort={handleToggleSort}\n          searchTerm={searchTerm}\n          onShowLocalIdentityModal={handleShowLocalIdentityModal}\n          someSelected={someSelected}\n          sort={sort}\n        />\n      )}\n    </React.Fragment>\n  )\n}\n\nCustomLabels.propTypes = {\n  wrapper: AragonType,\n}\n\nexport default React.memo(CustomLabels)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport {\n  Box,\n  Button,\n  Checkbox,\n  IdentityBadge,\n  GU,\n  LoadingRing,\n  textStyle,\n  useTheme,\n  useViewport,\n} from '@aragon/ui'\n\nfunction SharedIdentities({\n  onSave,\n  onCancel,\n  identities,\n  isSaving,\n  selected,\n  allSelected,\n  someSelected,\n  onToggleAll,\n  onToggleIdentity,\n}) {\n  const theme = useTheme()\n  const { above } = useViewport()\n\n  return (\n    <React.Fragment>\n      <div\n        css={`\n          margin-bottom: ${3 * GU}px;\n        `}\n      >\n        These labels have been shared with you. By clicking on the â€˜Saveâ€™ button\n        below, you will make them appear on this device (labels will be stored\n        locally).\n      </div>\n      <Box padding={0}>\n        {isSaving ? (\n          <div\n            css={`\n              width: 100%;\n              height: 400px;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n            `}\n          >\n            <LoadingRing />\n            <div>Savingâ€¦</div>\n          </div>\n        ) : (\n          <React.Fragment>\n            <div\n              css={`\n                display: flex;\n                align-items: center;\n                padding: ${0.5 * GU}px ${2 * GU}px;\n              `}\n            >\n              <StyledCheckbox\n                checked={allSelected}\n                onChange={onToggleAll}\n                indeterminate={!allSelected && someSelected}\n              />\n              <span\n                css={`\n                  color: ${theme.surfaceContentSecondary};\n                  ${textStyle('label2')}\n                `}\n              >\n                {Array.from(selected.values()).reduce(\n                  (p, c) => p + Number(c),\n                  0\n                )}{' '}\n                labels selected\n              </span>\n            </div>\n            <ul\n              css={`\n                padding: 0;\n                list-style: none;\n                overflow: hidden;\n                width: 100%;\n                background: ${theme.surface};\n                z-index: 1;\n                border-top: ${theme.border};\n                border-bottom: ${theme.border};\n\n                ${above('medium') &&\n                  `\n                    max-height: 40vh;\n                    overflow: auto;\n\n                    li:first-child {\n                      border-top: none;\n                    }\n                    li:last-child {\n                      border-bottom: none;\n                    }\n                  `}\n              `}\n            >\n              {identities.map(({ address, name }) => (\n                <li\n                  key={address}\n                  css={`\n                    padding: ${2 * GU}px;\n                    display: grid;\n                    grid-template-columns: 1fr 1fr;\n                    align-items: center;\n                    border-bottom: 1px solid ${theme.border};\n                    background: ${selected.get(address)\n                      ? theme.surfaceSelected\n                      : theme.surface};\n                  `}\n                >\n                  <label\n                    css={`\n                      display: block;\n                      white-space: nowrap;\n                      overflow: hidden;\n                      text-overflow: ellipsis;\n                    `}\n                  >\n                    <StyledCheckbox\n                      checked={selected.get(address)}\n                      onChange={onToggleIdentity(address)}\n                    />\n                    {name}\n                  </label>\n                  <div css=\"text-align: right;\">\n                    <IdentityBadge entity={address} />\n                  </div>\n                </li>\n              ))}\n            </ul>\n            <div\n              css={`\n                text-align: right;\n                padding: ${2 * GU}px;\n              `}\n            >\n              <Button\n                css={`\n                  margin-right: ${2 * GU}px;\n                `}\n                onClick={onCancel}\n              >\n                Cancel\n              </Button>\n              <Button mode=\"strong\" onClick={onSave}>\n                Save labels\n              </Button>\n            </div>\n          </React.Fragment>\n        )}\n      </Box>\n    </React.Fragment>\n  )\n}\n\nSharedIdentities.propTypes = {\n  onSave: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired,\n  identities: PropTypes.array,\n  isSaving: PropTypes.bool,\n  selected: PropTypes.instanceOf(Map),\n  allSelected: PropTypes.bool,\n  someSelected: PropTypes.bool,\n  onToggleAll: PropTypes.func.isRequired,\n  onToggleIdentity: PropTypes.func.isRequired,\n}\n\nconst StyledCheckbox = styled(Checkbox)`\n  margin-right: ${3 * GU}px;\n`\n\nexport default React.memo(SharedIdentities)\n","import { useMemo, useState, useCallback, useEffect } from 'react'\nimport {\n  useIdentity,\n  identityEventTypes,\n} from '../../IdentityManager/IdentityManager'\nimport { useSelected } from '../../../hooks'\nimport { useRouting } from '../../../routing'\nimport { atou } from '../../../util/string'\n\nfunction useSharedLink({ wrapper, toast }) {\n  const { identityEvents$ } = useIdentity()\n  const [isSharedLink, setIsSharedLink] = useState(false)\n  const [isSaving, setIsSaving] = useState(false)\n  const [sharedIdentities, setSharedIdentities] = useState([])\n  const initialSelected = useMemo(\n    () => new Map(sharedIdentities.map(({ address }) => [address, true])),\n    [sharedIdentities]\n  )\n  const { selected, setSelected, someSelected, allSelected } = useSelected(\n    initialSelected\n  )\n  const routing = useRouting()\n\n  const openScreenHome = useCallback(() => {\n    routing.update(locator => ({\n      ...locator,\n      preferences: { section: 'custom-labels' },\n    }))\n  }, [routing])\n\n  const handleSharedIdentitiesSave = useCallback(async () => {\n    if (!wrapper) {\n      return\n    }\n    setIsSaving(true)\n    const list = sharedIdentities.filter(({ address }) => selected.get(address))\n    await Promise.all(\n      list.map(({ name, address }) =>\n        wrapper.modifyAddressIdentity(address, { name })\n      )\n    )\n    identityEvents$.next({ type: identityEventTypes.IMPORT })\n    toast('Custom labels added')\n    openScreenHome()\n    setIsSharedLink(false)\n    setIsSaving(false)\n  }, [\n    openScreenHome,\n    identityEvents$,\n    selected,\n    sharedIdentities,\n    toast,\n    wrapper,\n  ])\n\n  const handleSharedIdentitiesCancel = useCallback(() => {\n    openScreenHome()\n    setIsSharedLink(false)\n  }, [openScreenHome])\n\n  const handleToggleAll = useCallback(() => {\n    const newSelected = new Map(\n      sharedIdentities.map(({ address }) => [\n        address,\n        !(allSelected || someSelected),\n      ])\n    )\n    setSelected(newSelected)\n  }, [sharedIdentities, setSelected, someSelected, allSelected])\n\n  const handleToggleIdentity = useCallback(\n    address => () =>\n      setSelected(new Map([...selected, [address, !selected.get(address)]])),\n    [selected, setSelected]\n  )\n\n  useEffect(() => {\n    setSelected(initialSelected)\n  }, [initialSelected, setSelected])\n\n  useEffect(() => {\n    const { preferences } = routing\n\n    if (!preferences.data.labels) {\n      return\n    }\n\n    try {\n      const data = JSON.parse(window.decodeURI(atou(preferences.data.labels)))\n      setSharedIdentities(data.map(({ address, name }) => ({ address, name })))\n      setIsSharedLink(true)\n    } catch (e) {\n      console.warn('There was an error parsing/validating the shared data: ', e)\n    }\n  }, [routing])\n\n  return {\n    handleSharedIdentitiesCancel,\n    handleSharedIdentitiesSave,\n    isSavingSharedLink: isSaving,\n    isSharedLink,\n    sharedIdentities,\n    sharedIdentitiesSelected: selected,\n    sharedIdentitiesSomeSelected: someSelected,\n    sharedIdentitiesAllSelected: allSelected,\n    handleSharedIdentitiesToggleAll: handleToggleAll,\n    handleSharedIdentitiesToggleIdentity: handleToggleIdentity,\n  }\n}\n\nexport default useSharedLink\n","import React, { useCallback, useEffect, useRef, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  ButtonIcon,\n  GU,\n  Header,\n  IconClose,\n  Layout,\n  Tabs,\n  noop,\n  springs,\n  useTheme,\n  useToast,\n  useViewport,\n} from '@aragon/ui'\nimport { Transition, animated } from 'react-spring'\nimport { AragonType, AppType } from '../../prop-types'\nimport { useEsc } from '../../hooks'\nimport { useRouting } from '../../routing'\nimport Network from './Network/Network'\nimport Notifications from './Notifications/Notifications'\nimport CustomLabels from './CustomLabels/CustomLabels'\nimport SharedIdentities from './SharedIdentities/SharedIdentities'\nimport useSharedLink from './SharedIdentities/useSharedLink'\nimport { useWallet } from '../../contexts/wallet'\nimport { isOnEthMainnet } from '../../util/network'\n\nconst CUSTOM_LABELS_KEY = 'custom-labels'\nconst NETWORK_KEY = 'network'\nconst NOTIFICATIONS_KEY = 'notifications'\n\nconst SECTIONS = new Map([\n  [CUSTOM_LABELS_KEY, 'Custom Labels'],\n  [NETWORK_KEY, 'Network'],\n  [NOTIFICATIONS_KEY, 'Notifications'],\n])\nconst SECTION_KEYS = Array.from(SECTIONS.keys())\n\nconst AnimatedDiv = animated.div\n\nfunction GlobalPreferencesContent({\n  apps,\n  compact,\n  onNavigation,\n  menuKeys,\n  menuIndex,\n  subsection,\n  wrapper,\n}) {\n  const toast = useToast()\n  const routing = useRouting()\n\n  const {\n    isSharedLink,\n    isSavingSharedLink,\n    sharedIdentities,\n    handleSharedIdentitiesSave,\n    handleSharedIdentitiesCancel,\n    handleSharedIdentitiesToggleAll,\n    handleSharedIdentitiesToggleIdentity,\n    sharedIdentitiesSelected,\n    sharedIdentitiesAllSelected,\n    sharedIdentitiesSomeSelected,\n  } = useSharedLink({ wrapper, toast })\n\n  const closePreferences = useCallback(() => {\n    routing.update(locator => ({ ...locator, preferences: {} }))\n  }, [routing])\n\n  const handleSharedIdentitiesClose = () => {\n    handleSharedIdentitiesCancel()\n    closePreferences()\n  }\n\n  useEsc(closePreferences)\n\n  const container = useRef()\n  useEffect(() => {\n    if (container.current) {\n      container.current.focus()\n    }\n  }, [])\n\n  const menuItems = useMemo(() => {\n    return menuKeys.map(key => SECTIONS.get(key))\n  }, [menuKeys])\n\n  // no menu selected, no need to render anything\n  if (menuIndex < 0) {\n    return null\n  }\n\n  return (\n    <div ref={container} tabIndex=\"0\" css=\"outline: 0\">\n      <Layout css=\"z-index: 2\">\n        <Close\n          compact={compact}\n          onClick={\n            isSharedLink ? handleSharedIdentitiesClose : closePreferences\n          }\n        />\n        <Header\n          primary={isSharedLink ? 'Save Custom Labels' : 'Global preferences'}\n          css={`\n            padding-top: ${!compact ? 10 * GU : 0}px;\n          `}\n        />\n        {isSharedLink ? (\n          <SharedIdentities\n            isSaving={isSavingSharedLink}\n            onSave={handleSharedIdentitiesSave}\n            onCancel={handleSharedIdentitiesCancel}\n            identities={sharedIdentities}\n            onToggleAll={handleSharedIdentitiesToggleAll}\n            onToggleIdentity={handleSharedIdentitiesToggleIdentity}\n            selected={sharedIdentitiesSelected}\n            allSelected={sharedIdentitiesAllSelected}\n            someSelected={sharedIdentitiesSomeSelected}\n          />\n        ) : (\n          <React.Fragment>\n            <Tabs\n              items={menuItems}\n              onChange={wrapper ? onNavigation : noop}\n              selected={menuIndex}\n            />\n            <main>\n              {menuKeys[menuIndex] === CUSTOM_LABELS_KEY && (\n                <CustomLabels wrapper={wrapper} />\n              )}\n              {menuKeys[menuIndex] === NETWORK_KEY && (\n                <Network wrapper={wrapper} />\n              )}\n              {menuKeys[menuIndex] === NOTIFICATIONS_KEY && (\n                <Notifications\n                  apps={apps}\n                  subsection={subsection}\n                  handleNavigation={onNavigation}\n                  navigationIndex={menuIndex}\n                />\n              )}\n            </main>\n          </React.Fragment>\n        )}\n      </Layout>\n    </div>\n  )\n}\n\nGlobalPreferencesContent.propTypes = {\n  apps: PropTypes.arrayOf(AppType).isRequired,\n  compact: PropTypes.bool,\n  onNavigation: PropTypes.func.isRequired,\n  menuIndex: PropTypes.number,\n  menuKeys: PropTypes.arrayOf(PropTypes.string),\n  subsection: PropTypes.string,\n  wrapper: AragonType,\n}\n\nfunction useGlobalPreferences(wrapper) {\n  const routing = useRouting()\n  const { preferences } = routing\n  const { networkType } = useWallet()\n\n  const menuKeys = useMemo(() => {\n    // Only show network preferences if the `wrapper` does not exist yet (for example, during onboarding)\n    // Only show network preferences if on mainnet\n    const keys = SECTION_KEYS.filter(section => {\n      return (\n        (isOnEthMainnet(networkType) && section === NETWORK_KEY) ||\n        (wrapper && section !== NETWORK_KEY)\n      )\n    })\n    return keys\n  }, [wrapper, networkType])\n\n  const handleNavigation = useCallback(\n    index => {\n      routing.update(locator => ({\n        ...locator,\n        preferences: { section: menuKeys[index] },\n      }))\n    },\n    [routing, menuKeys]\n  )\n\n  const { subsection } = preferences\n\n  const menuIndex = useMemo(() => {\n    const index = menuKeys.findIndex(section => section === preferences.section)\n    return index\n  }, [menuKeys, preferences])\n\n  return {\n    menuKeys,\n    menuIndex,\n    subsection,\n    handleNavigation,\n  }\n}\n\nfunction Close({ compact, onClick }) {\n  const theme = useTheme()\n  return (\n    <div\n      css={`\n        position: absolute;\n        right: 0;\n        padding-top: ${2.5 * GU}px;\n        padding-right: ${3 * GU}px;\n\n        ${compact &&\n          `\n            padding-top: ${2 * GU}px;\n            padding-right: ${1.5 * GU}px;\n          `}\n      `}\n    >\n      <ButtonIcon onClick={onClick} label=\"Close\">\n        <IconClose\n          css={`\n            color: ${theme.surfaceIcon};\n          `}\n        />\n      </ButtonIcon>\n    </div>\n  )\n}\n\nClose.propTypes = {\n  compact: PropTypes.bool,\n  onClick: PropTypes.func.isRequired,\n}\n\nfunction GlobalPreferences(props) {\n  const {\n    menuKeys,\n    menuIndex,\n    subsection,\n    handleNavigation,\n  } = useGlobalPreferences(props.wrapper)\n\n  const { below, above } = useViewport()\n  const compact = below('medium')\n  const theme = useTheme()\n\n  return (\n    <Transition\n      native\n      items={menuIndex > -1}\n      from={{ opacity: 0, enterProgress: 0, blocking: false }}\n      enter={{ opacity: 1, enterProgress: 1, blocking: true }}\n      leave={{ opacity: 0, enterProgress: 1, blocking: false }}\n      config={springs.smooth}\n    >\n      {show =>\n        show &&\n        /* eslint-disable react/prop-types */\n        // z-index 2 on mobile keeps the menu above this preferences modal\n        (({ opacity, enterProgress, blocking }) => (\n          <AnimatedDiv\n            style={{\n              zIndex: 1,\n              pointerEvents: blocking ? 'auto' : 'none',\n              opacity,\n              transform: enterProgress.interpolate(\n                v => `\n                  translate3d(0, ${(1 - v) * 10}px, 0)\n                  scale3d(${1 - (1 - v) * 0.03}, ${1 - (1 - v) * 0.03}, 1)\n                `\n              ),\n            }}\n            css={`\n              position: fixed;\n              top: 0;\n              bottom: 0;\n              left: 0;\n              right: 0;\n              overflow: auto;\n              min-width: 360px;\n              padding-bottom: ${2 * GU}px;\n              border-top: 2px solid ${theme.accent};\n              background: ${theme.surface};\n              ${above('medium') &&\n                `\n                  padding-bottom: 0;\n                `}\n            `}\n          >\n            <GlobalPreferencesContent\n              {...props}\n              compact={compact}\n              menuKeys={menuKeys}\n              menuIndex={menuIndex}\n              subsection={subsection}\n              onNavigation={handleNavigation}\n            />\n          </AnimatedDiv>\n        ))\n      /* eslint-enable react/prop-types */\n      }\n    </Transition>\n  )\n}\n\nGlobalPreferences.propTypes = {\n  apps: PropTypes.arrayOf(AppType).isRequired,\n  wrapper: PropTypes.object,\n}\n\nexport default React.memo(GlobalPreferences)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { GU, textStyle, useTheme } from '@aragon/ui'\nimport { useNow } from '../../hooks'\nimport { getRelativeTime } from '../../util/date'\n\nfunction TimeTag({ date, label, ...props }) {\n  const theme = useTheme()\n  const now = useNow()\n  const targetDate = new Date(date)\n  return (\n    <div\n      css={`\n        max-width: ${15.75 * GU}px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        ${textStyle('label2')}\n        color: ${theme.surfaceContentSecondary};\n      `}\n      {...props}\n    >\n      {label || getRelativeTime(now, targetDate)}\n    </div>\n  )\n}\n\nTimeTag.propTypes = {\n  date: PropTypes.number.isRequired, // unix timestamp\n  label: PropTypes.node,\n}\n\nexport default TimeTag\n","export function formatNumber(num, decimals = 2) {\n  const multiplicator = Math.pow(10, decimals)\n  const roundedNum = Math.round(num * multiplicator) / multiplicator\n  const numString = String(roundedNum)\n\n  if (!decimals) {\n    return numString\n  }\n\n  const [whole, decimal = ''] = numString.split('.')\n  return `${whole}.${\n    decimal.length > decimal\n      ? decimal.slice(0, decimals)\n      : decimal.padEnd(decimals, '0')\n  }`\n}\n\n/**\n * Re-maps a number from one range to another.\n *\n * In the example above, the number '25' is converted from a value in the range\n * 0..100 into a value that ranges from the left edge (0) to the right edge\n * (width) of the screen. Numbers outside the range are not clamped to 0 and 1,\n * because out-of-range values are often intentional and useful.\n *\n * From Processing.js\n *\n * @param {Number} value The incoming value to be converted\n * @param {Number} istart Lower bound of the value's current range\n * @param {Number} istop Upper bound of the value's current range\n * @param {Number} ostart Lower bound of the value's target range\n * @param {Number} ostop Upper bound of the value's target range\n * @returns {Number} Mapped value\n */\nexport function map(value, istart, istop, ostart, ostop) {\n  return ostart + (ostop - ostart) * ((value - istart) / (istop - istart))\n}\n\n/**\n * Normalizes a number from another range into a value between 0 and 1.\n *\n * Identical to map(value, low, high, 0, 1)\n * Numbers outside the range are not clamped to 0 and 1, because out-of-range\n * values are often intentional and useful.\n *\n * From Processing.js\n *\n * @param {Number} aNumber The incoming value to be converted\n * @param {Number} low Lower bound of the value's current range\n * @param {Number} high Upper bound of the value's current range\n * @returns {Number} Normalized number\n */\nexport function norm(aNumber, low, high) {\n  return (aNumber - low) / (high - low)\n}\n\n/**\n * Calculates a number between two numbers at a specific increment. The\n * progress parameter is the amount to interpolate between the two values where\n * 0.0 equal to the first point, 0.1 is very near the first point, 0.5 is\n * half-way in between, etc. The lerp function is convenient for creating\n * motion along a straight path and for drawing dotted lines.\n *\n * From Processing.js\n *\n * @param {Number} progress Between 0.0 and 1.0\n * @param {Number} value1 First value\n * @param {Number} value2 Second value\n * @returns {Number} Increment value\n */\nexport function lerp(progress, value1, value2) {\n  return (value2 - value1) * progress + value1\n}\n\n/**\n * Constrains a value to not exceed a maximum and minimum value.\n *\n * From Processing.js\n *\n * @param {Number} aNumber The value to constrain\n * @param {Number} aMin Minimum limit\n * @param {Number} aMax Maximum limit\n * @returns {Number} Contrained value\n */\nexport function clamp(aNumber, aMin, aMax) {\n  return aNumber > aMax ? aMax : aNumber < aMin ? aMin : aNumber\n}\n\n/**\n * Returns a random integer between min (included) and max (excluded)\n * Note: Using Math.round() would give a non-uniform distribution\n *\n * From Mozilla MDN\n *\n * @param {Number} min The minimum number (included)\n * @param {Number} max The maximum number (excluded)\n * @returns {Number} Random integer\n */\nexport function randomInt(min, max) {\n  min = Math.ceil(min)\n  max = Math.floor(max)\n  return Math.floor(Math.random() * (max - min)) + min\n}\n\n/**\n * Random number between two values.\n *\n * From Mozilla MDN\n *\n * @param {Number} min The minimum number (included)\n * @param {Number} max The maximum number (excluded)\n * @returns {Number} Random number\n */\nexport function random(min = 0, max = 1) {\n  return Math.floor(Math.random() * (max - min)) + min\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { ProgressBar, GU } from '@aragon/ui'\nimport { Transition, animated } from 'react-spring'\nimport { ActivityStatusType } from '../../prop-types'\nimport { norm } from '../../util/math'\nimport { useNow } from '../../hooks'\nimport TimeTag from './TimeTag'\nimport {\n  ACTIVITY_STATUS_CONFIRMED,\n  ACTIVITY_STATUS_PENDING,\n} from '../../symbols'\n\nconst MINUTE = 60 * 1000\nconst DELAY_BEFORE_HIDE = 1000\n\nconst TX_DURATION_AVERAGE = 3 * MINUTE\n// threshold at which point we switch to displaying the indeterminate progress\n// bar, so that the user doesnâ€™t get confused by a completed progress bar.\nconst TX_DURATION_THRESHOLD = TX_DURATION_AVERAGE - MINUTE / 2\n\nfunction getProgress(status, createdAt, estimate, threshold, now) {\n  if (status === ACTIVITY_STATUS_CONFIRMED) {\n    return 1\n  }\n  return now > threshold ? -1 : norm(now, createdAt, estimate)\n}\n\nconst TransactionProgress = React.memo(function TransactionProgress({\n  createdAt,\n  minedAtEstimate,\n  status,\n}) {\n  const now = useNow().getTime()\n\n  // Only animate things if the panel is ready (opened).\n  const estimate = createdAt + TX_DURATION_AVERAGE\n  const threshold = createdAt + TX_DURATION_THRESHOLD\n\n  const progress = getProgress(status, createdAt, estimate, threshold, now)\n  const showConfirmed = status === ACTIVITY_STATUS_CONFIRMED\n  const showTimer =\n    !showConfirmed && now < threshold && status === ACTIVITY_STATUS_PENDING\n\n  return (\n    <Transition\n      native\n      delay={DELAY_BEFORE_HIDE}\n      items={status === ACTIVITY_STATUS_PENDING}\n      enter={{ height: 28, opacity: 1 }}\n      leave={{ height: 0, opacity: 0 }}\n    >\n      {show =>\n        show &&\n        (transition => (\n          <animated.div\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              paddingTop: `${1 * GU}px`,\n              ...transition,\n            }}\n          >\n            <div css=\"flex-grow: 1\">\n              <ProgressBar animate value={showConfirmed ? 1 : progress} />\n            </div>\n            {(showTimer || showConfirmed) && (\n              <TimeTag\n                date={estimate}\n                label={showConfirmed ? 'confirmed' : null}\n                css={`\n                  margin-left: ${2 * GU}px;\n                `}\n              />\n            )}\n          </animated.div>\n        ))\n      }\n    </Transition>\n  )\n})\n\nTransactionProgress.propTypes = {\n  // unix timestamps\n  createdAt: PropTypes.number.isRequired,\n  minedAtEstimate: PropTypes.number,\n  status: ActivityStatusType.isRequired,\n}\n\nTransactionProgress.defaultProps = {\n  minedAtEstimate: -1,\n}\n\nexport default TransactionProgress\n","import React, { useCallback, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  ButtonBase,\n  ButtonIcon,\n  IconCross,\n  IconCheck,\n  GU,\n  textStyle,\n  useTheme,\n} from '@aragon/ui'\nimport { ActivityContext } from '../../contexts/ActivityContext'\nimport { transformAddresses } from '../../util/web3'\nimport AppIcon from '../AppIcon/AppIcon'\nimport LocalIdentityBadge from '../IdentityBadge/LocalIdentityBadge'\nimport TimeTag from './TimeTag'\nimport TransactionProgress from './TransactionProgress'\nimport {\n  ACTIVITY_STATUS_PENDING,\n  ACTIVITY_STATUS_CONFIRMED,\n  ACTIVITY_STATUS_FAILED,\n  ACTIVITY_STATUS_TIMED_OUT,\n} from '../../symbols'\nimport { useWallet } from '../../contexts/wallet'\nimport { blockExplorerUrl } from 'use-wallet'\nimport { getChainId } from '../../util/network'\n\nconst ActivityItem = ({ activity }) => {\n  const theme = useTheme()\n  const { networkType } = useWallet()\n  const { clearActivity } = useContext(ActivityContext)\n  const handleOpen = useCallback(() => {\n    if (activity.transactionHash) {\n      window.open(\n        blockExplorerUrl(\n          'transaction',\n          activity.transactionHash,\n          getChainId(networkType)\n        ),\n        '_blank',\n        'noopener'\n      )\n    }\n  }, [activity, networkType])\n  const handleClose = useCallback(() => {\n    if (activity.transactionHash) {\n      clearActivity(activity.transactionHash)\n    }\n  }, [activity, clearActivity])\n\n  const { app } = activity\n\n  return (\n    <div\n      css={`\n        position: relative;\n      `}\n    >\n      <ButtonBase\n        element=\"div\"\n        onClick={handleOpen}\n        css={`\n          text-align: left;\n          width: 100%;\n        `}\n      >\n        <section\n          css={`\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n            padding: ${2 * GU}px;\n            background: ${activity.read\n              ? theme.surface\n              : theme.surfaceHighlight};\n            transition-property: background;\n            transition-duration: 50ms;\n            transition-timing-function: ease-in-out;\n\n            &:active {\n              background: ${theme.surfaceUnder};\n            }\n          `}\n        >\n          <h1\n            css={`\n              display: flex;\n              align-items: center;\n            `}\n          >\n            <div css=\"flex-shrink: 0\">\n              <AppIcon app={app} />\n            </div>\n            <div\n              css={`\n                margin-left: ${1 * GU}px;\n                max-width: ${12.5 * GU}px\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n                ${textStyle('body2')}\n                color: ${theme.surfaceContent};\n              `}\n            >\n              {app ? app.name : 'Unknown'}\n            </div>\n            {activity.status !== ACTIVITY_STATUS_PENDING && (\n              <TimeTag\n                date={activity.createdAt}\n                css={`\n                  margin: 0 ${1.5 * GU}px;\n                `}\n              />\n            )}\n          </h1>\n          <div\n            css={`\n              position: relative;\n              margin-top: ${2 * GU}px;\n            `}\n          >\n            <ItemContent text={activity.description} />\n            <StatusMessage activity={activity} />\n            <TransactionProgress\n              status={activity.status}\n              createdAt={activity.createdAt}\n            />\n          </div>\n        </section>\n      </ButtonBase>\n      <ButtonIcon\n        label=\"Remove\"\n        onClick={handleClose}\n        css={`\n          position: absolute;\n          top: ${1 * GU}px;\n          right: ${1 * GU}px;\n          z-index: 1;\n        `}\n      >\n        <IconCross\n          css={`\n            color: ${theme.surfaceIcon};\n          `}\n        />\n      </ButtonIcon>\n    </div>\n  )\n}\n\nActivityItem.propTypes = {\n  activity: PropTypes.object.isRequired,\n}\n\nconst ItemContent = React.memo(\n  ({ text = '' }) => (\n    <p\n      css={`\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 2;\n        white-space: normal;\n        word-break: break-word;\n        overflow: hidden;\n        ${textStyle('body2')}\n      `}\n    >\n      {transformAddresses(text, (part, isAddress, index) =>\n        isAddress ? (\n          <LocalIdentityBadge key={index} entity={part} compact />\n        ) : (\n          <span key={index}>{part}</span>\n        )\n      )}\n    </p>\n  ),\n  (prevProps, nextProps) => prevProps.text === nextProps.text\n)\n\nItemContent.propTypes = {\n  text: PropTypes.string.isRequired,\n}\n\nfunction getStatusData(activity, theme) {\n  if (activity.status === ACTIVITY_STATUS_CONFIRMED) {\n    return [\n      <IconCheck size=\"small\" />,\n      <span>Transaction confirmed</span>,\n      theme.positive,\n    ]\n  }\n  if (activity.status === ACTIVITY_STATUS_FAILED) {\n    return [\n      <IconCross size=\"small\" />,\n      <span>Transaction failed</span>,\n      theme.negative,\n    ]\n  }\n  if (activity.status === ACTIVITY_STATUS_TIMED_OUT) {\n    return [\n      <IconCross size=\"small\" />,\n      <span>Transaction timed out</span>,\n      theme.negative,\n    ]\n  }\n  return [null, <span>Transaction pending</span>, theme.surfaceContentSecondary]\n}\n\nconst StatusMessage = ({ activity }) => {\n  const theme = useTheme()\n  const [icon, content, color] = getStatusData(activity, theme)\n  return (\n    <div\n      css={`\n        display: flex;\n        align-items: center;\n        margin-top: ${2 * GU}px;\n        ${textStyle('label2')}\n        color: ${color}\n      `}\n    >\n      {icon}\n      {content}\n    </div>\n  )\n}\n\nStatusMessage.propTypes = {\n  activity: PropTypes.object.isRequired,\n}\n\nexport default ActivityItem\n","import React, { useContext, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from 'react-spring'\nimport {\n  ButtonText,\n  GU,\n  textStyle,\n  springs,\n  useTheme,\n  useViewport,\n} from '@aragon/ui'\nimport activityNoResults from '../../assets/activity-no-results.png'\nimport { ActivityContext } from '../../contexts/ActivityContext'\nimport { AppType } from '../../prop-types'\nimport { ACTIVITY_STATUS_PENDING } from '../../symbols'\nimport { addressesEqual } from '../../util/web3'\nimport ActivityItem from './ActivityItem'\n\n// 8GU for top bar, 4GU for activity heading,\n// 11GU for HelpScout beacon (3GU top/bottom padding, 5GU beacon)\nconst MIN_LIST_HEIGHT_ADJUST = (8 + 4 + 11) * GU\nconst MAX_LIST_HEIGHT_CLAMP = 96 * GU\n\nconst getAppByProxyAddress = (proxyAddress, apps) =>\n  apps.find(app => addressesEqual(app.proxyAddress, proxyAddress)) || null\n\nfunction ActivityList({ apps }) {\n  const theme = useTheme()\n  const { below, height } = useViewport()\n  const { activities, clearActivities } = useContext(ActivityContext)\n  const activityItems = useMemo(\n    () =>\n      activities\n        .sort((a, b) => b.createdAt - a.createdAt)\n        .map(activity => ({\n          ...activity,\n          app: getAppByProxyAddress(activity.targetAppProxyAddress, apps),\n        })),\n    [activities, apps]\n  )\n\n  const canClear = useMemo(\n    () =>\n      activityItems.some(({ status }) => status !== ACTIVITY_STATUS_PENDING),\n    [activityItems]\n  )\n  const maxHeight = Math.min(\n    MAX_LIST_HEIGHT_CLAMP,\n    Math.ceil(height - MIN_LIST_HEIGHT_ADJUST)\n  )\n\n  return (\n    <div\n      css={`\n        /* Use 20px as the padding setting for popper is 10px */\n        width: ${below('medium') ? `calc(100vw - 20px)` : `${42 * GU}px`};\n      `}\n    >\n      <div\n        css={`\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          height: ${4 * GU}px;\n          padding: 0 ${2 * GU}px;\n          border-bottom: 1px solid ${theme.border};\n        `}\n      >\n        <label\n          css={`\n            ${textStyle('label2')}\n            color: ${theme.surfaceContentSecondary};\n          `}\n        >\n          Activity\n        </label>\n        {canClear && (\n          <ButtonText\n            onClick={clearActivities}\n            css={`\n              padding: 0;\n              ${textStyle('label2')}\n            `}\n          >\n            Clear all\n          </ButtonText>\n        )}\n      </div>\n      <div\n        css={`\n          max-height: ${maxHeight}px;\n          overflow-x: hidden;\n          overflow-y: auto;\n        `}\n      >\n        {activityItems.length > 0 ? (\n          <Transition\n            native\n            items={activityItems}\n            keys={activity => activity.transactionHash}\n            trail={50}\n            enter={{\n              opacity: 1,\n              transform: 'translate3d(0px, 0, 0)',\n            }}\n            leave={{\n              opacity: 0,\n              transform: 'translate3d(20px, 0, 0)',\n            }}\n            config={springs.smooth}\n          >\n            {activity => transitionStyles => (\n              <div\n                css={`\n                  & + & {\n                    border-top: 1px solid ${theme.border};\n                  }\n                `}\n              >\n                <animated.div\n                  style={{ ...transitionStyles, overflow: 'hidden' }}\n                >\n                  <ActivityItem activity={activity} />\n                </animated.div>\n              </div>\n            )}\n          </Transition>\n        ) : (\n          <div\n            css={`\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n              height: ${28.5 * GU}px;\n            `}\n          >\n            <img\n              src={activityNoResults}\n              alt=\"No results\"\n              height=\"125px\"\n              width=\"125px\"\n            />\n            <span\n              css={`\n                margin-top: ${2 * GU}px;\n                ${textStyle('body2')}\n              `}\n            >\n              No activity yet!\n            </span>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\nActivityList.propTypes = {\n  apps: PropTypes.arrayOf(AppType).isRequired,\n}\n\nexport default ActivityList\n","import React, { useCallback, useContext, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Spring, animated } from 'react-spring'\nimport {\n  ButtonIcon,\n  IconAlert,\n  Popover,\n  GU,\n  Tag,\n  springs,\n  useTheme,\n} from '@aragon/ui'\nimport ActivityList from '../../../components/Activity/ActivityList'\nimport { ActivityContext } from '../../../contexts/ActivityContext'\nimport { AppType } from '../../../prop-types'\n\nconst { div: AnimDiv } = animated\n\nconst ActivityButton = React.memo(function ActivityButton({ apps }) {\n  const theme = useTheme()\n  const [opened, setOpened] = useState(false)\n  const { markActivitiesRead, unreadActivityCount } = useContext(\n    ActivityContext\n  )\n  const containerRef = useRef()\n\n  const handleToggle = useCallback(\n    () =>\n      setOpened(opened => {\n        if (opened) {\n          markActivitiesRead()\n        }\n        return !opened\n      }),\n    [markActivitiesRead]\n  )\n  const handleClose = useCallback(() => {\n    markActivitiesRead()\n    setOpened(false)\n  }, [markActivitiesRead])\n\n  return (\n    <React.Fragment>\n      <div ref={containerRef} css=\"width: 58px\">\n        <ButtonIcon\n          element=\"div\"\n          onClick={handleToggle}\n          css={`\n            height: 100%;\n            width: 100%;\n            border-radius: 0;\n            padding-left: ${0.5 * GU}px;\n            justify-content: space-between;\n\n            /* This is a bit of a hack to get the focus ring to appear only\n             * around the button and not the spacer\n             */\n            &:focus:after {\n              right: ${3 * GU}px;\n            }\n          `}\n          label=\"Transaction activity\"\n        >\n          <div\n            css={`\n              position: relative;\n              line-height: 0;\n            `}\n          >\n            <IconAlert\n              css={`\n                color: ${theme.hint};\n              `}\n            />\n            <Spring\n              native\n              from={{ opacity: 0, size: 0 }}\n              to={{\n                opacity: unreadActivityCount > 0 ? 1 : 0,\n                size: 1,\n              }}\n              config={springs.lazy}\n            >\n              {({ opacity, size }) => (\n                <AnimDiv\n                  css={`\n                    position: absolute;\n                    top: -${0.5 * GU}px;\n                    right: -${0.5 * GU}px;\n                  `}\n                  style={{\n                    opacity,\n                    transform: size\n                      .interpolate(\n                        [0, 0.2, 0.4, 0.6, 0.8, 1],\n                        [1.5, 1, 1.5, 1, 1.5, 1]\n                      )\n                      .interpolate(s => `scale(${s})`),\n                  }}\n                >\n                  <Tag\n                    limitDigits\n                    mode=\"activity\"\n                    label={unreadActivityCount}\n                  />\n                </AnimDiv>\n              )}\n            </Spring>\n          </div>\n          {/* Spacer to extend the width of the button to the edge of the top bar */}\n          <div\n            css={`\n              height: 100%;\n              width: ${3 * GU}px;\n              background: ${theme.surface};\n            `}\n          />\n        </ButtonIcon>\n      </div>\n      <Popover\n        closeOnOpenerFocus\n        placement=\"bottom-end\"\n        onClose={handleClose}\n        visible={opened}\n        opener={containerRef.current}\n      >\n        <ActivityList apps={apps} />\n      </Popover>\n    </React.Fragment>\n  )\n})\n\nActivityButton.propTypes = {\n  apps: PropTypes.arrayOf(AppType).isRequired,\n}\n\nexport default ActivityButton\n","import React, { useRef, useState, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  ButtonBase,\n  ButtonIcon,\n  GU,\n  IconSettings,\n  Popover,\n  RADIUS,\n  Switch,\n  textStyle,\n  useTheme,\n  useViewport,\n} from '@aragon/ui'\nimport { useClientTheme } from '../../../client-theme'\nimport { useRouting } from '../../../routing'\n\nimport iconNetwork from '../../../assets/global-preferences-network.svg'\nimport iconCustomLabels from '../../../assets/global-preferences-custom-labels.svg'\nimport iconNotifications from '../../../assets/global-preferences-notifications.svg'\nimport { useWallet } from '../../../contexts/wallet'\nimport { isOnEthMainnet } from '../../../util/network'\n\nfunction GlobalPreferencesButton() {\n  const theme = useTheme()\n  const clientTheme = useClientTheme()\n  const { below } = useViewport()\n  const routing = useRouting()\n\n  const [opened, setOpened] = useState(false)\n  const containerRef = useRef()\n\n  const { networkType } = useWallet()\n  const isMainnet = isOnEthMainnet(networkType)\n\n  const handleToggle = useCallback(() => setOpened(opened => !opened), [])\n  const handleClose = useCallback(() => setOpened(false), [])\n  const handleItemClick = useCallback(\n    path => {\n      setOpened(false)\n      routing.update(locator => ({\n        ...locator,\n        preferences: { section: path },\n      }))\n    },\n    [routing]\n  )\n\n  const toggleDarkMode = useCallback(() => {\n    clientTheme.toggleAppearance()\n  }, [clientTheme])\n\n  return (\n    <React.Fragment>\n      <div ref={containerRef}>\n        <ButtonIcon\n          element=\"div\"\n          onClick={handleToggle}\n          css={`\n            width: ${4.25 * GU}px;\n            height: 100%;\n            border-radius: 0;\n          `}\n          label=\"Global preferences\"\n        >\n          <IconSettings\n            css={`\n              color: ${theme.hint};\n            `}\n          />\n        </ButtonIcon>\n      </div>\n      <Popover\n        closeOnOpenerFocus\n        placement=\"bottom-end\"\n        onClose={handleClose}\n        visible={opened}\n        opener={containerRef.current}\n      >\n        <ul\n          css={`\n            /* Use 20px as the padding setting for popper is 10px */\n            width: ${below('medium') ? `calc(100vw - 20px)` : `${42 * GU}px`};\n            padding: 0;\n            margin: 0;\n            list-style: none;\n            background: ${theme.surface};\n            color: ${theme.content};\n            border-radius: ${RADIUS}px;\n          `}\n        >\n          <li\n            css={`\n              display: flex;\n              align-items: center;\n              height: ${4 * GU}px;\n              padding-left: ${2 * GU}px;\n              border-bottom: 1px solid ${theme.border};\n              ${textStyle('label2')}\n              color: ${theme.surfaceContentSecondary};\n            `}\n          >\n            Global preferences\n          </li>\n          <Item\n            onClick={() => handleItemClick('custom-labels')}\n            icon={iconCustomLabels}\n            label=\"Custom labels\"\n          />\n          {isMainnet && (\n            <Item\n              onClick={() => handleItemClick('network')}\n              icon={iconNetwork}\n              label=\"Network\"\n            />\n          )}\n          <Item\n            onClick={() => handleItemClick('notifications')}\n            icon={iconNotifications}\n            label=\"Notifications\"\n          />\n          <Item\n            onClick={toggleDarkMode}\n            label={\n              <React.Fragment>\n                <div\n                  css={`\n                    display: flex;\n                    justify-content: space-between;\n                    width: 100%;\n                  `}\n                >\n                  <span>Dark mode</span>\n                  <Switch checked={clientTheme.appearance === 'dark'} />\n                </div>\n              </React.Fragment>\n            }\n          />\n        </ul>\n      </Popover>\n    </React.Fragment>\n  )\n}\n\nfunction Item({ icon, label, onClick, lastItem }) {\n  const theme = useTheme()\n\n  return (\n    <li\n      css={`\n        & + & {\n          border-top: 1px solid ${theme.border};\n        }\n      `}\n    >\n      <ButtonBase\n        onClick={onClick}\n        label={label}\n        css={`\n          width: 100%;\n          height: ${7 * GU}px;\n          border-radius: 0;\n        `}\n      >\n        <div\n          css={`\n            display: flex;\n            width: 100%;\n            height: 100%;\n            padding: ${2 * GU}px;\n            justify-content: left;\n            align-items: center;\n\n            &:active,\n            &:focus {\n              background: ${theme.surfacePressed};\n            }\n          `}\n        >\n          {icon && <img src={icon} alt=\"\" />}\n          <div\n            css={`\n              flex-grow: 1;\n              display: flex;\n              align-items: center;\n              margin-left: ${icon ? 1 * GU : 0}px;\n            `}\n          >\n            {label}\n          </div>\n        </div>\n      </ButtonBase>\n    </li>\n  )\n}\n\nItem.propTypes = {\n  icon: PropTypes.node,\n  label: PropTypes.node.isRequired,\n  onClick: PropTypes.func.isRequired,\n  lastItem: PropTypes.bool,\n}\n\nexport default React.memo(GlobalPreferencesButton)\n","import React, { useEffect, useContext, useState } from 'react'\nimport PropTypes from 'prop-types'\n\nconst CONSOLE_VISIBLE_KEY = 'CONSOLE_VISIBLE'\nexport const CONSOLE_COMMAND_HISTORY_KEY = 'CONSOLE_COMMAND_HISTORY'\n\nexport const ConsoleVisibleContext = React.createContext()\n\nfunction ConsoleVisibleProvider({ children }) {\n  const [consoleVisible, setConsoleVisible] = useState(\n    localStorage.getItem(CONSOLE_VISIBLE_KEY) === 'true'\n  )\n\n  useEffect(() => {\n    localStorage.setItem(CONSOLE_VISIBLE_KEY, consoleVisible ? 'true' : 'false')\n  }, [consoleVisible])\n\n  return (\n    <ConsoleVisibleContext.Provider\n      value={{ consoleVisible, setConsoleVisible }}\n    >\n      {children}\n    </ConsoleVisibleContext.Provider>\n  )\n}\n\nConsoleVisibleProvider.propTypes = {\n  children: PropTypes.node,\n}\n\nfunction useConsole() {\n  return useContext(ConsoleVisibleContext)\n}\n\nexport { useConsole, ConsoleVisibleProvider }\n","import React, { useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport { ButtonBase, GU } from '@aragon/ui'\nimport { useLocalIdentity } from '../../hooks'\n\nexport const MENU_PANEL_APP_INSTANCE_HEIGHT = 4 * GU\n\nconst MenuPanelAppInstance = React.memo(function MenuPanelAppInstance({\n  active,\n  id,\n  name,\n  onClick,\n}) {\n  const handleClick = useCallback(() => {\n    onClick(id)\n  }, [id, onClick])\n  const { name: localIdentity } = useLocalIdentity(id)\n\n  const label = localIdentity || name\n\n  return (\n    <ButtonBase\n      onClick={handleClick}\n      css={`\n        display: flex;\n        align-items: center;\n        height: ${MENU_PANEL_APP_INSTANCE_HEIGHT}px;\n        width: 100%;\n        border-radius: 0;\n        text-align: left;\n        cursor: pointer;\n        ${active ? 'font-weight: 600' : ''}\n      `}\n    >\n      <span\n        css={`\n          overflow: hidden;\n          white-space: nowrap;\n          text-overflow: ellipsis;\n        `}\n      >\n        {label}\n      </span>\n    </ButtonBase>\n  )\n})\nMenuPanelAppInstance.propTypes = {\n  active: PropTypes.bool.isRequired,\n  id: PropTypes.string.isRequired,\n  name: PropTypes.string.isRequired,\n  onClick: PropTypes.func.isRequired,\n}\n\nexport default MenuPanelAppInstance\n","import React, { useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport { Spring, animated } from 'react-spring'\nimport { ButtonBase, GU, textStyle, useTheme, springs } from '@aragon/ui'\nimport MenuPanelAppInstance, {\n  MENU_PANEL_APP_INSTANCE_HEIGHT,\n} from './MenuPanelAppInstance'\nimport { AppInstanceType } from '../../prop-types'\nimport { useLocalIdentity } from '../../hooks'\n\nexport const MENU_ITEM_BASE_HEIGHT = 5 * GU\n\nconst { div: AnimDiv } = animated\n\nconst MenuPanelAppGroup = React.memo(function MenuPanelAppGroup({\n  name,\n  icon,\n  instances,\n  activeInstanceId,\n  active,\n  expand,\n  onActivate,\n}) {\n  const theme = useTheme()\n\n  const handleAppClick = useCallback(() => {\n    const instance = instances[0]\n    if (instance) {\n      onActivate(instance.instanceId)\n    }\n  }, [instances, onActivate])\n\n  const handleInstanceClick = useCallback(\n    instanceId => onActivate(instanceId),\n    [onActivate]\n  )\n\n  const singleInstance = instances.length === 1\n\n  return (\n    <Spring\n      config={springs.smooth}\n      to={{ openProgress: Number(active && (singleInstance || expand)) }}\n      native\n    >\n      {({ openProgress }) => (\n        <div\n          css={`\n            position: relative;\n            width: 100%;\n\n            transition: background 150ms ease-in-out;\n\n            ${active\n              ? `\n                transition: none;\n                background: ${theme.surfacePressed};\n              `\n              : ''}\n            &:active {\n              background: ${theme.surfacePressed};\n            }\n\n            .instances {\n              /* 3GU left padding + 3GU icon + 1GU padding to align instance with menu item */\n              padding-left: ${7 * GU}px;\n              padding-right: ${2 * GU}px;\n              overflow: hidden;\n              list-style: none;\n            }\n          `}\n        >\n          <AnimDiv\n            css={`\n              position: absolute;\n              left: 0;\n              width: 3px;\n              height: 100%;\n              background: ${theme.accent};\n            `}\n            style={{\n              opacity: openProgress,\n              transform: openProgress.interpolate(\n                v => `translate3d(-${(1 - v) * 100}%, 0, 0)`\n              ),\n            }}\n          />\n\n          <MenuPanelItem\n            active={active}\n            icon={icon}\n            instanceId={instances[0].instanceId}\n            name={name}\n            onClick={handleAppClick}\n            openProgress={openProgress}\n            singleInstance={singleInstance}\n          />\n\n          {instances.length > 1 && (\n            <animated.ul\n              className=\"instances\"\n              style={{\n                height: openProgress.interpolate(\n                  v =>\n                    `${(instances.length * MENU_PANEL_APP_INSTANCE_HEIGHT + 0) *\n                      v}px`\n                ),\n              }}\n            >\n              {instances.map(({ instanceId, identifier }) => {\n                const label = identifier || instanceId\n                return label ? (\n                  <li key={instanceId}>\n                    <MenuPanelAppInstance\n                      id={instanceId}\n                      name={label}\n                      active={instanceId === activeInstanceId}\n                      onClick={handleInstanceClick}\n                    />\n                  </li>\n                ) : null\n              })}\n            </animated.ul>\n          )}\n        </div>\n      )}\n    </Spring>\n  )\n})\nMenuPanelAppGroup.propTypes = {\n  active: PropTypes.bool.isRequired,\n  activeInstanceId: PropTypes.string,\n  expand: PropTypes.bool.isRequired,\n  icon: PropTypes.object.isRequired,\n  instances: PropTypes.arrayOf(AppInstanceType).isRequired,\n  name: PropTypes.string.isRequired,\n  onActivate: PropTypes.func.isRequired,\n}\n\nconst MenuPanelItem = React.memo(function MenuPanelItem({\n  active,\n  onClick,\n  name,\n  icon,\n  instanceId,\n  openProgress,\n  singleInstance,\n}) {\n  const { name: localIdentity } = useLocalIdentity(instanceId)\n  const label = (singleInstance && localIdentity) || name\n\n  return (\n    <ButtonBase\n      onClick={onClick}\n      css={`\n        display: flex;\n        align-items: center;\n        height: ${MENU_ITEM_BASE_HEIGHT}px;\n        width: 100%;\n        padding: 0 ${2 * GU}px 0 ${3 * GU}px;\n        border-radius: 0;\n        text-align: left;\n        ${active ? 'font-weight: 600' : ''}\n      `}\n    >\n      <span>{icon}</span>\n      <span\n        css={`\n          margin-left: ${1 * GU}px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          ${textStyle('body2')}\n        `}\n      >\n        {label}\n      </span>\n    </ButtonBase>\n  )\n})\nMenuPanelItem.propTypes = {\n  active: PropTypes.bool,\n  icon: PropTypes.object.isRequired,\n  instanceId: PropTypes.string.isRequired,\n  name: PropTypes.string.isRequired,\n  onClick: PropTypes.func.isRequired,\n  openProgress: PropTypes.object.isRequired,\n  singleInstance: PropTypes.bool.isRequired,\n}\n\nexport default MenuPanelAppGroup\n","import React, { useCallback, useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Spring, animated } from 'react-spring'\nimport { LoadingRing, GU, textStyle, springs } from '@aragon/ui'\nimport { AppsStatusType } from '../../prop-types'\nimport { APPS_STATUS_READY, APPS_STATUS_LOADING } from '../../symbols'\nimport { noop } from '../../util/utils'\nimport { MENU_PANEL_APP_INSTANCE_HEIGHT } from './MenuPanelAppInstance'\nimport { MENU_ITEM_BASE_HEIGHT } from './MenuPanelAppGroup'\n\nconst AnimatedDiv = animated.div\n\nconst BASE_LOADER_HEIGHT = 5 * GU\nconst X_SHIFT = 5 * GU\n\nfunction MenuPanelAppsLoader({ appsStatus, children, expandedInstancesCount }) {\n  const [showApps, setShowApps] = useState(false)\n  const [transitionDone, setTransitionDone] = useState(false)\n\n  const appsCount = React.Children.count(children)\n\n  // Reinitialize the animation when appsStatus changes\n  useEffect(() => {\n    setShowApps(false)\n    setTransitionDone(false)\n  }, [appsStatus])\n\n  const handleRest = useCallback(() => {\n    if (appsStatus === APPS_STATUS_READY) {\n      // Triggers the transition showing the apps.\n      setShowApps(true)\n\n      // The second time handleRest() is called, showApps is `true`,\n      // which means that we have reached the end of the two-steps transition.\n      setTransitionDone(showApps)\n    }\n  }, [showApps, appsStatus])\n\n  const instancesHeight = useMemo(() => {\n    if (transitionDone) {\n      return -1\n    }\n    if (appsStatus === APPS_STATUS_READY || showApps) {\n      return (\n        appsCount * MENU_ITEM_BASE_HEIGHT +\n        expandedInstancesCount * MENU_PANEL_APP_INSTANCE_HEIGHT\n      )\n    }\n    return BASE_LOADER_HEIGHT\n  }, [appsCount, appsStatus, expandedInstancesCount, showApps, transitionDone])\n\n  const statusLabel = useMemo(() => {\n    if (appsStatus === APPS_STATUS_LOADING) {\n      return 'Loading appsâ€¦'\n    }\n    if (appsStatus === APPS_STATUS_READY) {\n      return 'Apps loaded.'\n    }\n    return null\n  }, [appsStatus])\n\n  return (\n    <Spring\n      config={springs.smooth}\n      immediate={transitionDone}\n      from={{\n        afterLoadingMessageProgress: 0,\n        showAppsProgress: 0,\n        instancesHeight: BASE_LOADER_HEIGHT,\n      }}\n      to={{\n        afterLoadingMessageProgress: Number(appsStatus !== APPS_STATUS_LOADING),\n        showAppsProgress: Number(showApps),\n        instancesHeight,\n      }}\n      onRest={handleRest}\n      native\n    >\n      {({ afterLoadingMessageProgress, showAppsProgress, instancesHeight }) => (\n        <AnimatedDiv\n          style={{\n            height: instancesHeight.interpolate(v =>\n              v === -1 ? 'auto' : `${v}px`\n            ),\n          }}\n          css={`\n            position: relative;\n            overflow: hidden;\n          `}\n        >\n          <div\n            css={`\n              position: absolute;\n              z-index: 1;\n              top: 0;\n              bottom: 0;\n              display: flex;\n              align-items: center;\n              width: 100%;\n              padding-left: ${3 * GU}px;\n              overflow: hidden;\n            `}\n          >\n            <div\n              style={{ opacity: Number(!showApps) }}\n              css={`\n                display: flex;\n                align-items: center;\n                ${textStyle('body2')}\n              `}\n            >\n              <LoadingRing\n                paused={appsStatus !== APPS_STATUS_LOADING}\n                css={`\n                  margin-right: ${1 * GU}px;\n                `}\n              />\n              {statusLabel}\n            </div>\n          </div>\n          <AnimatedDiv\n            style={{\n              opacity: showAppsProgress,\n              transform: showAppsProgress.interpolate(\n                v => `translate3d(${(1 - v) * -X_SHIFT}px, 0, 0)`\n              ),\n            }}\n            css={`\n              position: relative;\n              z-index: 2;\n            `}\n          >\n            {children}\n          </AnimatedDiv>\n        </AnimatedDiv>\n      )}\n    </Spring>\n  )\n}\n\nMenuPanelAppsLoader.propTypes = {\n  appsStatus: AppsStatusType.isRequired,\n  children: PropTypes.node.isRequired,\n  expandedInstancesCount: PropTypes.number.isRequired,\n}\n\nMenuPanelAppsLoader.defaultProps = {\n  children: noop,\n  appsStatus: APPS_STATUS_LOADING,\n}\n\nexport default MenuPanelAppsLoader\n","import React from 'react'\nimport { GU, textStyle } from '@aragon/ui'\nimport { DaoItemType } from '../../../prop-types'\nimport { getKnownOrganization } from '../../../known-organizations'\nimport OrgIcon from '../../OrgIcon/OrgIcon'\nimport PropTypes from 'prop-types'\n\nclass OrganizationItem extends React.Component {\n  static propTypes = {\n    dao: DaoItemType.isRequired,\n    networkType: PropTypes.string.isRequired,\n  }\n  render() {\n    const { dao, networkType, ...props } = this.props\n    const knownOrg = getKnownOrganization(networkType, dao.address)\n    return (\n      <div\n        css={`\n          flex-grow: 1;\n          display: flex;\n          align-items: center;\n          ${textStyle('body2')}\n        `}\n        {...props}\n      >\n        <OrgIcon orgAddress={dao.address} />\n        <span\n          css={`\n            padding-left: ${1 * GU}px;\n            overflow: hidden;\n            text-align: left;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n          `}\n        >\n          {knownOrg ? knownOrg.name : dao.name || dao.address}\n        </span>\n      </div>\n    )\n  }\n}\n\nexport default OrganizationItem\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { IconPlus, GU, RADIUS, useTheme } from '@aragon/ui'\nimport { getKnownOrganization } from '../../../known-organizations'\nimport { FavoriteDaoType, DaoItemType } from '../../../prop-types'\nimport { addressesEqual } from '../../../util/web3'\nimport FavoritesMenu from '../../FavoritesMenu/FavoritesMenu'\nimport FavoritesMenuItemButton from '../../FavoritesMenu/FavoritesMenuItemButton'\nimport OrgIcon from '../../OrgIcon/OrgIcon'\nimport { useWallet } from '../../../contexts/wallet'\nimport { favoriteToggleEvent } from '../../../contexts/FavoriteDaosContext'\n\nclass Favorites extends React.Component {\n  static propTypes = {\n    favoriteDaos: PropTypes.arrayOf(FavoriteDaoType),\n    currentDao: DaoItemType,\n    onUpdate: PropTypes.func.isRequired,\n    theme: PropTypes.object,\n    networkType: PropTypes.string.isRequired,\n  }\n\n  state = { localDaos: [] }\n\n  componentDidMount() {\n    this.setState({ localDaos: this.getLocalDaos() })\n  }\n\n  componentWillUnmount() {\n    const { onUpdate } = this.props\n    const { localDaos } = this.state\n    onUpdate(\n      localDaos\n        .filter(dao => dao.favorited)\n        .map(dao => ({\n          name: dao.name,\n          address: dao.address,\n        }))\n    )\n  }\n\n  // Build the local DAO list based on the favorites. The favorite state is not\n  // directly reflected in the popup, to let users favorite / unfavorite items\n  // without seeing them being immediately removed. For this reason, we need to\n  // maintain a separate state.\n  getLocalDaos() {\n    const { currentDao, favoriteDaos } = this.props\n\n    const localDaos = [\n      ...favoriteDaos\n        .map(dao => ({ ...dao, favorited: true }))\n        .sort(dao =>\n          addressesEqual(dao.address, currentDao.address) ? -1 : 0\n        ),\n    ]\n\n    // If the current DAO is favorited, it is already in the local list\n    return this.isDaoFavorited(currentDao)\n      ? localDaos\n      : [{ ...currentDao, favorited: false }, ...localDaos]\n  }\n\n  isDaoFavorited({ address }) {\n    return this.props.favoriteDaos.some(dao =>\n      addressesEqual(dao.address, address)\n    )\n  }\n\n  currentDaoWithFavoriteState() {\n    const { currentDao } = this.props\n    const { localDaos } = this.state\n    const daoItem = localDaos.find(dao =>\n      addressesEqual(currentDao.address, dao.address)\n    )\n    return {\n      ...currentDao,\n      favorited: daoItem ? daoItem.favorited : false,\n    }\n  }\n\n  handleGoHome = () => {\n    window.location.hash = ''\n  }\n\n  handleOpenOrg = address => {\n    const { currentDao, favoriteDaos } = this.props\n    const dao = [currentDao, ...favoriteDaos].find(dao =>\n      addressesEqual(dao.address, address)\n    )\n    window.location.hash = `/${(dao && dao.name) || address}`\n  }\n\n  handleFavoriteUpdate = (address, favorited) => {\n    const { localDaos } = this.state\n\n    this.setState({\n      localDaos: localDaos.map(dao =>\n        addressesEqual(dao.address, address) ? { ...dao, favorited } : dao\n      ),\n    })\n\n    // analytics\n    const { networkType } = this.props\n    favoriteToggleEvent(\n      localDaos.find(dao => addressesEqual(dao.address, address))?.name ||\n        address,\n      favorited,\n      networkType\n    )\n  }\n\n  render() {\n    const { theme, networkType } = this.props\n    const { localDaos } = this.state\n    const currentDao = this.currentDaoWithFavoriteState()\n\n    const allItems = localDaos.map(org => {\n      const knownOrg = getKnownOrganization(networkType, org.address)\n      return {\n        ...org,\n        id: org.address,\n        name: knownOrg ? knownOrg.name : org.name || org.address,\n        image: <OrgIcon orgAddress={org.address} />,\n      }\n    })\n\n    const favoriteItems = [...allItems].sort((org, org2) => {\n      const { name = '' } = org\n      const { name: name2 = '' } = org\n      return addressesEqual(org.address, currentDao.address)\n        ? -1\n        : addressesEqual(org2.address, currentDao.address)\n        ? 1\n        : name.localeCompare(name2)\n    })\n\n    return (\n      <section\n        aria-label=\"Organizations\"\n        css={`\n          width: ${42 * GU}px;\n        `}\n      >\n        <FavoritesMenu\n          items={favoriteItems}\n          onActivate={this.handleOpenOrg}\n          onFavoriteUpdate={this.handleFavoriteUpdate}\n        />\n        <FavoritesMenuItemButton\n          onClick={this.handleGoHome}\n          css={`\n            width: 100%;\n            padding: 0 ${2 * GU}px;\n            border-top: 1px solid ${theme.border};\n          `}\n        >\n          <span\n            css={`\n              display: flex;\n              align-items: center;\n              margin-right: ${1 * GU}px;\n              color: ${theme.accentContent};\n              background: ${theme.accent};\n              border-radius: ${RADIUS}px;\n            `}\n          >\n            <IconPlus />\n          </span>\n          <span>Open another organization</span>\n        </FavoritesMenuItemButton>\n      </section>\n    )\n  }\n}\n\nexport default props => {\n  const theme = useTheme()\n  const { networkType } = useWallet()\n  return <Favorites networkType={networkType} theme={theme} {...props} />\n}\n","import React, { useCallback, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  ButtonBase,\n  LoadingRing,\n  Popover,\n  GU,\n  textStyle,\n  useTheme,\n} from '@aragon/ui'\nimport { DaoItemType } from '../../../prop-types'\nimport { useFavoriteDaos } from '../../../contexts/FavoriteDaosContext'\nimport OrganizationItem from './OrganizationItem'\nimport Favorites from './Favorites'\nimport { useWallet } from '../../../contexts/wallet'\n\nconst OrganizationSwitcher = React.memo(function OrganizationSwitcher({\n  currentDao,\n  loading,\n}) {\n  const theme = useTheme()\n  const { networkType } = useWallet()\n\n  const { favoriteDaos, updateFavoriteDaos } = useFavoriteDaos()\n\n  const buttonRef = useRef(null)\n  const [menuOpened, setMenuOpened] = useState(false)\n\n  const handleToggleMenu = useCallback(() => {\n    setMenuOpened(opened => !opened)\n  }, [])\n\n  const closeMenu = useCallback(() => {\n    setMenuOpened(false)\n  }, [])\n\n  const handleFavoritesUpdate = useCallback(\n    favorites => {\n      closeMenu()\n      updateFavoriteDaos(favorites)\n    },\n    [closeMenu, updateFavoriteDaos]\n  )\n\n  if (loading) {\n    return (\n      <div\n        css={`\n          display: flex;\n          align-items: center;\n          margin: ${2 * GU}px ${3 * GU}px;\n        `}\n      >\n        <LoadingRing />\n        <span\n          css={`\n            margin-left: ${1 * GU}px;\n            ${textStyle('body1')}\n          `}\n        >\n          Loadingâ€¦\n        </span>\n      </div>\n    )\n  }\n\n  if (!currentDao.address) {\n    return null\n  }\n\n  return (\n    <div\n      css={`\n        display: flex;\n        align-items: center;\n        position: relative;\n      `}\n    >\n      <ButtonBase\n        ref={buttonRef}\n        onClick={handleToggleMenu}\n        css={`\n          flex-grow: 1;\n          padding: ${2 * GU}px ${2 * GU}px ${2 * GU}px ${3 * GU}px;\n          width: 100%;\n          height: 100%;\n          min-width: ${28 * GU}px;\n          border-radius: 0;\n          &:active {\n            background: ${theme.surfacePressed};\n          }\n        `}\n      >\n        <OrganizationItem\n          networkType={networkType}\n          dao={currentDao}\n          css={`\n            ${textStyle('body1')}\n          `}\n        />\n      </ButtonBase>\n      <Popover\n        onClose={closeMenu}\n        visible={menuOpened}\n        opener={buttonRef.current}\n      >\n        <Favorites\n          favoriteDaos={favoriteDaos}\n          currentDao={currentDao}\n          onUpdate={handleFavoritesUpdate}\n        />\n      </Popover>\n    </div>\n  )\n})\n\nOrganizationSwitcher.propTypes = {\n  currentDao: DaoItemType.isRequired,\n  loading: PropTypes.bool.isRequired,\n}\n\nexport default OrganizationSwitcher\n","import React, { useCallback, useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Spring, animated } from 'react-spring'\nimport {\n  Details,\n  GU,\n  springs,\n  textStyle,\n  unselectable,\n  useTheme,\n} from '@aragon/ui'\nimport { lerp } from '../../util/math'\nimport {\n  AppInstanceGroupType,\n  AppsStatusType,\n  DaoAddressType,\n  DaoStatusType,\n} from '../../prop-types'\nimport { useConsole } from '../../apps/Console/useConsole'\nimport { useRouting } from '../../routing'\nimport { staticApps } from '../../static-apps'\nimport { DAO_STATUS_LOADING } from '../../symbols'\nimport MenuPanelAppGroup from './MenuPanelAppGroup'\nimport MenuPanelAppsLoader from './MenuPanelAppsLoader'\nimport OrganizationSwitcher from './OrganizationSwitcher/OrganizationSwitcher'\nimport AppIcon from '../AppIcon/AppIcon'\n\nexport const MENU_PANEL_SHADOW_WIDTH = 3\nexport const MENU_PANEL_WIDTH = 28 * GU\n\nconst { div: AnimDiv } = animated\n\nconst APP_APPS_CENTER = staticApps.get('apps').app\nconst APP_CONSOLE = staticApps.get('console').app\nconst APP_HOME = staticApps.get('home').app\nconst APP_ORGANIZATION = staticApps.get('organization').app\nconst APP_PERMISSIONS = staticApps.get('permissions').app\n\nconst systemAppsOpenedState = {\n  key: 'SYSTEM_APPS_OPENED_STATE',\n  isOpen: function() {\n    return localStorage.getItem(this.key) === '1'\n  },\n  set: function(opened) {\n    localStorage.setItem(this.key, opened ? '1' : '0')\n  },\n}\n\nfunction MenuPanel({\n  appInstanceGroups,\n  appsStatus,\n  daoAddress,\n  daoStatus,\n  onOpenApp,\n  showOrgSwitcher,\n}) {\n  const { mode } = useRouting()\n  const { consoleVisible } = useConsole()\n  const [systemAppsOpened, setSystemAppsOpened] = useState(\n    systemAppsOpenedState.isOpen()\n  )\n\n  const appGroups = useMemo(\n    () =>\n      appInstanceGroups\n        .filter(appGroup => appGroup.hasWebApp)\n        .map(appGroup => ({\n          ...appGroup,\n          icon: <AppIcon app={appGroup.app} />,\n        })),\n    [appInstanceGroups]\n  )\n\n  const activeInstanceId = (mode.name === 'org' && mode.instanceId) || null\n\n  const showConsole = consoleVisible || activeInstanceId === 'console'\n  const menuApps = [APP_HOME, appGroups]\n  const systemApps = [\n    APP_PERMISSIONS,\n    APP_APPS_CENTER,\n    APP_ORGANIZATION,\n    ...(showConsole ? [APP_CONSOLE] : []),\n  ]\n\n  const isSystemAppActive = useMemo(\n    () => systemApps.some(systemApp => systemApp.appId === activeInstanceId),\n    [activeInstanceId, systemApps]\n  )\n\n  const handleToggleSystemApps = useCallback(() => {\n    setSystemAppsOpened(opened => {\n      const openedState = !opened\n      systemAppsOpenedState.set(openedState)\n      return openedState\n    })\n  }, [])\n\n  const renderAppGroup = useCallback(\n    app => {\n      const { appId, name, icon, instances } = app\n      const isActive =\n        instances.findIndex(\n          ({ instanceId }) => instanceId === activeInstanceId\n        ) !== -1\n\n      return (\n        <div key={appId}>\n          <MenuPanelAppGroup\n            name={name}\n            icon={icon}\n            instances={instances}\n            active={isActive}\n            expand={isActive}\n            activeInstanceId={activeInstanceId}\n            onActivate={onOpenApp}\n          />\n        </div>\n      )\n    },\n    [activeInstanceId, onOpenApp]\n  )\n\n  const renderLoadedAppGroup = useCallback(\n    appGroups => {\n      // Used by the menu transition\n      const expandedInstancesCount = appGroups.reduce(\n        (height, { instances }) =>\n          instances.length > 1 &&\n          instances.findIndex(\n            ({ instanceId }) => instanceId === activeInstanceId\n          ) > -1\n            ? height + instances.length\n            : height,\n        0\n      )\n\n      // Wrap the DAO apps in the loader\n      return (\n        <MenuPanelAppsLoader\n          key=\"menu-apps\"\n          appsStatus={appsStatus}\n          expandedInstancesCount={expandedInstancesCount}\n        >\n          {appGroups.map(app => renderAppGroup(app))}\n        </MenuPanelAppsLoader>\n      )\n    },\n    [appsStatus, activeInstanceId, renderAppGroup]\n  )\n\n  useEffect(() => {\n    // Automatically toggle the system apps menu if a system app is activated/deactivated\n    // If the user has manually opened the system apps menu, keep it open\n    setSystemAppsOpened(isSystemAppActive || systemAppsOpenedState.isOpen())\n  }, [isSystemAppActive])\n\n  return (\n    <Main>\n      <div\n        css={`\n          position: relative;\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n          flex-shrink: 1;\n          box-shadow: 2px 0 ${MENU_PANEL_SHADOW_WIDTH}px rgba(0, 0, 0, 0.05);\n        `}\n      >\n        {showOrgSwitcher && (\n          <OrganizationSwitcher\n            loading={daoStatus === DAO_STATUS_LOADING}\n            currentDao={{\n              name: daoAddress.domain,\n              address: daoAddress.address,\n            }}\n          />\n        )}\n        <nav\n          css={`\n            overflow-y: auto;\n            flex: 1 1 0;\n            padding-top: ${(showOrgSwitcher ? 1 : 3) * GU}px;\n          `}\n        >\n          <Heading label=\"Apps\" />\n          <div\n            css={`\n              margin-top: ${0.5 * GU}px;\n            `}\n          >\n            {menuApps.map(app =>\n              // If it's an array, it's the group being loaded from the ACL\n              Array.isArray(app)\n                ? renderLoadedAppGroup(app)\n                : renderAppGroup(app)\n            )}\n          </div>\n\n          <div\n            css={`\n              padding-top: ${1 * GU}px;\n            `}\n          >\n            <Details\n              label=\"System\"\n              opened={systemAppsOpened}\n              onToggle={handleToggleSystemApps}\n            >\n              {systemApps.map(app => renderAppGroup(app))}\n            </Details>\n          </div>\n        </nav>\n      </div>\n    </Main>\n  )\n}\n\nMenuPanel.propTypes = {\n  appInstanceGroups: PropTypes.arrayOf(AppInstanceGroupType).isRequired,\n  appsStatus: AppsStatusType.isRequired,\n  daoAddress: DaoAddressType.isRequired,\n  daoStatus: DaoStatusType.isRequired,\n  onOpenApp: PropTypes.func.isRequired,\n  showOrgSwitcher: PropTypes.bool,\n}\n\nfunction AnimatedMenuPanel({\n  autoClosing,\n  className,\n  onMenuPanelClose,\n  opened,\n  ...props\n}) {\n  const theme = useTheme()\n  const [animate, setAnimate] = useState(autoClosing)\n\n  useEffect(() => {\n    // If autoClosing has changed, it means we are switching from autoClosing\n    // to fixed or the opposite, and we should stop animating the panel for a\n    // short period of time.\n    setAnimate(false)\n    const animateTimer = setTimeout(() => setAnimate(true), 0)\n    return () => clearTimeout(animateTimer)\n  }, [autoClosing])\n\n  return (\n    <Spring\n      from={{ menuPanelProgress: 0 }}\n      to={{ menuPanelProgress: Number(opened) }}\n      config={springs.lazy}\n      immediate={!animate}\n      native\n    >\n      {({ menuPanelProgress }) => (\n        <div\n          className={className}\n          css={`\n            /* When the panel is autoclosing, we want it over the top bar as well */\n            ${autoClosing\n              ? `\n                position: absolute;\n                height: 100%;\n                width: 100%;\n                top: 0;\n                ${!opened ? 'pointer-events: none' : ''}\n              `\n              : ''}\n          `}\n        >\n          {autoClosing && (\n            <AnimDiv\n              onClick={onMenuPanelClose}\n              css={`\n                position: absolute;\n                height: 100%;\n                width: 100%;\n                background: ${theme.overlay.alpha(0.9)};\n                ${!opened ? 'pointer-events: none' : ''}\n              `}\n              style={{\n                opacity: menuPanelProgress,\n              }}\n            />\n          )}\n          <AnimDiv\n            css={`\n              width: ${MENU_PANEL_WIDTH}px;\n              height: 100%;\n              flex: none;\n            `}\n            style={{\n              position: autoClosing ? 'absolute' : 'relative',\n              transform: menuPanelProgress.interpolate(\n                v =>\n                  `translate3d(\n                    ${lerp(\n                      v,\n                      -(MENU_PANEL_WIDTH + MENU_PANEL_SHADOW_WIDTH),\n                      0\n                    )}px, 0, 0)`\n              ),\n            }}\n          >\n            <MenuPanel showOrgSwitcher={autoClosing} {...props} />\n          </AnimDiv>\n        </div>\n      )}\n    </Spring>\n  )\n}\nAnimatedMenuPanel.propTypes = {\n  autoClosing: PropTypes.bool,\n  className: PropTypes.string,\n  onMenuPanelClose: PropTypes.func.isRequired,\n  opened: PropTypes.bool,\n  ...MenuPanel.propTypes,\n}\n\nfunction Main(props) {\n  const theme = useTheme()\n  return (\n    <div\n      css={`\n        background: ${theme.surface};\n        width: 100%;\n        height: 100%;\n        display: flex;\n        flex: none;\n        flex-direction: column;\n        ${unselectable};\n      `}\n      {...props}\n    />\n  )\n}\n\nfunction Heading({ label, children, ...props }) {\n  const theme = useTheme()\n  return (\n    <h1\n      css={`\n        display: flex;\n        justify-content: flex-start;\n        align-items: center;\n        height: ${3 * GU}px;\n        margin-left: ${3 * GU}px;\n        color: ${theme.surfaceContentSecondary};\n        ${textStyle('label2')}\n        font-weight: 400;\n      `}\n      {...props}\n    >\n      <div\n        css={`\n          margin-top: 2px;\n        `}\n      >\n        {label}\n      </div>\n      {children && <div>{children}</div>}\n    </h1>\n  )\n}\nHeading.propTypes = {\n  children: PropTypes.node,\n  label: PropTypes.node,\n}\n\nexport default AnimatedMenuPanel\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport { Button, EmptyStateCard } from '@aragon/ui'\nimport appNotFoundPng from './assets/app-not-found.png'\n\nconst App404 = ({ onNavigateBack }) => (\n  <Main>\n    <EmptyStateCard\n      actionText=\"Go back\"\n      illustration={\n        <img width=\"140\" height=\"140\" src={appNotFoundPng} alt=\"\" />\n      }\n      action={<Button label=\"Go back\" onClick={onNavigateBack} />}\n      text=\"Oops, we couldn't find an app installed here.\"\n    />\n  </Main>\n)\n\nApp404.propTypes = {\n  onNavigateBack: PropTypes.func.isRequired,\n}\n\nconst Main = styled.div`\n  display: flex;\n  height: 100%;\n  align-items: center;\n  justify-content: center;\n`\n\nexport default App404\n","import { soliditySha3 } from './web3'\n\n// See https://github.com/aragon/aragonOS/blob/v4.2.0/contracts/kernel/KernelConstants.sol#L26\nexport const KERNEL_CORE_NAMESPACE = soliditySha3('core')\nexport const KERNEL_APP_BASE_NAMESPACE = soliditySha3('base')\nexport const KERNEL_APP_ADDR_NAMESPACE = soliditySha3('app')\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport { Markdown, textStyle, useTheme, GU } from '@aragon/ui'\n\nconst ContentMarkdown = React.memo(({ content }) => {\n  const theme = useTheme()\n\n  return (\n    <Wrapper theme={theme}>\n      <Markdown content={content} />\n    </Wrapper>\n  )\n})\n\nContentMarkdown.propTypes = {\n  content: PropTypes.string,\n}\n\nContentMarkdown.defaultProps = {\n  content: '',\n}\n\nconst Wrapper = styled.section`\n  margin-top: ${1 * GU}px;\n  padding-right: ${1 * GU}px;\n  h2,\n  h3,\n  h4 {\n    font-weight: bold;\n    margin-top: ${3 * GU}px;\n    ${textStyle('label2')};\n    color: ${({ theme }) => theme.contentSecondary};\n  }\n\n  p,\n  li {\n    margin: ${1 * GU}px 0;\n  }\n\n  ul {\n    margin: ${1 * GU}px ${2 * GU}px;\n    list-style: none;\n  }\n\n  ul li::before {\n    content: 'â€¢';\n    color: ${({ theme }) => theme.accent};\n    font-weight: bold;\n    display: inline-block;\n    width: 1em;\n    margin-left: -1em;\n  }\n`\n\nexport default ContentMarkdown\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { Link, GU, RADIUS } from '@aragon/ui'\nimport { RepoType } from '../../prop-types'\nimport { imgSrcFromBase } from '../../util/utils'\n\nconst Screenshots = React.memo(function Screenshots({\n  screenshots,\n  repo: { baseUrl },\n}) {\n  return (\n    <div\n      css={`\n        overflow-x: auto;\n      `}\n    >\n      <div\n        css={`\n          display: grid;\n          grid-template-columns: repeat(${screenshots.length}, 1fr);\n          grid-gap: ${3 * GU}px;\n          width: 100%;\n          /* some room for the box-shadow to show */\n          padding: 5px;\n        `}\n      >\n        {screenshots.map(({ src }, index) => {\n          const url = imgSrcFromBase(baseUrl, src)\n\n          return (\n            <Link key={url} href={url} external>\n              <img\n                key={src}\n                src={url}\n                alt=\"\"\n                width=\"225\"\n                height=\"143\"\n                css={`\n                  display: block;\n                  border-radius: ${RADIUS}px;\n                  box-shadow: 0px 3px 3px rgba(111, 116, 126, 0.15);\n                `}\n              />\n            </Link>\n          )\n        })}\n      </div>\n    </div>\n  )\n})\n\nScreenshots.propTypes = {\n  repo: RepoType.isRequired,\n  screenshots: PropTypes.arrayOf(\n    PropTypes.shape({\n      src: PropTypes.string.isRequired,\n    })\n  ).isRequired,\n}\n\nexport default Screenshots\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport {\n  Bar,\n  BackButton,\n  Box,\n  Button,\n  Split,\n  Link,\n  GU,\n  textStyle,\n  useLayout,\n  useTheme,\n} from '@aragon/ui'\nimport AppIcon from '../../../components/AppIcon/AppIcon'\nimport ContentMarkdown from './ContentMarkdown'\nimport LocalIdentityBadge from '../../../components/IdentityBadge/LocalIdentityBadge'\nimport { RepoType } from '../../../prop-types'\nimport { useRepoDetails } from '../../../hooks'\nimport Screenshots from '../Screenshots'\nimport { sanitizeCodeRepositoryUrl } from '../../../util/url'\nimport { useWallet } from '../../../contexts/wallet'\nimport { blockExplorerUrl } from 'use-wallet'\nimport { getChainId } from '../../../util/network'\n\nconst AppContent = React.memo(\n  ({ repo, repoVersions, onRequestUpgrade, onClose }) => {\n    const theme = useTheme()\n    const { layoutName } = useLayout()\n    const { networkType } = useWallet()\n    const {\n      name,\n      instances,\n      baseUrl,\n      currentVersion,\n      latestVersion: {\n        content: {\n          author,\n          icons,\n          description = 'No description.',\n          screenshots = [],\n          source_url: sourceUrl,\n          details_url: detailsUrl,\n        },\n        version: latestVersion,\n      },\n      repoAddress,\n      repoName,\n    } = repo\n    const repoDetails = useRepoDetails(baseUrl, detailsUrl)\n    const canUpgrade =\n      Boolean(currentVersion) && currentVersion.version !== latestVersion\n    const compact = layoutName === 'small'\n\n    return (\n      <React.Fragment>\n        <Bar>\n          <BackButton onClick={onClose} />\n        </Bar>\n        <Split\n          primary={\n            <Box>\n              <div\n                css={`\n                  display: grid;\n                  grid-template-columns: auto;\n                  grid-gap: ${4 * GU}px;\n                `}\n              >\n                <div\n                  css={`\n                    display: grid;\n                    grid-template-columns: auto auto 1fr;\n                    grid-gap: ${2 * GU}px;\n\n                    display: flex;\n                    flex-direction: row;\n                    flex-wrap: wrap;\n                    align-items: center;\n                    justify-content: space-between;\n                  `}\n                >\n                  <div\n                    css={`\n                      display: grid;\n                      grid-template-columns: auto auto;\n                      grid-gap: ${2 * GU}px;\n                    `}\n                  >\n                    <AppIcon app={{ baseUrl, icons }} size={80} radius={12} />\n                    <div\n                      css={`\n                        display: flex;\n                        flex-direction: column;\n                        align-items: flex-start;\n                        justify-content: center;\n                        margin-right: ${2.5 * GU}px;\n                      `}\n                    >\n                      <h1\n                        css={`\n                          color: ${theme.content};\n                          ${textStyle('title3')};\n                          white-space: nowrap;\n                          margin-bottom: ${1 * GU}px;\n                        `}\n                      >\n                        {name}\n                      </h1>\n                      {author && (\n                        <h2\n                          css={`\n                            color: ${theme.contentSecondary};\n                            ${textStyle('body2')};\n                            display: grid;\n                            grid-gap: ${1.5 * GU}px;\n                            grid-template-columns: auto auto;\n                          `}\n                        >\n                          By <LocalIdentityBadge entity={author} />\n                        </h2>\n                      )}\n                    </div>\n                  </div>\n                  {canUpgrade && onRequestUpgrade && (\n                    <Button\n                      mode=\"strong\"\n                      onClick={onRequestUpgrade}\n                      css={`\n                        width: ${compact ? '100%' : '128px'};\n                        margin: ${2.5 * GU}px 0;\n                        align-self: center;\n                      `}\n                    >\n                      Upgrade app\n                    </Button>\n                  )}\n                </div>\n                {screenshots.length > 0 && (\n                  <Screenshots repo={repo} screenshots={screenshots} />\n                )}\n                <div\n                  css={`\n                    display: grid;\n                    grid-template-columns: ${compact ? 'auto' : '60% auto'};\n                    grid-column-gap: ${compact ? 0 : 5 * GU}px;\n                  `}\n                >\n                  <div>\n                    <DetailsGroup>\n                      <Heading2 theme={theme}>Description</Heading2>\n                      <div>{description}</div>\n                    </DetailsGroup>\n                    <DetailsGroup>\n                      {!!repoDetails && (\n                        <React.Fragment>\n                          <Heading2 theme={theme}>Details</Heading2>\n                          <ContentMarkdown content={repoDetails} />\n                        </React.Fragment>\n                      )}\n                    </DetailsGroup>\n                  </div>\n                  <div>\n                    <DetailsGroup>\n                      <Heading2 theme={theme}>Installed instances</Heading2>\n                      <div\n                        css={`\n                          display: inline-grid;\n                          grid-template-columns: auto;\n                          grid-gap: ${1 * GU}px;\n                        `}\n                      >\n                        {instances.map(({ proxyAddress }) => (\n                          <LocalIdentityBadge\n                            entity={proxyAddress}\n                            key={proxyAddress}\n                          />\n                        ))}\n                      </div>\n                    </DetailsGroup>\n                    <DetailsGroup>\n                      <Heading2 theme={theme}>Source code</Heading2>\n                      <BreakLink compact={compact}>\n                        {sourceUrl ? (\n                          <Link external href={sourceUrl}>\n                            {sanitizeCodeRepositoryUrl(sourceUrl)}\n                          </Link>\n                        ) : (\n                          'No source code link.'\n                        )}\n                      </BreakLink>\n                    </DetailsGroup>\n                    {!!repoAddress && !!repoAddress && (\n                      <DetailsGroup>\n                        <Heading2 theme={theme}>Package Name</Heading2>\n                        <BreakLink compact={compact}>\n                          <Link\n                            external\n                            href={blockExplorerUrl(\n                              'address',\n                              repoAddress,\n                              getChainId(networkType)\n                            )}\n                          >\n                            {repoName}\n                          </Link>\n                        </BreakLink>\n                      </DetailsGroup>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </Box>\n          }\n          secondary={\n            <Box\n              padding={0}\n              heading={\n                <div\n                  css={`\n                    display: flex;\n                    justify-content: space-between;\n                    width: 100%;\n                  `}\n                >\n                  <ReposHeader theme={theme}>App version</ReposHeader>\n                  <ReposHeader theme={theme}>Release date</ReposHeader>\n                </div>\n              }\n            >\n              {repoVersions}\n            </Box>\n          }\n        />\n      </React.Fragment>\n    )\n  }\n)\n\nAppContent.propTypes = {\n  repo: RepoType.isRequired,\n  repoVersions: PropTypes.node,\n  onRequestUpgrade: PropTypes.func,\n  onClose: PropTypes.func,\n}\n\nconst ReposHeader = styled.span`\n  color: ${({ theme }) => theme.contentSecondary};\n  ${textStyle('label2')};\n`\n\nconst Heading2 = styled.h2`\n  margin-bottom: ${1 * GU}px;\n  color: ${({ theme }) => theme.contentSecondary};\n  ${textStyle('label2')};\n`\n\nconst DetailsGroup = styled.div`\n  margin-bottom: ${3 * GU}px;\n`\n\nconst BreakLink = styled.div`\n  word-break: break-all;\n`\n\nexport default AppContent\n","import React, { useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport {\n  Card,\n  GU,\n  IconExternal,\n  textStyle,\n  unselectable,\n  useLayout,\n  useTheme,\n} from '@aragon/ui'\n\nconst AppCard = React.memo(function AppCard({\n  onClick,\n  link,\n  icon,\n  name,\n  tag,\n  description,\n}) {\n  const theme = useTheme()\n  const { layoutName } = useLayout()\n  const compactMode = layoutName === 'small'\n  const handleClick = useCallback(() => onClick(link), [onClick, link])\n\n  return (\n    <Card onClick={handleClick} css={onClick ? 'display: block;' : ''}>\n      <CardMain compactMode={compactMode}>\n        {link && <StyledIconExternal compactMode={compactMode} theme={theme} />}\n        <Icon compactMode={compactMode}>{icon}</Icon>\n        <Name compactMode={compactMode}>{name}</Name>\n        <TagWrapper compactMode={compactMode} link={link}>\n          {tag}\n        </TagWrapper>\n        <Description theme={theme} compactMode={compactMode}>\n          {description}\n        </Description>\n      </CardMain>\n    </Card>\n  )\n})\n\nAppCard.propTypes = {\n  onClick: PropTypes.func,\n  link: PropTypes.string,\n  icon: PropTypes.node.isRequired,\n  name: PropTypes.string.isRequired,\n  tag: PropTypes.node.isRequired,\n  description: PropTypes.string.isRequired,\n}\n\nconst CardMain = styled.section`\n  ${unselectable};\n  position: relative;\n  overflow: hidden;\n  height: 100%;\n  width: 100%;\n  white-space: initial;\n\n  ${({ compactMode }) =>\n    compactMode\n      ? `\n          display: grid;\n          grid-template-columns: auto 1fr;\n          grid-template-rows: auto auto;\n          grid-template-areas:\n            \"icon title\"\n            \"icon description\";\n          padding: ${3 * GU}px ${1.5 * GU}px ${1.5 * GU}px ${3 * GU}px;\n        `\n      : `\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          padding-top: ${5 * GU}px;\n        `}\n`\n\nconst Icon = styled.div`\n  height: ${9 * GU}px;\n  width: ${9 * GU}px;\n  ${({ compactMode }) =>\n    compactMode\n      ? `\n        grid-area: icon;\n        margin-right: ${1.5 * GU}px;\n        width: 100%;\n        height: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: flex-start;\n      `\n      : `\n        margin-bottom: ${2 * GU}px;\n      `}\n`\n\nconst Name = styled.p`\n  display: flex;\n  width: 100%;\n  ${textStyle('title4')}\n  ${({ compactMode }) =>\n    compactMode\n      ? `\n        grid-area: title;\n        align-self: flex-end;\n      `\n      : `\n        justify-content: center;\n        margin-bottom: ${1 * GU}px;\n      `}\n`\n\nconst TagWrapper = styled.div`\n  ${({ compactMode, link }) =>\n    compactMode\n      ? `\n        position: absolute;\n        top: ${1.5 * GU}px;\n        right: ${(link ? 5 : 1.5) * GU}px;\n      `\n      : `\n        max-width: 100%;\n        padding: 0 ${2.5 * GU}px;\n        margin-bottom: ${1 * GU}px;\n      `}\n`\n\nconst Description = styled.p`\n  color: ${({ theme }) => theme.contentSecondary};\n  ${textStyle('body2')};\n  text-align: left;\n  grid-area: description;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  height: fit-content;\n\n  ${({ compactMode }) =>\n    compactMode\n      ? `\n        -webkit-line-clamp: 2;\n        margin-top: ${0.5 * GU}px;\n      `\n      : `\n        text-align: center;\n        padding: 0 1rem;\n        -webkit-line-clamp: 3;\n      `}\n`\n\nfunction StyledIconExternal({ compactMode, theme }) {\n  const paddingGU = compactMode ? 1 : 1.5\n  return (\n    <IconExternal\n      css={`\n        color: ${theme.surfaceIcon};\n        position: absolute;\n        top: ${paddingGU * GU}px;\n        right: ${paddingGU * GU}px;\n      `}\n    />\n  )\n}\nStyledIconExternal.propTypes = {\n  compactMode: PropTypes.bool,\n  theme: PropTypes.object.isRequired,\n}\n\nexport default AppCard\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport { Trail, animated } from 'react-spring'\nimport {\n  Info,\n  Tag,\n  GU,\n  springs,\n  textStyle,\n  useLayout,\n  useTheme,\n} from '@aragon/ui'\nimport { RepoType } from '../../../prop-types'\nimport { dateFormat } from '../../../util/date'\n\nconst { tr: AnimTr } = animated\n\nconst RepoVersions = ({ animate, repo: { currentVersion, versions } }) => {\n  const theme = useTheme()\n  const { layoutName } = useLayout()\n  const padding = (layoutName === 'small' ? 2 : 3) * GU\n\n  return (\n    <div\n      css={`\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n      `}\n    >\n      <table\n        css={`\n          border-collapse: collapse;\n          width: 100%;\n          margin-top: ${0.5 * GU}px;\n        `}\n      >\n        <tbody>\n          <Trail\n            items={versions}\n            keys={v => v.version}\n            from={{ progress: 0 }}\n            to={{ progress: 1 }}\n            config={springs.smooth}\n            delay={150}\n            immediate={!animate}\n            native\n          >\n            {/* eslint-disable react/prop-types */\n            ({ timestamp, version }) => ({ progress }) => {\n              const currentItem =\n                Boolean(currentVersion) && version === currentVersion.version\n\n              return (\n                <AnimTr\n                  key={name}\n                  css={\n                    currentItem ? `background: ${theme.surfaceSelected}` : ''\n                  }\n                  style={{\n                    opacity: progress,\n                    transform: progress.interpolate(\n                      v => `translate3d(${10 * (1 - v)}%, 0, 0)`\n                    ),\n                  }}\n                >\n                  <Td\n                    css={`\n                      padding-left: ${padding}px;\n                    `}\n                  >\n                    {version}{' '}\n                    {currentItem && (\n                      <Tag\n                        css={`\n                          margin-left: ${1 * GU}px;\n                        `}\n                      >\n                        current\n                      </Tag>\n                    )}\n                  </Td>\n                  <Td\n                    css={`\n                      padding-right: ${padding}px;\n                      text-align: right;\n                      color: ${theme.surfaceContentSecondary};\n                      ${textStyle('body2')}\n                    `}\n                  >\n                    {timestamp ? (\n                      <time\n                        dateTime={dateFormat(timestamp)}\n                        title={dateFormat(timestamp, 'standard')}\n                      >\n                        {dateFormat(timestamp, 'onlyDate')}\n                      </time>\n                    ) : (\n                      ''\n                    )}\n                  </Td>\n                </AnimTr>\n              )\n            }\n            /* eslint-enable react/prop-types */\n            }\n          </Trail>\n        </tbody>\n      </table>\n\n      <div\n        css={`\n          margin: ${2 * GU}px ${padding}px;\n        `}\n      >\n        {currentVersion ? (\n          <Info>\n            Minor and patch upgrades are front-end only, and are performed\n            automatically.\n          </Info>\n        ) : (\n          <Info mode=\"warning\">\n            This organization is currently using an unpublished version of this\n            application.\n          </Info>\n        )}\n      </div>\n    </div>\n  )\n}\n\nRepoVersions.propTypes = {\n  repo: RepoType.isRequired,\n  animate: PropTypes.bool,\n}\n\nconst Td = styled.td`\n  padding: ${1 * GU}px 0;\n`\n\nexport default RepoVersions\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { useLayout, CardLayout, GU, Tag } from '@aragon/ui'\nimport { RepoType } from '../../../prop-types'\nimport AppContent from './AppContent'\nimport AppCard from '../AppCard'\nimport RepoVersions from './RepoVersions'\nimport AppIcon from '../../../components/AppIcon/AppIcon'\n\nconst InstalledApps = React.memo(function InstalledApps({\n  repos,\n  openedRepoId,\n  onOpenApp,\n  onRequestUpgrade,\n  onCloseRepo,\n}) {\n  const { layoutName } = useLayout()\n  const compactMode = layoutName === 'small'\n  const rowHeight = compactMode ? 148 : 294\n  const columnWidthMin = compactMode ? 328 : 30 * GU\n\n  if (openedRepoId) {\n    const openedRepo = repos.find(repo => repo.appId === openedRepoId)\n    return (\n      <AppContent\n        repo={openedRepo}\n        repoVersions={<RepoVersions repo={openedRepo} />}\n        onRequestUpgrade={onRequestUpgrade}\n        onClose={onCloseRepo}\n      />\n    )\n  }\n\n  return (\n    <CardLayout columnWidthMin={columnWidthMin} rowHeight={rowHeight}>\n      {repos.map(repo => {\n        const {\n          repoName,\n          appId,\n          name,\n          baseUrl,\n          currentVersion,\n          latestVersion,\n        } = repo\n        const { description, icons } = latestVersion.content\n        const canUpgrade =\n          Boolean(currentVersion) &&\n          currentVersion.version !== latestVersion.version\n        const handleClick = () => onOpenApp(repoName)\n\n        return (\n          <AppCard\n            key={appId}\n            onClick={handleClick}\n            icon={\n              <AppIcon app={{ baseUrl, icons }} size={9 * GU} radius={12} />\n            }\n            name={name}\n            tag={\n              <Tag mode={canUpgrade ? 'new' : 'indicator'}>\n                {canUpgrade ? 'New version' : 'Up to date'}\n              </Tag>\n            }\n            description={description}\n          />\n        )\n      })}\n    </CardLayout>\n  )\n})\n\nInstalledApps.propTypes = {\n  repos: PropTypes.arrayOf(RepoType).isRequired,\n  openedRepoId: PropTypes.string,\n  onCloseRepo: PropTypes.func.isRequired,\n  onOpenApp: PropTypes.func.isRequired,\n  onRequestUpgrade: PropTypes.func.isRequired,\n}\n\nInstalledApps.defaultProps = {\n  openedRepoId: null,\n}\n\nexport default InstalledApps\n","import agentIcon from './icons/agent.svg'\nimport dandelionIcon from './icons/dandelion.svg'\nimport openEnterpriseIcon from './icons/open-enterprise.svg'\nimport pandoIcon from './icons/pando.svg'\nimport payrollIcon from './icons/payroll.svg'\nimport redemptionsIcon from './icons/redemptions.svg'\nimport surveyIcon from './icons/survey.svg'\nimport timeLockIcon from './icons/time-lock.svg'\nimport tokenRequestIcon from './icons/token-request.svg'\nimport { shuffleArray } from '../../../util/utils'\n\nexport const appsInDevelopment = [\n  // Ready\n  ...shuffleArray([\n    {\n      icon: agentIcon,\n      name: 'Agent',\n      status: 'ready',\n      description: `\n        Hold assets and interact with any other app, directly from your Aragon organization.\n      `,\n      link:\n        'https://hack.aragon.org/docs/guides-use-agent#installing-aragon-agent',\n    },\n    {\n      icon: openEnterpriseIcon,\n      name: 'Open Enterprise',\n      status: 'ready',\n      description: `\n        Suite for open and fluid organizations.\n        Bounties, range voting, and more.\n      `,\n      link: 'https://github.com/AutarkLabs/open-enterprise',\n    },\n    {\n      icon: dandelionIcon,\n      name: 'Dandelion',\n      status: 'ready',\n      description: `\n        Facilitate collaboration with an organization that makes it easy\n        for contributors to simply part ways when disagreements occur.\n      `,\n      link: 'https://1hive.org/dandelion',\n    },\n    {\n      icon: redemptionsIcon,\n      name: 'Redemptions',\n      status: 'ready',\n      description: `\n        Redeem tokens in exchange for a proportional\n        amount of the organization's eligible assets.\n      `,\n      link: 'https://github.com/1Hive/redemptions-app',\n    },\n    {\n      icon: tokenRequestIcon,\n      name: 'Token Request',\n      status: 'ready',\n      description: `\n        Requests an organization's tokens in exchange\n        for payment.\n      `,\n      link: 'https://github.com/1Hive/token-request-app',\n    },\n    {\n      icon: timeLockIcon,\n      name: 'Time Lock',\n      status: 'ready',\n      description: `\n        Require users to lock tokens for a configurable\n        period of time in order to forward an intent.\n      `,\n      link: 'https://github.com/1Hive/time-lock-app',\n    },\n  ]),\n  // Experimental\n  ...shuffleArray([\n    {\n      icon: surveyIcon,\n      name: 'Survey',\n      status: 'experimental',\n      description: `Create multi-option signaling votes.`,\n      link: 'https://github.com/aragon/aragon-apps/tree/master/apps/survey',\n    },\n    {\n      icon: payrollIcon,\n      name: 'Payroll',\n      status: 'experimental',\n      description: `\n        Pay and get paid, by the block.\n      `,\n      link: 'https://github.com/1Hive/payroll-app',\n    },\n    {\n      icon: pandoIcon,\n      name: 'Pando',\n      status: 'experimental',\n      description: `\n        Distributed git remote protocol based on IPFS,\n        Ethereum and aragonOS.\n      `,\n      link: 'https://github.com/pandonetwork/pando',\n    },\n  ]),\n]\n","import React, { useCallback } from 'react'\nimport { CardLayout, GU, Info, Link, Tag, useLayout } from '@aragon/ui'\nimport { appsInDevelopment } from './discover-apps-data'\nimport AppCard from '../AppCard'\nimport AppIcon from '../../../components/AppIcon/AppIcon'\n\nconst DiscoverApps = React.memo(function DiscoverApps() {\n  const { layoutName } = useLayout()\n  const compactMode = layoutName === 'small'\n  const rowHeight = compactMode ? 148 : 294\n  const columnWidthMin = compactMode ? 328 : 30 * GU\n  const handleClick = useCallback(link => {\n    if (link) {\n      window.open(link, '_blank', 'noopener')\n    }\n  }, [])\n\n  return (\n    <React.Fragment>\n      <Info\n        css={`\n          margin: 0 ${compactMode ? 2 * GU : 0}px;\n          margin-bottom: ${2 * GU}px;\n        `}\n      >\n        You will soon be able to install new apps into your Aragon organization\n        from here. In the meantime, you can use our{' '}\n        <Link\n          href=\"https://hack.aragon.org/docs/cli-dao-commands#dao-install\"\n          external\n        >\n          CLI guide\n        </Link>{' '}\n        and learn{' '}\n        <Link href=\"https://hack.aragon.org/docs/tutorial\" external>\n          how to create apps yourself.\n        </Link>{' '}\n        You can also preview some of the apps being developed.\n      </Info>\n      <CardLayout columnWidthMin={columnWidthMin} rowHeight={rowHeight}>\n        {appsInDevelopment.map(\n          ({ link, icon, name, status, description }, i) => (\n            <AppCard\n              key={i}\n              onClick={handleClick}\n              link={link}\n              icon={<AppIcon size={9 * GU} src={icon} radius={12} />}\n              name={name}\n              tag={<Tag mode=\"indicator\">{status}</Tag>}\n              description={description}\n            />\n          )\n        )}\n      </CardLayout>\n    </React.Fragment>\n  )\n})\n\nexport default DiscoverApps\n","import React from 'react'\nimport { LinkBase, GU, RADIUS, useTheme } from '@aragon/ui'\nimport AppIcon from '../../components/AppIcon/AppIcon'\nimport { repoBaseUrl } from '../../util/url'\nimport { RepoVersionType } from '../../prop-types'\nimport { useWallet } from '../../contexts/wallet'\nimport { blockExplorerUrl } from 'use-wallet'\nimport { getChainId } from '../../util/network'\n\nconst RepoBadge = React.memo(function RepoBadge({\n  displayVersion,\n  latestVersion,\n}) {\n  const theme = useTheme()\n  const { networkType } = useWallet()\n\n  // If content from the display version isn't available, default to using the latest version\n  const version = displayVersion || latestVersion\n  const {\n    content: { appId, contractAddress, name, icons },\n  } = version\n  const baseUrl = repoBaseUrl(appId, version, networkType)\n\n  return (\n    <div\n      css={`\n        display: inline-flex;\n        align-items: center;\n        min-width: 0;\n      `}\n    >\n      <LinkBase\n        focusRingSpacing={0}\n        external\n        href={blockExplorerUrl(\n          'address',\n          contractAddress,\n          getChainId(networkType)\n        )}\n        css={`\n          display: flex;\n          background: ${theme.badge};\n          color: ${theme.badgeContent};\n          border-radius: ${RADIUS}px;\n          align-items: center;\n          height: ${3 * GU}px;\n          align-items: center;\n          text-decoration: none;\n          width: 100%;\n        `}\n      >\n        <AppIcon\n          app={{ appId, baseUrl, icons }}\n          radius={RADIUS}\n          css={`\n            min-width: ${3 * GU}px;\n            border-top-right-radius: 0;\n            border-bottom-right-radius: 0;\n          `}\n        />\n        <div\n          css={`\n            padding: 0 5px;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            color: ${theme.content};\n          `}\n        >\n          {name}\n        </div>\n      </LinkBase>\n    </div>\n  )\n})\n\nRepoBadge.propTypes = {\n  displayVersion: RepoVersionType,\n  latestVersion: RepoVersionType.isRequired,\n}\n\nexport default RepoBadge\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport {\n  Button,\n  GU,\n  Info,\n  Link,\n  SidePanel,\n  SidePanelSeparator,\n  SidePanelSplit,\n  textStyle,\n  useTheme,\n} from '@aragon/ui'\nimport RepoBadge from '../../components/RepoBadge/RepoBadge'\nimport { RepoType } from '../../prop-types'\nimport { sanitizeCodeRepositoryUrl } from '../../util/url'\n\nclass UpgradeAppPanel extends React.PureComponent {\n  static propTypes = {\n    repo: RepoType,\n    onClose: PropTypes.func.isRequired,\n    onUpgrade: PropTypes.func.isRequired,\n    theme: PropTypes.object.isRequired,\n  }\n  state = {\n    repo: null,\n  }\n  static getDerivedStateFromProps(props, state) {\n    // `repo` is saved in the state, so that the selected app\n    // can still be visible while the panel is being closed.\n    if (props.repo !== state.repo && props.repo) {\n      return { repo: props.repo }\n    }\n    return {}\n  }\n  handleUpgradeClick = () => {\n    const {\n      repo: { appId, versions },\n      onUpgrade,\n    } = this.props\n    const { contractAddress } = versions[versions.length - 1]\n    onUpgrade(appId, contractAddress)\n  }\n  render() {\n    const { repo } = this.state\n    const { repo: propsRepo, onClose, theme } = this.props\n\n    if (!repo) {\n      return null\n    }\n\n    const { currentVersion, latestVersion } = repo\n    const {\n      name,\n      changelog_url: changelogUrl,\n      source_url: sourceUrl,\n    } = latestVersion.content\n\n    return (\n      <SidePanel\n        title={`Upgrade â€œ${name || 'Unknown'}â€`}\n        opened={Boolean(propsRepo)}\n        onClose={onClose}\n      >\n        <SidePanelSplit\n          css={`\n            border-bottom: 1px solid ${theme.border};\n            ${textStyle('body2')};\n          `}\n        >\n          <div>\n            <Heading2 theme={theme}>Current version</Heading2>\n            <RepoVersionWrapper>\n              {currentVersion.version}{' '}\n              <RepoBadge\n                displayVersion={currentVersion}\n                latestVersion={latestVersion}\n              />\n            </RepoVersionWrapper>\n          </div>\n          <div>\n            <Heading2 theme={theme}>New version</Heading2>\n            <RepoVersionWrapper>\n              {latestVersion.version}{' '}\n              <RepoBadge\n                displayVersion={latestVersion}\n                latestVersion={latestVersion}\n              />\n            </RepoVersionWrapper>\n          </div>\n        </SidePanelSplit>\n\n        <Part>\n          <Heading2 theme={theme}>Changelog</Heading2>\n          <p>\n            {changelogUrl ? (\n              <Link href={changelogUrl} external>\n                {sanitizeCodeRepositoryUrl(changelogUrl)}\n              </Link>\n            ) : (\n              'There is no changelog for this version.'\n            )}\n          </p>\n\n          <Heading2 theme={theme}>Source code</Heading2>\n          <p>\n            {sourceUrl ? (\n              <Link href={sourceUrl} external>\n                {sanitizeCodeRepositoryUrl(sourceUrl)}\n              </Link>\n            ) : (\n              'There is no available source for this app.'\n            )}\n          </p>\n        </Part>\n\n        <SidePanelSeparator />\n        <Part>\n          <Heading2 theme={theme}>Permissions</Heading2>\n          <p>This upgrade doesnâ€™t introduce any new permissions.</p>\n        </Part>\n\n        <SidePanelSeparator />\n\n        <Part>\n          <div\n            css={`\n              margin: ${4 * GU}px 0 ${2 * GU}px;\n            `}\n          >\n            <Button mode=\"strong\" wide onClick={this.handleUpgradeClick}>\n              Upgrade\n            </Button>\n          </div>\n\n          <Info>\n            All the â€œ{name}â€ app instances installed on your organization will\n            be upgraded.\n          </Info>\n        </Part>\n      </SidePanel>\n    )\n  }\n}\n\nconst RepoVersionWrapper = styled.div`\n  display: inline-grid;\n  grid-template-columns: auto auto;\n  grid-gap: ${1 * GU}px;\n  align-items: center;\n`\n\nconst Heading2 = styled.h2`\n  color: ${({ theme }) => theme.contentSecondary};\n  ${textStyle('label2')};\n  white-space: nowrap;\n  margin-bottom: ${2 * GU}px;\n`\n\nconst Part = styled.div`\n  ${textStyle('body2')};\n  padding: ${GU}px 0 ${3 * GU}px;\n  h2 {\n    margin: ${2 * GU}px 0 ${GU}px;\n  }\n`\n\nexport default props => {\n  const theme = useTheme()\n  return <UpgradeAppPanel {...props} theme={theme} />\n}\n","import styled from 'styled-components'\nimport { Card } from '@aragon/ui'\n\nconst EmptyBlock = styled(Card)`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: auto;\n  height: 180px;\n`\n\nexport default EmptyBlock\n","import React, { useCallback, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Button, Header, IconRefresh, Tabs } from '@aragon/ui'\nimport {\n  AppInstanceGroupType,\n  AragonType,\n  DaoAddressType,\n  RepoType,\n} from '../../prop-types'\nimport { log, removeStartingSlash } from '../../util/utils'\nimport { repoBaseUrl } from '../../util/url'\nimport { KERNEL_APP_BASE_NAMESPACE } from '../../util/aragonos'\nimport InstalledApps from './InstalledApps/InstalledApps'\nimport DiscoverApps from './DiscoverApps/DiscoverApps'\nimport UpgradeAppPanel from './UpgradeAppPanel'\nimport EmptyBlock from './EmptyBlock'\nimport { useWallet } from '../../contexts/wallet'\n\nfunction getLocation(localPath, extendedRepos) {\n  const defaultScreen = { screen: 'installed' }\n\n  if (!localPath) {\n    return defaultScreen\n  }\n\n  const [screen, data = null] = removeStartingSlash(localPath).split('/')\n\n  if (screen === 'installed') {\n    return {\n      screen,\n      openedRepo: (data && getRepoFromName(extendedRepos, data)) || null,\n    }\n  }\n\n  if (screen === 'discover') {\n    return { screen }\n  }\n\n  return defaultScreen\n}\n\nfunction useUpgradeApp(wrapper, kernelAddress, { onDone }) {\n  const upgradeApp = useCallback(\n    async (appId, appAddress) => {\n      log('setApp', appId, appAddress)\n\n      // Calculate the path, if it exists\n      const updatePath = await wrapper.getTransactionPath(\n        kernelAddress, // destination (Kernel)\n        'setApp', // method\n        [KERNEL_APP_BASE_NAMESPACE, appId, appAddress] // params\n      )\n\n      // Try to perform the path\n      wrapper.performTransactionPath(updatePath)\n\n      if (onDone) {\n        onDone()\n      }\n    },\n    [wrapper, kernelAddress, onDone]\n  )\n\n  return upgradeApp\n}\n\n// Extend, cache and return the repos\nfunction getExtendedRepos(appInstanceGroups, repos, networkType) {\n  return repos.map(repo => {\n    const appGroup = appInstanceGroups.find(\n      appGroup => appGroup.appId === repo.appId\n    )\n    const { name, instances, repoName } = appGroup || {}\n\n    return {\n      ...repo,\n      // Use latest versionâ€™s assets\n      baseUrl: repoBaseUrl(repo.appId, repo.latestVersion, networkType),\n      instances: instances || [],\n      name: name || '',\n      // if app was published missing content, repoName could be missing\n      // use the latestVersion app name instead\n      repoName: repoName || repo.latestVersion?.content?.appName || '',\n    }\n  })\n}\n\nfunction getRepoFromName(extendedRepos, name) {\n  return extendedRepos.find(repo => repo.repoName === name)\n}\n\nconst AppCenter = React.memo(function AppCenter({\n  appInstanceGroups,\n  canUpgradeOrg,\n  compactMode,\n  daoAddress,\n  localPath,\n  onPathRequest,\n  onUpgradeAll,\n  repos,\n  reposLoading,\n  wrapper,\n}) {\n  const [upgradePanelOpened, setUpgradePanelOpened] = useState(false)\n  const { networkType, chainId } = useWallet()\n\n  const SCREENS = useMemo(() => {\n    let result = [{ id: 'installed', label: 'Installed apps' }]\n    if (chainId === 1 || chainId === 4) {\n      result = [...result, { id: 'discover', label: 'Discover apps' }]\n    }\n    return result\n  }, [chainId])\n\n  const extendedRepos = useMemo(\n    () => getExtendedRepos(appInstanceGroups, repos, networkType),\n    [appInstanceGroups, repos, networkType]\n  )\n\n  const { screen, openedRepo } = getLocation(localPath, extendedRepos)\n\n  const openUpgradePanel = useCallback(() => {\n    setUpgradePanelOpened(true)\n  }, [])\n\n  const closeUpgradePanel = useCallback(() => {\n    setUpgradePanelOpened(false)\n  }, [])\n\n  const upgradeApp = useUpgradeApp(wrapper, daoAddress.address, {\n    onDone() {\n      closeUpgradePanel()\n    },\n  })\n\n  const changeScreen = useCallback(\n    screenIndex => {\n      onPathRequest(`/${SCREENS[screenIndex].id}`)\n    },\n    [onPathRequest, SCREENS]\n  )\n\n  const handleOpenRepo = useCallback(\n    repoName => {\n      onPathRequest(`/installed/${repoName}`)\n    },\n    [onPathRequest]\n  )\n\n  const handleCloseRepo = useCallback(() => {\n    onPathRequest(`/installed`)\n  }, [onPathRequest])\n\n  return (\n    <React.Fragment>\n      <Header\n        primary=\"App Center\"\n        secondary={\n          canUpgradeOrg &&\n          screen !== 'discover' &&\n          !openedRepo && (\n            <Button\n              mode=\"strong\"\n              onClick={onUpgradeAll}\n              label=\"Upgrade to 0.8\"\n              icon={<IconRefresh />}\n            />\n          )\n        }\n      />\n      {!openedRepo && (\n        <Tabs\n          items={SCREENS.map(screen => screen.label)}\n          selected={SCREENS.findIndex(s => s.id === screen)}\n          onChange={changeScreen}\n        />\n      )}\n      {screen === 'installed' &&\n        (reposLoading ? (\n          <EmptyBlock>Loading appsâ€¦</EmptyBlock>\n        ) : (\n          <InstalledApps\n            onOpenApp={handleOpenRepo}\n            onRequestUpgrade={openUpgradePanel}\n            openedRepoId={openedRepo && openedRepo.appId}\n            repos={extendedRepos}\n            onCloseRepo={handleCloseRepo}\n          />\n        ))}\n      {screen === 'discover' && <DiscoverApps />}\n\n      <UpgradeAppPanel\n        repo={upgradePanelOpened ? openedRepo : null}\n        onClose={closeUpgradePanel}\n        onUpgrade={upgradeApp}\n      />\n    </React.Fragment>\n  )\n})\n\nAppCenter.propTypes = {\n  appInstanceGroups: PropTypes.arrayOf(AppInstanceGroupType).isRequired,\n  canUpgradeOrg: PropTypes.bool.isRequired,\n  compactMode: PropTypes.bool,\n  daoAddress: DaoAddressType.isRequired,\n  localPath: PropTypes.string,\n  onPathRequest: PropTypes.func.isRequired,\n  onUpgradeAll: PropTypes.func.isRequired,\n  repos: PropTypes.arrayOf(RepoType).isRequired,\n  reposLoading: PropTypes.bool.isRequired,\n  wrapper: AragonType,\n}\n\nAppCenter.defaultProps = {\n  canUpgradeOrg: false,\n}\n\nexport default AppCenter\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport { Link, textStyle, GU, LoadingRing } from '@aragon/ui'\nimport { AppType } from '../../prop-types'\nimport { shortenAddress } from '../../util/web3'\n\n// Tuple of [display name, app name]\nconst INSTALLABLE_APPS = [\n  ['Agent', 'agent'],\n  ['Finance', 'finance'],\n  ['Tokens', 'token-manager'],\n  ['Vault', 'vault'],\n  ['Voting', 'voting'],\n]\nconst SUGGESTED_COMMANDS = ['Exec', 'Act']\n\nfunction ConsoleFeedback({\n  apps,\n  currentParsedCommand,\n  loading,\n  onCommandClick,\n}) {\n  if (loading) {\n    return (\n      <div\n        css={`\n          width: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          padding: ${6 * GU}px 0 ${6 * GU}px 0;\n        `}\n      >\n        <LoadingRing />\n        <span\n          css={`\n            margin-left: ${1 * GU}px;\n            ${textStyle('body2')};\n          `}\n        >\n          Executing commandâ€¦\n        </span>\n      </div>\n    )\n  }\n\n  if (currentParsedCommand.length < 2) {\n    return (\n      <>\n        <Paragraph>\n          You can interact with this organization by using the following console\n          commands:\n        </Paragraph>\n        <div\n          css={`\n            overflow: auto;\n          `}\n        >\n          {SUGGESTED_COMMANDS.map(command => (\n            <InteractiveCommand\n              key={command}\n              css={`\n                display: block;\n              `}\n              onClick={() => onCommandClick(command)}\n            >\n              {command}\n            </InteractiveCommand>\n          ))}\n        </div>\n      </>\n    )\n  }\n\n  if (currentParsedCommand[0] === 'install') {\n    if (currentParsedCommand.length < 3) {\n      return (\n        <>\n          <Paragraph>You can install the following apps:</Paragraph>\n          <div\n            css={`\n              overflow: auto;\n            `}\n          >\n            {INSTALLABLE_APPS.map(([displayName, appName]) => (\n              <InteractiveCommand\n                key={appName}\n                css={`\n                  display: block;\n                `}\n                onClick={() => onCommandClick(appName)}\n              >\n                {displayName}\n              </InteractiveCommand>\n            ))}\n          </div>\n        </>\n      )\n    }\n\n    return (\n      <>\n        <Paragraph>\n          Please enter the corresponding parameters and permissions needed for\n          installing the app, in this format:\n        </Paragraph>\n        <Command\n          css={`\n            margin-left: ${1 * GU}px;\n          `}\n        >\n          install/appName/(â€¦initparams)/â€¦PERMISSION_ROLE:ADDRESS_MANAGER:ADDRESS_GRANTEE\n        </Command>\n        <Paragraph>\n          You can set multiple permissions by separating them with a comma.\n        </Paragraph>\n      </>\n    )\n  }\n\n  if (currentParsedCommand[0] === 'exec') {\n    if (currentParsedCommand.length < 3) {\n      return (\n        <>\n          <Paragraph>You can interact with the following apps:</Paragraph>\n          <div\n            css={`\n              overflow: auto;\n            `}\n          >\n            {apps.map(app => (\n              <InteractiveCommand\n                key={app.proxyAddress}\n                css={`\n                  display: block;\n                `}\n                onClick={() => onCommandClick(app.proxyAddress)}\n              >\n                <span>{app.name}</span> (\n                <span title={app.proxyAddress}>\n                  {shortenAddress(app.proxyAddress)}\n                </span>\n                )\n              </InteractiveCommand>\n            ))}\n          </div>\n        </>\n      )\n    }\n\n    return (\n      <>\n        <Paragraph>\n          Please enter the corresponding method and parameters needed for\n          interacting with the app, in this format:\n        </Paragraph>\n        <Command\n          css={`\n            margin-left: ${1 * GU}px;\n          `}\n        >\n          exec/appAddress/methodName(â€¦args)\n        </Command>\n      </>\n    )\n  }\n\n  if (currentParsedCommand[0] === 'act') {\n    if (currentParsedCommand.length < 3) {\n      const agentInstalled =\n        apps.filter(app => app.name.toLowerCase() === 'agent').length > 0\n      if (!agentInstalled) {\n        return (\n          <>\n            <Paragraph>\n              There are no Agent instances installed in this organization.\n            </Paragraph>\n            <Paragraph>\n              If you would like to install an Agent, please read{' '}\n              <Link\n                external\n                href=\"https://hack.aragon.org/docs/cli-dao-commands#dao-install\"\n              >\n                the documentation\n              </Link>{' '}\n              or ask our{' '}\n              <Link external href=\"https://spectrum.chat/aragon\">\n                Spectrum community\n              </Link>{' '}\n              for help.\n            </Paragraph>\n          </>\n        )\n      }\n\n      return (\n        <>\n          <Paragraph>\n            Please select the corresponding Agent instance to interact with:\n          </Paragraph>\n          <div\n            css={`\n              overflow: auto;\n            `}\n          >\n            {apps\n              .filter(app => app.name.toLowerCase() === 'agent')\n              .map((agentApp, index) => (\n                <InteractiveCommand\n                  key={agentApp.proxyAddress}\n                  css={`\n                    display: block;\n                  `}\n                  onClick={() => onCommandClick(agentApp.proxyAddress)}\n                >\n                  Agent #{index + 1} ({shortenAddress(agentApp.proxyAddress)})\n                </InteractiveCommand>\n              ))}\n          </div>\n        </>\n      )\n    }\n\n    return (\n      <>\n        <Paragraph>\n          Pass the parameters required for the Agent's execute function, in this\n          format:\n        </Paragraph>\n        <Command\n          css={`\n            margin-left: ${1 * GU}px;\n          `}\n        >\n          act/agentAddress/targetAddress/methodName(type: arg)\n        </Command>\n        <Paragraph>Where:</Paragraph>\n        <ul\n          css={`\n            margin-bottom: ${1 * GU}px;\n            list-style-position: inside;\n            ${textStyle('body2')};\n\n            > li {\n              margin-left: ${1 * GU}px;\n            }\n          `}\n        >\n          <li>\n            <span\n              css={`\n                ${textStyle('address1')}\n              `}\n            >\n              targetAddress\n            </span>\n            : the address of the contract to interact with\n          </li>\n          <li>\n            <span\n              css={`\n                ${textStyle('address1')}\n              `}\n            >\n              methodName\n            </span>\n            : the function call, with its types and parameters\n          </li>\n        </ul>\n      </>\n    )\n  }\n\n  return <Command css=\"margin: 0\">Unrecognized command</Command>\n}\n\nConsoleFeedback.propTypes = {\n  apps: PropTypes.arrayOf(AppType).isRequired,\n  currentParsedCommand: PropTypes.array,\n  loading: PropTypes.bool,\n  onCommandClick: PropTypes.func,\n}\n\nconst Command = styled.p`\n  margin-bottom: ${1 * GU}px;\n  ${textStyle('address1')};\n`\n\nconst InteractiveCommand = props => <Command as={Link} {...props} />\n\nconst Paragraph = styled.p`\n  margin-bottom: ${1 * GU}px;\n  ${textStyle('body2')};\n`\n\nexport default ConsoleFeedback\n","import { appendTrailingSlash } from '../../util/utils'\n\nconst SEPARATOR = '/'\n\nexport function buildCommand(command, nextToken) {\n  if (typeof command !== 'string' || typeof nextToken !== 'string') {\n    throw new Error(\n      `Parsing command failed, reason: wrong type passed in. Expected string, got ${typeof method}`\n    )\n  }\n\n  return appendTrailingSlash(\n    command\n      .split(SEPARATOR)\n      // Remove the last item, which will be an empty string if the command was\n      // terminated correctly with a /\n      .slice(0, -1)\n      .concat(nextToken.toLowerCase())\n      .join('/')\n  )\n}\n\nexport function parseCommand(command) {\n  if (typeof command !== 'string') {\n    throw new Error(\n      `Parsing command failed, reason: wrong type passed in. Expected string, got ${typeof method}`\n    )\n  }\n\n  return command.split(SEPARATOR)\n}\n\nexport function parseMethodCall(method) {\n  if (typeof method !== 'string') {\n    throw new Error(\n      `Parsing method failed, reason: wrong type passed in. Expected string, got ${typeof method}`\n    )\n  }\n  const trimmedMethod = method.trim()\n  const areParenthesisMalformed =\n    trimmedMethod.indexOf('(') === 0 ||\n    trimmedMethod.indexOf(')') !== trimmedMethod.length - 1\n  const [methodName, params] = trimmedMethod.replace(')', '').split('(')\n\n  if (methodName === '' || areParenthesisMalformed) {\n    throw new Error(\n      'Parsing method failed, reason: malformed method call. Please check if a parenthesis has been misplaced or if you are not passing the method name.'\n    )\n  }\n\n  if (params === '') {\n    return [methodName]\n  }\n\n  const splitParams = params.split(',').map(param => param.trim())\n  const isCalledWithArguments = splitParams.reduce(\n    (haveSeenSeparator, param) => haveSeenSeparator || param.includes(':'),\n    false\n  )\n  if (!isCalledWithArguments) {\n    const skippedParams = splitParams.includes('')\n    if (skippedParams) {\n      throw new Error(\n        'Parsing method failed, reason: skipped parameters or dangling commas. Please check if a comma has been misplaced or if you are skipping any parameters.'\n      )\n    }\n    return [methodName, splitParams]\n  }\n  const allParamsHaveSeparators = splitParams.reduce(\n    (previousParams, param) => previousParams && param.includes(':'),\n    true\n  )\n\n  if (!allParamsHaveSeparators) {\n    throw new Error(\n      'Parsing method failed, reason: not all parameters have the corresponding arguments. Please check if you have skipped an argument, or misplaced a separator (:).'\n    )\n  }\n\n  const methodParams = splitParams\n    .map(paramAndArgs => paramAndArgs.split(':')[0])\n    .map(param => param.trim())\n  const methodArgs = splitParams\n    .map(paramAndArgs => paramAndArgs.split(':')[1])\n    .map(arg => arg.trim())\n  const skippedParamsOrArgs =\n    methodParams.includes('') ||\n    methodArgs.includes('') ||\n    methodParams.length !== methodArgs.length\n  if (skippedParamsOrArgs) {\n    throw new Error(\n      'Parsing method failed, reason: not all parameters have the corresponding arguments. Please check if you have skipped an argument, or misplaced a separator (:).'\n    )\n  }\n  return [methodName, methodParams, methodArgs]\n}\n\nexport function parseInitParams(params) {\n  if (typeof params !== 'string') {\n    throw new Error(\n      `Parsing parameters failed, reason: wrong type passed in. Expected string, got ${typeof method}`\n    )\n  }\n\n  const areParamsMalformed =\n    params.indexOf('(') !== 0 || params.indexOf(')') !== params.length - 1\n\n  if (areParamsMalformed) {\n    throw new Error(\n      `Parsing parameters failed, reason: malformed init params. Please make sure you're wrapping the parameters between parenthesis correctly`\n    )\n  }\n\n  const parsedParams = params\n    .replace('(', '')\n    .replace(')', '')\n    .split(',')\n    .map(param => param.trim())\n  // Passed no params, this is valid\n  if (parsedParams.length === 1 && parsedParams[0] === '') {\n    return []\n  }\n  const paramsSkipped = parsedParams.includes('')\n  if (paramsSkipped) {\n    throw new Error(\n      `Parsing parameters failed, reason: skipped params or extra commas. Please make sure you're not skipping any parameters or have dangling commas`\n    )\n  }\n  return parsedParams\n}\n\nexport function parsePermissions(permissions) {\n  if (typeof permissions !== 'string') {\n    throw new Error(\n      `Parsing permissions failed: wrong type passed in. Expected string, got ${typeof method}`\n    )\n  }\n\n  const parsedPermissions = permissions\n    .split(',')\n    .map(permission => permission.trim())\n    .map(permission => permission.split(':'))\n    .map(permissionArr => permissionArr.map(permArg => permArg.trim()))\n\n  const arePermissionsFormattedCorrectly = parsedPermissions.reduce(\n    (arePastPermissionsValid, currentPermissionParams) =>\n      arePastPermissionsValid && currentPermissionParams.length === 3,\n    true\n  )\n\n  if (!arePermissionsFormattedCorrectly) {\n    throw new Error('Permissions malformed.')\n  }\n\n  return parsedPermissions\n}\n","import abi from 'web3-eth-abi'\n\nexport function encodeFunctionCallFromSignature(signature, params = []) {\n  const sigBytes = abi.encodeFunctionSignature(signature)\n\n  const types = signature.replace(')', '').split('(')[1]\n\n  // No params, return signature directly\n  if (types === '') {\n    return sigBytes\n  }\n  const paramBytes = abi.encodeParameters(types.split(','), params)\n\n  return `${sigBytes}${paramBytes.slice(2)}`\n}\n","import { parseMethodCall } from '../console-utils'\nimport { encodeFunctionCallFromSignature } from '../web3-encoding-utils'\n\nexport default async function actHandler(params, { wrapper }) {\n  const [\n    selectedAgentInstance,\n    targetAddress,\n    methodWithArgs,\n    ethAmount = '0',\n  ] = params\n  const [methodName, methodParams, methodArgs] = parseMethodCall(methodWithArgs)\n\n  const methodSignature = methodParams\n    ? `${methodName}(${methodParams.join(',')})`\n    : `${methodName}()`\n\n  const encodedFunctionCall = encodeFunctionCallFromSignature(\n    methodSignature,\n    methodArgs\n  )\n\n  const path = await wrapper.getTransactionPath(\n    selectedAgentInstance,\n    'execute(address,uint256,bytes)',\n    [targetAddress, ethAmount, encodedFunctionCall]\n  )\n  return path\n}\n","import { parseMethodCall } from '../console-utils'\n\nexport default async function execHandler(params, { wrapper }) {\n  const [proxyAddress, methodWithArgs] = params\n  const [methodSignature, args] = parseMethodCall(methodWithArgs)\n  const path = await wrapper.getTransactionPath(\n    proxyAddress,\n    methodSignature,\n    args\n  )\n  return path\n}\n","import { hash as namehash } from 'eth-ens-namehash'\nimport abi from 'web3-eth-abi'\nimport { parseInitParams, parsePermissions } from '../console-utils'\n\n// Maximum time (in milliseconds) to wait for a response\n// from the aragon.js apm repo content fetcher\nconst REPO_FETCH_TIMEOUT = 3000\nconst APP_POSTFIX = '.aragonpm.eth'\n\nexport default async function installHandler(params, { apps, wrapper }) {\n  // Get & properly parse arguments\n  const [appName, initArgs, permArgs] = params\n  const parsedInitArgs = parseInitParams(initArgs)\n  const parsedPermArgs = parsePermissions(permArgs)\n\n  // Resolve namehash and ens domain to fetch the app's repo content\n  const fullAppName = (appName.endsWith(APP_POSTFIX)\n    ? appName\n    : `${appName}${APP_POSTFIX}`\n  ).toLowerCase()\n  const appId = namehash(fullAppName)\n  const ensDomain = await wrapper.ens.resolve(appId)\n\n  const {\n    abi: appAbi,\n    contractAddress,\n    roles,\n  } = await wrapper.apm.fetchLatestRepoContent(ensDomain, {\n    fetchTimeout: REPO_FETCH_TIMEOUT,\n  })\n\n  // Get the initialize function to install and initialize the app\n  const initializeAbi = appAbi.find(({ name }) => name === 'initialize')\n  const encodedInitializeFunc = abi.encodeFunctionCall(\n    initializeAbi,\n    parsedInitArgs\n  )\n\n  const kernelProxyAddress = apps.find(\n    app => app.name.toLowerCase() === 'kernel'\n  ).proxyAddress\n\n  const path = await wrapper.getTransactionPath(\n    kernelProxyAddress,\n    'newAppInstance(bytes32,address,bytes,bool)',\n    [appId, contractAddress, encodedInitializeFunc, false]\n  )\n\n  // Get the second to last item in the path, as it is the account that will execute kernel.newAppInstance\n  const scriptExecutor = path[path.length - 2].to\n  const counterfactualAppAddr = await wrapper.kernelProxy.call(\n    'newAppInstance',\n    appId,\n    contractAddress,\n    encodedInitializeFunc,\n    false,\n    { from: scriptExecutor }\n  )\n\n  const installAppIntent = [\n    [\n      kernelProxyAddress,\n      'newAppInstance(bytes32,address,bytes,bool)',\n      [appId, contractAddress, encodedInitializeFunc, false],\n    ],\n  ]\n\n  const aclProxyAddress = apps.find(app => app.name.toLowerCase() === 'acl')\n    .proxyAddress\n\n  const permissionIntents = parsedPermArgs.map(([role, from, to]) => {\n    const roleBytes = roles.find(availableRole => availableRole.id === role)\n      .bytes\n\n    return [\n      aclProxyAddress,\n      'createPermission',\n      [to, counterfactualAppAddr, roleBytes, from],\n    ]\n  })\n\n  const intentBasket = [...installAppIntent, ...permissionIntents]\n  const {\n    path: pathForBasket,\n  } = await wrapper.getTransactionPathForIntentBasket(intentBasket)\n\n  return pathForBasket\n}\n","import actHandler from './act'\nimport execHandler from './exec'\nimport installHandler from './install'\n\nconst handlers = new Map([\n  ['act', actHandler],\n  ['exec', execHandler],\n  ['install', installHandler],\n])\n\nexport default handlers\n","import { useInside, GU } from '@aragon/ui'\nconst ICON_SIZES = new Map([\n  ['large', 6 * GU],\n  ['medium', 3 * GU],\n  ['small', 2 * GU],\n  ['tiny', 1.75 * GU],\n])\n\n// Mapping of button size => icon size\nconst BUTTON_ICON_SIZES = new Map([\n  ['medium', 'medium'],\n  ['small', 'medium'],\n  ['mini', 'small'],\n])\n\nexport function useIconSize(size) {\n  const [insideButtonIcon, buttonData] = useInside('Button:icon')\n\n  // If no size is set on the icon, and it is inside\n  // a Button icon slot, adapt it to the size of the button.\n  const sizeName =\n    !size && insideButtonIcon ? BUTTON_ICON_SIZES.get(buttonData.size) : size\n\n  return ICON_SIZES.get(sizeName || 'medium')\n}\n","import React from 'react'\nimport { useIconSize } from './useIconSize'\nimport PropTypes from 'prop-types'\n\nexport default function IconPrompt({ size, ...props }) {\n  const sizeValue = useIconSize(size)\n\n  return (\n    <svg\n      width={sizeValue}\n      height={sizeValue}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      {...props}\n    >\n      <path\n        d=\"M4.07527 6.03339L4.07526 6.03339C3.77491 6.28991 3.77491 6.71707 4.07526 6.97358L8.55562 10.8001L4.07526 14.6265L4.07526 14.6265C3.77491 14.883 3.77491 15.3102 4.07526 15.5667C4.3616 15.8112 4.81749 15.8112 5.10383 15.5667L10.1346 11.2701C10.2812 11.145 10.3599 10.9752 10.3599 10.8001C10.3599 10.6249 10.2812 10.4551 10.1346 10.3299L5.10383 6.03339L5.10382 6.03339C4.81749 5.78887 4.3616 5.78887 4.07527 6.03339Z\"\n        fill=\"#8FA4B5\"\n        stroke=\"#8FA4B5\"\n        strokeWidth=\"0.3\"\n      />\n      <path\n        d=\"M20.4224 16.7769H11.8293C11.663 16.7769 11.5275 16.8729 11.4396 16.9978C11.3514 17.123 11.3017 17.2881 11.3017 17.4635C11.3017 17.6388 11.3514 17.8039 11.4396 17.9292C11.5275 18.054 11.663 18.15 11.8293 18.15H20.4224C20.5887 18.15 20.7242 18.054 20.8121 17.9292C20.9002 17.8039 20.95 17.6388 20.95 17.4635C20.95 17.2881 20.9002 17.123 20.8121 16.9978C20.7242 16.8729 20.5887 16.7769 20.4224 16.7769Z\"\n        fill=\"#8FA4B5\"\n        stroke=\"#8FA4B5\"\n        strokeWidth=\"0.3\"\n      />\n    </svg>\n  )\n}\n\nIconPrompt.propTypes = {\n  size: PropTypes.oneOf(['large', 'medium', 'small', 'tiny']),\n}\n","import React, { useState, useEffect, useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Box,\n  Header,\n  Button,\n  Info,\n  TextInput,\n  IconEnter,\n  useTheme,\n  useToast,\n  GU,\n} from '@aragon/ui'\nimport { performTransactionPaths } from '../../aragonjs-wrapper'\nimport ConsoleFeedback from './ConsoleFeedback'\nimport { buildCommand, parseCommand } from './console-utils'\nimport handlers from './handlers'\nimport IconPrompt from './IconPrompt'\nimport KEYCODES from '../../keycodes'\nimport { clamp } from '../../util/math'\nimport { AragonType, AppType } from '../../prop-types'\nimport { CONSOLE_COMMAND_HISTORY_KEY } from './useConsole'\n\nfunction Console({ apps, wrapper }) {\n  const [command, setCommand] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [parsedState, setParsedState] = useState([])\n  const theme = useTheme()\n  const toast = useToast()\n  const performIntents = useMemo(\n    () => transactionPaths => {\n      performTransactionPaths(wrapper, transactionPaths)\n    },\n    [wrapper]\n  )\n\n  const executeCommand = useCallback(\n    async (commandHandler, params) => {\n      setLoading(true)\n      try {\n        const path = await commandHandler(params, { apps, wrapper })\n        performIntents([path])\n      } catch (error) {\n        console.error(error)\n        toast('Command execution failed')\n      } finally {\n        setLoading(false)\n      }\n    },\n    [toast, apps, wrapper, performIntents]\n  )\n\n  // handle input change\n  const handleChange = useCallback(input => {\n    const parsingResult = parseCommand(input)\n    setParsedState(parsingResult)\n    setCommand(input)\n  }, [])\n\n  // Handle command clicks\n  const handleCommandClick = useCallback(\n    clickedCommand => {\n      const newCommand = buildCommand(command, clickedCommand)\n      const parsingResult = parseCommand(newCommand)\n      setParsedState(parsingResult)\n      setCommand(newCommand)\n    },\n    [command]\n  )\n\n  const handleSubmit = useCallback(() => {\n    const [commandName, ...params] = parsedState\n    const handler = handlers.get(commandName)\n\n    if (typeof handler !== 'function') {\n      toast('Unrecognized command')\n      handleChange('')\n      return\n    }\n\n    executeCommand(handler, params)\n  }, [parsedState, toast, handleChange, executeCommand])\n\n  return (\n    <>\n      <Header primary=\"Console\" />\n      <Box>\n        <div\n          css={`\n            display: flex;\n          `}\n        >\n          <Prompt\n            command={command}\n            loading={loading}\n            onChange={handleChange}\n            onSubmit={handleSubmit}\n          />\n        </div>\n        <Info\n          css={`\n            margin: ${2 * GU}px 0 ${2 * GU}px 0;\n          `}\n          background={`${theme.background}`}\n          borderColor={`#ABBECF`}\n          color={`${theme.content}`}\n        >\n          <ConsoleFeedback\n            apps={apps}\n            currentParsedCommand={parsedState}\n            onCommandClick={handleCommandClick}\n            loading={loading}\n          />\n        </Info>\n        {!loading && (\n          <Info\n            css={`\n              margin-top: ${2 * GU}px;\n            `}\n          >\n            You can use the top/down arrow on your keyboard to display the\n            console history.\n          </Info>\n        )}\n      </Box>\n    </>\n  )\n}\n\nConsole.propTypes = {\n  apps: PropTypes.arrayOf(AppType).isRequired,\n  wrapper: AragonType,\n}\n\nfunction Prompt({ command, loading, onChange, onSubmit }) {\n  const [commandHistory, setCommandHistory] = useState([])\n  const [historyIndex, setHistoryIndex] = useState(0)\n\n  const isDisabled = useMemo(() => {\n    const parsedCommand = parseCommand(command)\n    const isValidInstall =\n      parsedCommand[0] === 'install' && parsedCommand.length === 4\n    const isValidExec =\n      parsedCommand[0] === 'exec' && parsedCommand.length === 3\n    const isValidAct =\n      parsedCommand[0] === 'act' &&\n      (parsedCommand.length === 4 || parsedCommand.length === 5)\n    return !(isValidInstall || isValidExec || isValidAct) || loading\n  }, [command, loading])\n\n  const handleChange = useCallback(e => onChange(e.target.value), [onChange])\n  const handleKeyDown = useCallback(\n    e => {\n      if (e.keyCode === KEYCODES.enter && !isDisabled) {\n        const newCommandHistory = [...commandHistory, command]\n        localStorage.setItem(\n          CONSOLE_COMMAND_HISTORY_KEY,\n          JSON.stringify(newCommandHistory)\n        )\n        setCommandHistory(newCommandHistory)\n        setHistoryIndex(newCommandHistory.length - 1)\n        onSubmit()\n      } else if (e.keyCode === KEYCODES.up || e.keyCode === KEYCODES.down) {\n        if (commandHistory.length === 0) {\n          return\n        }\n        const nextHistory = clamp(\n          historyIndex + (e.keyCode === KEYCODES.up ? -1 : 1),\n          0,\n          commandHistory.length - 1\n        )\n\n        if (e.keyCode === KEYCODES.down && nextHistory === historyIndex) {\n          onChange('')\n          return\n        }\n\n        setHistoryIndex(nextHistory)\n        onChange(commandHistory[nextHistory])\n      }\n    },\n    [command, commandHistory, historyIndex, isDisabled, onChange, onSubmit]\n  )\n\n  useEffect(() => {\n    const historyArray = localStorage.getItem(CONSOLE_COMMAND_HISTORY_KEY)\n    if (!historyArray) {\n      return\n    }\n    const parsedHistoryArray = JSON.parse(historyArray)\n    setCommandHistory(parsedHistoryArray)\n    setHistoryIndex(parsedHistoryArray.length - 1)\n  }, [])\n\n  return (\n    <>\n      <TextInput\n        value={command}\n        adornment={<IconPrompt />}\n        adornmentPosition=\"start\"\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        css={`\n          margin-right: ${1.5 * GU}px;\n        `}\n        wide\n      />\n      <Button\n        mode=\"strong\"\n        icon={<IconEnter />}\n        label=\"Enter\"\n        disabled={isDisabled}\n        onClick={onSubmit}\n      />\n    </>\n  )\n}\n\nPrompt.propTypes = {\n  command: PropTypes.string.isRequired,\n  loading: PropTypes.bool.isRequired,\n  onChange: PropTypes.func.isRequired,\n  onSubmit: PropTypes.func.isRequired,\n}\n\nexport default Console\n","import React, { useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { CardLayout, Card, GU, textStyle, useLayout } from '@aragon/ui'\nimport { AppType } from '../../prop-types'\nimport appIds from '../../known-app-ids'\n\nimport imgEagle from '../../assets/eagle.svg'\nimport imgAssignTokens from './assets/assign-tokens.png'\nimport imgCheckFinance from './assets/check-finance.png'\nimport imgNewPayment from './assets/new-payment.png'\nimport imgCreateNewVote from './assets/create-new-vote.png'\n\nconst EAGLE_DIMENSIONS = [1241, 833]\n\nconst ACTIONS = [\n  {\n    label: 'Assign Tokens',\n    appId: appIds['TokenManager'],\n    img: imgAssignTokens,\n  },\n  {\n    label: 'Vote',\n    appId: appIds['Voting'],\n    img: imgCreateNewVote,\n  },\n  {\n    label: 'Check Finance',\n    appId: appIds['Finance'],\n    img: imgCheckFinance,\n  },\n  {\n    label: 'New Payment',\n    appId: appIds['Finance'],\n    img: imgNewPayment,\n  },\n]\n\nfunction Home({ apps, onOpenApp }) {\n  const { layoutWidth, layoutName } = useLayout()\n\n  const appActions = useMemo(\n    () =>\n      ACTIONS.filter(\n        ({ appId }) => apps.findIndex(app => app.appId === appId) > -1\n      ),\n    [apps]\n  )\n\n  const handleOpen = useCallback(\n    appId => {\n      const app = apps.find(app => app.appId === appId)\n      if (app && onOpenApp) {\n        onOpenApp(app.proxyAddress)\n      }\n    },\n    [onOpenApp, apps]\n  )\n\n  return (\n    <div\n      css={`\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        display: grid;\n        align-items: center;\n        justify-content: center;\n        background: fixed ${layoutName === 'small' ? '0%' : '50%'} 100% /\n          ${EAGLE_DIMENSIONS[0]}px ${EAGLE_DIMENSIONS[1]}px no-repeat\n          url(${imgEagle});\n        overflow: auto;\n      `}\n    >\n      <div\n        css={`\n          position: relative;\n          z-index: 2;\n          width: ${layoutWidth}px;\n          padding: ${6 * GU}px 0;\n        `}\n      >\n        <h1\n          css={`\n            margin-bottom: ${6 * GU}px;\n            ${textStyle('title2')}\n            text-align: center;\n          `}\n        >\n          What do you want to do?\n        </h1>\n        <CardLayout rowHeight={33 * GU} columnWidthMin={31 * GU}>\n          {appActions.map(({ appId, img, label }, index) => (\n            <HomeCard\n              key={index}\n              appId={appId}\n              img={img}\n              label={label}\n              onOpen={handleOpen}\n            />\n          ))}\n        </CardLayout>\n      </div>\n    </div>\n  )\n}\n\nHome.propTypes = {\n  apps: PropTypes.arrayOf(AppType).isRequired,\n  onOpenApp: PropTypes.func.isRequired,\n}\n\nfunction HomeCard({ onOpen, appId, label, img }) {\n  const handleClick = useCallback(() => {\n    onOpen(appId)\n  }, [onOpen, appId])\n\n  return (\n    <Card\n      onClick={handleClick}\n      css={`\n        display: flex;\n        flex-direction: column;\n      `}\n    >\n      <img src={img} alt=\"\" width=\"184\" height=\"145\" />\n      <p\n        css={`\n          margin-top: ${2 * GU}px;\n          ${textStyle('title4')};\n        `}\n      >\n        {label}\n      </p>\n    </Card>\n  )\n}\n\nHomeCard.propTypes = {\n  onOpen: PropTypes.func.isRequired,\n  appId: PropTypes.string.isRequired,\n  label: PropTypes.string.isRequired,\n  img: PropTypes.string.isRequired,\n}\n\nexport default React.memo(Home)\n","module.exports = {\n  depositerABI: [{\"constant\":false,\"inputs\":[{\"name\":\"finance\",\"type\":\"address\"},{\"name\":\"token\",\"type\":\"address\"},{\"name\":\"many\",\"type\":\"uint256\"},{\"name\":\"why\",\"type\":\"string\"}],\"name\":\"pleaseAirdrop\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"_factory\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"}],\n  rinkeby: {\n    factory: '0xff4E0FE747f999a07AB03eBf3c8B3B5232Ef2350',\n    depositer: '0x39a4d265db942361d92e2b0039cae73ea72a2ff9',\n    tokens: [\n      '0x0d5263b7969144a852d58505602f630f9b20239d',\n      '0x6142214d83670226872d51e935fb57bec8832a60',\n      '0x1e1cab55639f67e70973586527ec1dfdaf9bf764',\n      '0x5e381afb0104d374f1f3ccde5ba7fe8f5b8af0e6',\n      '0xa53899a7eb70b309f05f8fdb344cdc8c8f272abe',\n      '0x5b2fdbba47e8ae35b9d6f8e1480703334f48b96c',\n      '0x51e53b52555a4ab7227423a7761cc8e418b147c8',\n      '0xc42da14b1c0ae7d4dd3946633f1046c3d46f3101',\n      '0x4fc6e3b791560f25ed4c1bf5e2db9ab0d0e80747',\n      '0x0527e400502d0cb4f214dd0d2f2a323fc88ff924'\n    ]\n  }\n}\n","import tokens from '@aragon/templates-tokens'\n\nexport function testTokensEnabled(network) {\n  return !!tokens[network]\n}\n\nexport default (web3, financeAddr, from, network = 'rinkeby') => {\n  const ts = tokens[network]\n  const depositer = new web3.eth.Contract(tokens.depositerABI, ts.depositer)\n\n  // rand values\n  const token = ts.tokens[Math.floor(ts.tokens.length * Math.random())]\n  const amount = web3.utils.toWei(Math.floor(1000 * Math.random()).toString())\n  const ref = 'Requested airdrop (test tokens)'\n\n  return depositer.methods\n    .pleaseAirdrop(financeAddr, token, amount, ref)\n    .send({ from, gas: 1e6 })\n}\n","import React, { useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Box,\n  Button,\n  Header,\n  IconCoin,\n  IconExternal,\n  Info,\n  Link,\n  GU,\n  textStyle,\n  unselectable,\n  useLayout,\n  useTheme,\n} from '@aragon/ui'\nimport LocalIdentityBadge from '../../components/IdentityBadge/LocalIdentityBadge'\nimport appIds from '../../known-app-ids'\nimport { getProviderString } from 'use-wallet'\nimport { getNetworkConfig } from '../../network-config'\nimport {\n  sanitizeNetworkType,\n  isOnEthMainnet,\n  getNetworkFullName,\n  getNetworkSettings,\n} from '../../util/network'\nimport { AppType, DaoAddressType } from '../../prop-types'\nimport { useRouting, ARAGONID_ENS_DOMAIN } from '../../routing'\nimport airdrop, { testTokensEnabled } from '../../testnet/airdrop'\nimport { toChecksumAddress } from '../../util/web3'\nimport { useWallet } from '../../contexts/wallet'\n\nconst Organization = React.memo(function Organization({\n  apps,\n  appsLoading,\n  canUpgradeOrg,\n  daoAddress,\n  onOpenApp,\n  onShowOrgVersionDetails,\n}) {\n  const theme = useTheme()\n  const { layoutName } = useLayout()\n  const wallet = useWallet()\n  const { mode } = useRouting()\n  const { orgAddress } = mode\n\n  const { settings: network } = getNetworkConfig(wallet.networkType)\n\n  const handleDepositTestTokens = useCallback(() => {\n    const finance = apps.find(app => app.appId === appIds.Finance)\n    if (finance && finance.proxyAddress) {\n      airdrop(wallet.web3, finance.proxyAddress, wallet.account)\n    }\n  }, [apps, wallet])\n\n  const handleOpenAgentApp = useCallback(() => {\n    const agent = apps.find(app => app.appId === appIds.Agent)\n    if (agent && agent.proxyAddress) {\n      onOpenApp(agent.proxyAddress)\n    }\n  }, [apps, onOpenApp])\n\n  const handleOpenFinanceApp = useCallback(() => {\n    const finance = apps.find(app => app.appId === appIds.Finance)\n    if (finance && finance.proxyAddress) {\n      onOpenApp(finance.proxyAddress)\n    }\n  }, [apps, onOpenApp])\n\n  const tenderlyImportUrl = useMemo(() => {\n    if (appsLoading) {\n      return ''\n    }\n\n    const contractsToImport = apps.map(({ name, proxyAddress }) => ({\n      name,\n      address: toChecksumAddress(proxyAddress),\n    }))\n\n    let contractsQueryParameter\n    let projectName = orgAddress\n    try {\n      contractsQueryParameter = encodeURIComponent(\n        JSON.stringify(contractsToImport)\n      )\n      if (projectName.endsWith(ARAGONID_ENS_DOMAIN)) {\n        projectName = projectName.substr(\n          0,\n          orgAddress.indexOf(ARAGONID_ENS_DOMAIN) - 1\n        )\n      }\n      projectName = encodeURIComponent(projectName)\n    } catch (err) {\n      console.error(\n        'Failed to encode query parameters for importing into Tenderly:',\n        err\n      )\n      return ''\n    }\n\n    return (\n      'https://dashboard.tenderly.co/integration?' +\n      `integration=aragon&network=${network.chainId}&` +\n      `project=${projectName}&` +\n      `contracts=${contractsQueryParameter}`\n    )\n  }, [apps, appsLoading, orgAddress, network.chainId])\n\n  const apmApps = apps.filter(app => !app.isAragonOsInternalApp)\n  const hasAgentApp = apps.some(app => app.appId === appIds.Agent)\n  const hasFinanceApp = apps.some(app => app.appId === appIds.Finance)\n  const checksummedDaoAddr =\n    daoAddress.address && toChecksumAddress(daoAddress.address)\n  const enableTransactions = wallet.connected && wallet.account\n  const isMainnet = isOnEthMainnet(network.type)\n  const shortAddresses = layoutName !== 'large'\n\n  const organizationText = checksummedDaoAddr ? (\n    <span>\n      This organization is deployed on {getNetworkFullName(network.type)}.{' '}\n      {canUpgradeOrg ? (\n        <span>\n          <Link onClick={onShowOrgVersionDetails}>\n            A new software update is available\n          </Link>\n          .\n        </span>\n      ) : (\n        <span>\n          The current software version is 0.8 Camino. You can see{' '}\n          <Link onClick={onShowOrgVersionDetails}>what's new here</Link>.\n        </span>\n      )}\n    </span>\n  ) : (\n    'Resolving organization addressâ€¦'\n  )\n\n  const depositFundsHelpText = appsLoading ? (\n    ''\n  ) : hasFinanceApp || hasAgentApp ? (\n    <span>\n      If youâ€™d like to deposit funds into this organization, you can do so from{' '}\n      {hasFinanceApp ? (\n        <OpenAppButton onClick={handleOpenFinanceApp}>Finance</OpenAppButton>\n      ) : (\n        <OpenAppButton onClick={handleOpenAgentApp}>Agent</OpenAppButton>\n      )}\n      .\n    </span>\n  ) : (\n    `This organization does not have a Finance or Agent app installed and may\n     not be able to receive funds. Please check with the organizationâ€™s\n     administrators if any other installed apps are able to receive funds.`\n  )\n\n  return (\n    <React.Fragment>\n      <Header primary=\"Organization Settings\" />\n      <Box heading=\"Organization address\">\n        <p\n          css={`\n            ${textStyle('body2')}\n          `}\n        >\n          {organizationText}\n        </p>\n        {checksummedDaoAddr && (\n          <React.Fragment>\n            <div\n              css={`\n                margin-top: ${2 * GU}px;\n                margin-bottom: ${3 * GU}px;\n              `}\n            >\n              <LocalIdentityBadge\n                entity={checksummedDaoAddr}\n                shorten={shortAddresses}\n              />\n            </div>\n            <Info>\n              <strong css=\"font-weight: 800\">\n                Do not send{' '}\n                {getNetworkSettings(network.type).nativeCurrency.symbol} or\n                ERC20 tokens to this address.\n              </strong>{' '}\n              {depositFundsHelpText}\n            </Info>\n          </React.Fragment>\n        )}\n      </Box>\n      {appsLoading ? (\n        <Box heading=\"Installed Aragon apps\">\n          <div\n            css={`\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              height: ${22 * GU}px;\n              ${textStyle('body2')}\n            `}\n          >\n            Loading appsâ€¦\n          </div>\n        </Box>\n      ) : (\n        <React.Fragment>\n          <Box heading=\"Installed Aragon apps\">\n            <ul\n              css={`\n                list-style: none;\n                display: grid;\n                grid-template-columns: minmax(50%, 1fr) minmax(50%, 1fr);\n                grid-column-gap: ${2 * GU}px;\n                margin-bottom: -${3 * GU}px;\n              `}\n            >\n              {apmApps.map(\n                ({ appId, description, name, proxyAddress, tags }) => (\n                  <li\n                    key={proxyAddress}\n                    css={`\n                      margin-bottom: ${3 * GU}px;\n                    `}\n                  >\n                    <label\n                      css={`\n                        color: ${theme.surfaceContentSecondary};\n                        ${unselectable()};\n                        ${textStyle('label2')};\n                      `}\n                    >\n                      {name}\n                      {tags.length > 0 ? ` (${tags.join(', ')})` : ''}\n                    </label>\n                    <div\n                      css={`\n                        margin-top: ${1 * GU}px;\n                      `}\n                    >\n                      <LocalIdentityBadge\n                        entity={proxyAddress}\n                        shorten={shortAddresses}\n                      />\n                    </div>\n                  </li>\n                )\n              )}\n            </ul>\n          </Box>\n          {tenderlyImportUrl && (\n            <Box heading=\"Import organization into Tenderly\">\n              <p\n                css={`\n                  margin-bottom: ${2 * GU}px;\n                  ${textStyle('body2')}\n                `}\n              >\n                Import this organizationâ€™s smart contracts into your Tenderly\n                dashboard.\n              </p>\n              <Button\n                href={tenderlyImportUrl}\n                label=\"Import organization into Tenderly\"\n                icon={<IconExternal />}\n                display=\"all\"\n                disabled={!isMainnet}\n                css={`\n                  margin-bottom: ${2 * GU}px;\n                `}\n              />\n              <Info>\n                <p>\n                  <Link href=\"https://tenderly.co/\">Tenderly</Link> is a\n                  real-time monitoring, alerting, and troubleshooting solution\n                  for smart contracts.\n                </p>\n                <p\n                  css={`\n                    margin-top: ${1 * GU}px;\n                  `}\n                >\n                  {isMainnet ? (\n                    <span>\n                      By importing your organization into Tenderly, you will be\n                      able to easily inspect, review, and monitor the smart\n                      contracts that make up this organization.\n                    </span>\n                  ) : (\n                    <span>\n                      Unfortunately, importing into Tenderly is not available on\n                      the {sanitizeNetworkType(network.type)} network. Please\n                      use Aragon on Ethereum mainnet instead.\n                    </span>\n                  )}\n                </p>\n              </Info>\n            </Box>\n          )}\n        </React.Fragment>\n      )}\n      {hasFinanceApp && testTokensEnabled(network.type) && (\n        <Box heading=\"Request test tokens\">\n          <p\n            css={`\n              margin-bottom: ${2 * GU}px;\n              ${textStyle('body2')}\n            `}\n          >\n            Deposit some tokens into your organization for testing purposes.\n          </p>\n          <Button\n            label=\"Request test tokens\"\n            icon={<IconCoin />}\n            display=\"all\"\n            onClick={handleDepositTestTokens}\n            disabled={!enableTransactions}\n            css={`\n              margin-bottom: ${2 * GU}px;\n            `}\n          />\n          {enableTransactions ? (\n            <Info>\n              <p>\n                Requesting tokens will assign random{' '}\n                <strong css=\"font-weight: 800\">test tokens</strong> to your\n                organization. These tokens are named after existing projects,\n                but keep in mind{' '}\n                <strong css=\"font-weight: 800\">they are not real tokens</strong>\n                .\n              </p>\n              <p\n                css={`\n                  margin-top: ${1 * GU}px;\n                `}\n              >\n                You can view the received tokens in{' '}\n                <OpenAppButton onClick={handleOpenFinanceApp}>\n                  Finance\n                </OpenAppButton>\n                .\n              </p>\n            </Info>\n          ) : (\n            <Info mode=\"warning\">\n              {`Please ${\n                wallet.networkType !== network.type\n                  ? `select the ${sanitizeNetworkType(network.type)} network`\n                  : 'unlock your account'\n              } in ${getProviderString(\n                'your wallet',\n                wallet.providerInfo.id\n              )}.`}\n            </Info>\n          )}\n        </Box>\n      )}\n    </React.Fragment>\n  )\n})\n\nOrganization.propTypes = {\n  apps: PropTypes.arrayOf(AppType).isRequired,\n  appsLoading: PropTypes.bool.isRequired,\n  canUpgradeOrg: PropTypes.bool,\n  daoAddress: DaoAddressType.isRequired,\n  onOpenApp: PropTypes.func.isRequired,\n  onShowOrgVersionDetails: PropTypes.func.isRequired,\n}\n\nconst OpenAppButton = props => <Link css=\"font-weight: 600\" {...props} />\n\nexport default Organization\n","import styled from 'styled-components'\nimport { Box, textStyle } from '@aragon/ui'\n\nconst EmptyBlock = styled(Box)`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 180px;\n  ${textStyle('body2')}\n`\n\nexport default EmptyBlock\n","import React from 'react'\nimport {\n  isAnyEntity,\n  isBurnEntity,\n  isUnassignedEntity,\n} from '../../permissions'\nimport { EthereumAddressType } from '../../prop-types'\nimport LocalIdentityBadge from '../../components/IdentityBadge/LocalIdentityBadge'\n\nfunction PermissionsIdentityBadge({ entity, ...props }) {\n  const entityLabel = isAnyEntity(entity)\n    ? 'Any account'\n    : isBurnEntity(entity)\n    ? 'Discarded'\n    : isUnassignedEntity(entity)\n    ? 'Not assigned'\n    : entity\n  return <LocalIdentityBadge entity={entityLabel} {...props} />\n}\nPermissionsIdentityBadge.propTypes = {\n  ...LocalIdentityBadge.propTypes,\n  entity: EthereumAddressType.isRequired,\n}\n\nexport default PermissionsIdentityBadge\n","import React, { useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  ButtonIcon,\n  ContextMenu,\n  ContextMenuItem,\n  DataView,\n  IconCirclePlus,\n  IconEdit,\n  IconTrash,\n  IconView,\n  GU,\n  textStyle,\n  useLayout,\n  useTheme,\n} from '@aragon/ui'\nimport { usePermissions } from '../../contexts/PermissionsContext'\nimport LocalLabelAppBadge from '../../components/LocalLabelAppBadge/LocalLabelAppBadge'\nimport { getUnassignedEntity } from '../../permissions'\nimport PermissionsIdentityBadge from './PermissionsIdentityBadge'\n\nconst PermissionsView = React.memo(function PermissionsView({\n  heading,\n  onAssignPermission,\n  onManageRole,\n  onPageChange,\n  page,\n  permissions,\n  showApps,\n}) {\n  const { layoutName } = useLayout()\n  const willRenderEntryExpansion = useMemo(\n    () => permissions.some(permission => permission.entities.length > 1),\n    [permissions]\n  )\n\n  const fields = [\n    'Action',\n    'On app',\n    { label: 'Assigned to entity', childStart: true },\n    'Managed by',\n  ]\n\n  if (!showApps) {\n    fields.splice(1, 1)\n  }\n\n  return (\n    <DataView\n      heading={heading}\n      page={page}\n      onPageChange={onPageChange}\n      mode={\n        layoutName === 'large' || (layoutName === 'medium' && !showApps)\n          ? 'table'\n          : 'list'\n      }\n      fields={permissions.length ? fields : []}\n      entries={permissions}\n      renderEntry={entry => renderEntry(entry, showApps)}\n      renderEntryExpansion={\n        willRenderEntryExpansion ? renderEntryExpansion : undefined\n      }\n      renderEntryActions={entry =>\n        renderEntryActions(entry, onAssignPermission, onManageRole)\n      }\n    />\n  )\n})\n\nPermissionsView.propTypes = {\n  heading: PropTypes.node,\n  onAssignPermission: PropTypes.func.isRequired,\n  onManageRole: PropTypes.func.isRequired,\n  onPageChange: PropTypes.func.isRequired,\n  page: PropTypes.number.isRequired,\n  permissions: PropTypes.array.isRequired,\n  showApps: PropTypes.bool.isRequired,\n}\n\nfunction renderEntry({ entities, app, role, manager }, showApps) {\n  const cells = [\n    <span\n      css={`\n        ${textStyle('body2')}\n      `}\n    >\n      {role.name ||\n        role.id\n          ?.toLowerCase()\n          .split('_')\n          .slice(0, -1)\n          .join(' ')}\n    </span>,\n    <LocalLabelAppBadge app={app} apps={[]} noIdentifier />,\n    <EntryEntities entities={entities} />,\n    <EntityBadge entity={manager} />,\n  ]\n\n  if (!showApps) {\n    cells.splice(1, 1)\n  }\n\n  return cells\n}\n\nfunction renderEntryExpansion({ entities, app, role }) {\n  return entities.length < 2\n    ? null\n    : entities.map(entity => (\n        <ChildEntity\n          key={entity.address}\n          appAddress={app.proxyAddress}\n          entity={entity}\n          roleBytes={role.bytes}\n        />\n      ))\n}\n\nfunction renderEntryActions(entry, onAssignPermission, onManageRole) {\n  return (\n    <EntryActions\n      entry={entry}\n      onAssignPermission={onAssignPermission}\n      onManageRole={onManageRole}\n    />\n  )\n}\n\n/* eslint-disable react/prop-types */\nfunction EntryActions({ entry, onAssignPermission, onManageRole }) {\n  const theme = useTheme()\n  const { revokePermission } = usePermissions()\n\n  const { app, entities, manager, role } = entry\n  const { proxyAddress } = app\n  const { address: entityAddress } = entities[0] || {}\n  const roleBytes = role.bytes\n\n  const handleManageRole = useCallback(() => {\n    onManageRole(proxyAddress, roleBytes)\n  }, [roleBytes, proxyAddress, onManageRole])\n\n  const handleRevokePermission = useCallback(() => {\n    revokePermission({ appAddress: proxyAddress, entityAddress, roleBytes })\n  }, [revokePermission, entityAddress, proxyAddress, roleBytes])\n\n  const actions = []\n  if (manager.type === 'burn') {\n    actions.push([handleManageRole, IconView, 'View permission'])\n  } else {\n    if (manager.type === 'unassigned') {\n      actions.push([\n        handleManageRole,\n        IconEdit,\n        entities.length > 0 ? 'Re-initialize permission' : 'Create permission',\n      ])\n    } else {\n      actions.push(\n        ...[\n          [handleManageRole, IconEdit, 'Manage role'],\n          [onAssignPermission, IconCirclePlus, 'Assign permission'],\n        ]\n      )\n    }\n\n    if (entities.length === 1 && entityAddress) {\n      actions.push([\n        handleRevokePermission,\n        IconTrash,\n        'Revoke permission',\n        theme.negative,\n      ])\n    }\n  }\n\n  return (\n    <ContextMenu zIndex={2}>\n      {actions.map(([onClick, Icon, label, color], index) => (\n        <ContextMenuItem onClick={onClick} key={index}>\n          <span\n            css={`\n              position: relative;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              color: ${color || theme.surfaceContentSecondary};\n            `}\n          >\n            <Icon />\n          </span>\n          <span\n            css={`\n              margin-left: ${1 * GU}px;\n            `}\n          >\n            {label}\n          </span>\n        </ContextMenuItem>\n      ))}\n    </ContextMenu>\n  )\n}\n/* eslint-enable react/prop-types */\n\n/* eslint-disable react/prop-types */\nfunction ChildEntity({ appAddress, entity, roleBytes }) {\n  const theme = useTheme()\n  const { revokePermission } = usePermissions()\n\n  const entityAddress = entity.address\n\n  const handleRevokeButtonClick = useCallback(() => {\n    revokePermission({ appAddress, entityAddress, roleBytes })\n  }, [revokePermission, entityAddress, appAddress, roleBytes])\n\n  return (\n    <div\n      key={entityAddress}\n      css={`\n        display: flex;\n        width: 100%;\n        justify-content: space-between;\n        align-items: center;\n      `}\n    >\n      <EntityBadge entity={entity} />\n      <ButtonIcon\n        label=\"Revoke permission\"\n        mode=\"button\"\n        onClick={handleRevokeButtonClick}\n        css={`\n          color: ${theme.negative};\n        `}\n      >\n        <IconTrash />\n      </ButtonIcon>\n    </div>\n  )\n}\n/* eslint-enable react/prop-types */\n\n/* eslint-disable react/prop-types */\nfunction EntryEntities({ entities }) {\n  if (entities.length === 1) {\n    return <EntityBadge entity={entities[0]} />\n  }\n\n  return (\n    <span\n      css={`\n        ${textStyle('body2')}\n      `}\n    >\n      {entities.length === 0 ? (\n        <PermissionsIdentityBadge entity={getUnassignedEntity()} />\n      ) : (\n        `${entities.length} entities`\n      )}\n    </span>\n  )\n}\n/* eslint-enable react/prop-types */\n\n/* eslint-disable react/prop-types */\nfunction EntityBadge({ entity }) {\n  if (entity.type === 'app') {\n    return <LocalLabelAppBadge app={entity.app} apps={[]} noIdentifier />\n  }\n\n  return <PermissionsIdentityBadge entity={entity.address} />\n}\n/* eslint-enable react/prop-types */\n\nexport default PermissionsView\n","import React, { useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { BackButton, Bar, textStyle } from '@aragon/ui'\nimport { AppType } from '../../prop-types'\nimport { usePermissionsByRole } from '../../contexts/PermissionsContext'\nimport EmptyBlock from './EmptyBlock'\nimport PermissionsView from './PermissionsView'\n\nfunction AppPermissions({\n  app,\n  loading,\n  onAssignPermission,\n  onBack,\n  onManageRole,\n}) {\n  const [page, setPage] = useState(0)\n\n  const permissions = usePermissionsByRole()\n\n  const appProxyAddress = app ? app.proxyAddress : null\n\n  const appPermissions = useMemo(\n    () =>\n      appProxyAddress\n        ? permissions.filter(\n            permission =>\n              permission.app && permission.app.proxyAddress === appProxyAddress\n          )\n        : [],\n    [permissions, appProxyAddress]\n  )\n\n  const permissionsKey = appPermissions\n    .map(permission => `${permission.app.proxyAddress}-${permission.role.id}`)\n    .join(',')\n\n  useEffect(() => {\n    setPage(0)\n  }, [permissionsKey])\n\n  if (loading || !appProxyAddress) {\n    return <EmptyBlock>Loading permissionsâ€¦</EmptyBlock>\n  }\n\n  if (appPermissions.length === 0) {\n    return (\n      <React.Fragment>\n        <Bar>\n          <BackButton onClick={onBack} />\n        </Bar>\n        <EmptyBlock>No permissions found.</EmptyBlock>\n      </React.Fragment>\n    )\n  }\n\n  return (\n    <React.Fragment>\n      <Bar>\n        <BackButton onClick={onBack} />\n      </Bar>\n      <PermissionsView\n        heading={\n          <span\n            css={`\n              ${textStyle('body1')}\n            `}\n          >\n            Available permissions\n          </span>\n        }\n        onAssignPermission={onAssignPermission}\n        onManageRole={onManageRole}\n        onPageChange={setPage}\n        page={page}\n        permissions={appPermissions}\n        showApps={false}\n      />\n    </React.Fragment>\n  )\n}\n\nAppPermissions.propTypes = {\n  app: AppType, // may not be available if still loading\n  loading: PropTypes.bool.isRequired,\n  onAssignPermission: PropTypes.func.isRequired,\n  onManageRole: PropTypes.func.isRequired,\n  onBack: PropTypes.func.isRequired,\n}\n\nexport default AppPermissions\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { Tag, GU, useViewport } from '@aragon/ui'\nimport { AppType, EthereumAddressType } from '../prop-types'\nimport { shortenAddress } from '../util/web3'\nimport AppIcon from './AppIcon/AppIcon'\n\nconst AppInstanceLabel = React.memo(\n  ({ app, proxyAddress, showIcon = true }) => {\n    const { above } = useViewport()\n\n    return (\n      <div\n        css={`\n          display: inline-flex;\n          ${above('medium') &&\n            `\n              display: flex;\n              align-items: center;\n              text-align: left;\n              margin: unset;\n            `}\n        `}\n      >\n        {above('medium') && showIcon && (\n          <div\n            css={`\n              display: flex;\n              align-items: center;\n              height: 0;\n              margin-right: 10px;\n              margin-top: -1px;\n            `}\n          >\n            <AppIcon app={app} />\n          </div>\n        )}\n        <span\n          css={`\n            display: block;\n            ${above('medium') &&\n              `\n                display: inline;\n                margin-right: ${1 * GU}px;\n              `}\n          `}\n        >\n          {app ? app.name : 'Unknown'}\n        </span>\n        <Tag\n          mode=\"identifier\"\n          label={(app && app.identifier) || shortenAddress(proxyAddress)}\n          title={proxyAddress}\n          css={`\n            margin-left: ${1 * GU}px;\n          `}\n        />\n      </div>\n    )\n  }\n)\n\nAppInstanceLabel.propTypes = {\n  app: AppType.isRequired,\n  proxyAddress: EthereumAddressType.isRequired,\n  showIcon: PropTypes.bool,\n}\n\nexport default AppInstanceLabel\n","import React, { useState, useEffect, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport {\n  _AutoCompleteSelected as AutoCompleteSelected,\n  EthIdenticon,\n  IdentityBadge,\n  GU,\n  RADIUS,\n  useTheme,\n} from '@aragon/ui'\nimport { AragonType } from '../../prop-types'\n\nconst withKey = item => ({ key: item.address, ...item })\nconst sortAlphAsc = (a, b) => a.name.localeCompare(b.name)\n\nconst LocalIdentitiesAutoComplete = React.memo(\n  React.forwardRef(function LocalIdentitiesAutoComplete(\n    { onChange, placeholder, required, value, wide, wrapper },\n    ref\n  ) {\n    const theme = useTheme()\n    const [items, setItems] = useState([])\n    const [selected, setSelected] = useState(null)\n    const [searchTerm, setSearchTerm] = useState('')\n\n    const handleSearch = useCallback(\n      async term => {\n        if (!wrapper) {\n          return\n        }\n        if (term.length < 3) {\n          setItems([])\n          return\n        }\n        const items = await wrapper.searchIdentities(term)\n        setItems(items.map(withKey).sort(sortAlphAsc))\n      },\n      [wrapper]\n    )\n    const handleChange = useCallback(\n      value => {\n        setSearchTerm(value)\n        handleSearch(value)\n        onChange(value)\n      },\n      [onChange, handleSearch]\n    )\n    const handleSelect = useCallback(\n      selected => {\n        const { name, address } = selected\n        setSearchTerm(name)\n        handleSearch(name)\n        setSelected(selected)\n        onChange(address)\n      },\n      [onChange, handleSearch]\n    )\n    const handleSelectedClick = () => {\n      setSelected(null)\n      onChange(selected.name)\n    }\n\n    useEffect(() => {\n      const effect = async () => {\n        // reset\n        if (value === '') {\n          setSelected(null)\n          setSearchTerm(value)\n          handleSearch(value)\n          return\n        }\n        // value coming from up the tree not from typing\n        if (searchTerm === '' && wrapper) {\n          const exists = await wrapper.searchIdentities(value)\n          if (exists && exists.length === 1) {\n            const item = exists[0]\n            if (\n              item.name.toLowerCase() === value.toLowerCase() ||\n              item.address.toLowerCase() === value.toLowerCase()\n            ) {\n              setSelected(item)\n              setSearchTerm(item.name)\n              handleSearch(item.name)\n              return\n            }\n          }\n          setSearchTerm(value)\n        }\n      }\n      effect()\n    }, [selected, value, wrapper, handleSearch, searchTerm])\n\n    return (\n      <AutoCompleteSelected\n        itemButtonStyles={`\n          cursor: pointer;\n          border-radius: 0;\n          &:focus {\n            outline: 2px solid ${theme.accent};\n          }\n          &:active {\n            background: #f9fafc;\n          }\n        `}\n        items={items}\n        onChange={handleChange}\n        onSelect={handleSelect}\n        onSelectedClick={handleSelectedClick}\n        placeholder={placeholder}\n        ref={ref}\n        renderItem={Item}\n        renderSelected={Selected}\n        required={required}\n        selected={selected}\n        selectedButtonStyles={`\n          padding: 0;\n\n          &:focus,\n          &:active {\n            outline: none;\n            border-radius: ${RADIUS}px;\n          }\n        `}\n        value={searchTerm}\n        wide={wide}\n      />\n    )\n  })\n)\n\nLocalIdentitiesAutoComplete.propTypes = {\n  onChange: PropTypes.func.isRequired,\n  placeholder: PropTypes.string,\n  required: PropTypes.bool,\n  value: PropTypes.string,\n  wide: PropTypes.bool,\n  wrapper: AragonType,\n}\n\nconst Item = ({ address, name }, searchTerm) => {\n  if (searchTerm.indexOf('0x') === 0) {\n    return (\n      <Option>\n        <IdentityBadge compact badgeOnly entity={address} />\n        <Name>{name}</Name>\n      </Option>\n    )\n  }\n  return (\n    <Option>\n      <Name>{name}</Name>\n      <IdentityBadge compact badgeOnly entity={address} />\n    </Option>\n  )\n}\n\nItem.propTypes = {\n  address: PropTypes.string.isRequired,\n  name: PropTypes.string.isRequired,\n}\n\nconst Selected = ({ address, name }) => {\n  return (\n    <Option selected>\n      <EthIdenticon address={address} scale={0.6} radius={2} />\n      <Name>{name}</Name>\n    </Option>\n  )\n}\n\nSelected.propTypes = {\n  address: PropTypes.string.isRequired,\n  name: PropTypes.string.isRequired,\n}\n\nconst Option = styled.div`\n  padding: ${1 * GU}px;\n  display: grid;\n  grid-template-columns: auto minmax(140px, 1fr);\n  grid-gap: ${1 * GU}px;\n  align-items: center;\n`\n\nconst Name = styled.div`\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: inline-block;\n  text-align: left;\n  color: #000;\n`\n\nexport default LocalIdentitiesAutoComplete\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { DropDown, Field } from '@aragon/ui'\nimport { getAnyEntity } from '../../permissions'\nimport { AppType, AragonType } from '../../prop-types'\nimport { getEmptyAddress } from '../../util/web3'\nimport AppInstanceLabel from '../../components/AppInstanceLabel'\nimport LocalIdentitiesAutoComplete from '../../components/LocalIdentitiesAutoComplete/LocalIdentitiesAutoComplete'\n\nclass EntitySelector extends React.Component {\n  static propTypes = {\n    apps: PropTypes.arrayOf(AppType).isRequired,\n    includeAnyEntity: PropTypes.bool,\n    label: PropTypes.string.isRequired,\n    labelCustomAddress: PropTypes.string.isRequired,\n    onChange: PropTypes.func.isRequired,\n    selectedIndex: PropTypes.number.isRequired,\n    wrapper: AragonType,\n  }\n  state = {\n    customAddress: '',\n  }\n  handleChange = index => {\n    this.setState({ customAddress: '' }, () => {\n      this.props.onChange({\n        index,\n        address: this.getAddress(index),\n      })\n    })\n  }\n  handleCustomAddressChange = value => {\n    this.setState({ customAddress: value })\n    this.props.onChange({\n      index: this.getItems().length - 1,\n      address: value,\n    })\n  }\n  getApps() {\n    const { apps } = this.props\n    return apps.filter(app => Boolean(app.name))\n  }\n  getAppsItems() {\n    return this.getApps().map(app => (\n      <AppInstanceLabel app={app} proxyAddress={app.proxyAddress} />\n    ))\n  }\n  getAddress(index) {\n    if (index === -1 || index === 0) {\n      return getEmptyAddress()\n    }\n\n    const items = this.getItems()\n\n    if (index === items.length - 1) {\n      return this.state.customAddress\n    }\n\n    if (this.props.includeAnyEntity && index === items.length - 2) {\n      return getAnyEntity()\n    }\n\n    const app = this.getApps()[index - 1]\n    return (app && app.proxyAddress) || getEmptyAddress()\n  }\n  getItems() {\n    const { includeAnyEntity } = this.props\n\n    const items = [\n      'Select an entity',\n      ...this.getAppsItems(),\n      'Custom addressâ€¦',\n    ]\n    if (includeAnyEntity) {\n      // Add immediately before last item\n      items.splice(-1, 0, 'Any account')\n    }\n\n    return items\n  }\n  render() {\n    const { customAddress } = this.state\n    const { label, labelCustomAddress, selectedIndex, wrapper } = this.props\n    const items = this.getItems()\n    const showCustomAddress = selectedIndex === items.length - 1\n    return (\n      <React.Fragment>\n        <Field label={label}>\n          <DropDown\n            placeholder=\"Select an entity\"\n            items={items}\n            selected={selectedIndex}\n            onChange={this.handleChange}\n            wide\n          />\n        </Field>\n\n        {showCustomAddress && (\n          <Field\n            label={labelCustomAddress}\n            css={`\n              height: 60px;\n            `}\n          >\n            <LocalIdentitiesAutoComplete\n              placeholder=\"0xcafeâ€¦\"\n              value={customAddress}\n              onChange={this.handleCustomAddressChange}\n              wrapper={wrapper}\n              wide\n            />\n          </Field>\n        )}\n      </React.Fragment>\n    )\n  }\n}\n\nexport default EntitySelector\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { Button, DropDown, Info, Field, SidePanel, GU } from '@aragon/ui'\nimport { ANY_ENTITY } from '../../permissions'\nimport { PermissionsConsumer } from '../../contexts/PermissionsContext'\nimport { AppType, AragonType } from '../../prop-types'\nimport { isAddress, isEmptyAddress } from '../../util/web3'\nimport AppInstanceLabel from '../../components/AppInstanceLabel'\nimport EntitySelector from './EntitySelector'\n\nconst DEFAULT_STATE = {\n  assignEntityIndex: -1,\n  assignEntityAddress: '',\n  appIndex: -1,\n  roleIndex: -1,\n}\n\n// The permission panel,€€